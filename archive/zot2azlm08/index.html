<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="两个浏览器窗口间通信总结"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>两个浏览器窗口间通信总结 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/zot2azlm08/",
				"appid": "1613049289050283", 
				"title": "两个浏览器窗口间通信总结 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-03-02T02:30:07"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/myfwty9876l/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/atugb5t43pv/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fzot2azlm08%2f&text=%e4%b8%a4%e4%b8%aa%e6%b5%8f%e8%a7%88%e5%99%a8%e7%aa%97%e5%8f%a3%e9%97%b4%e9%80%9a%e4%bf%a1%e6%80%bb%e7%bb%93"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fzot2azlm08%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fzot2azlm08%2f&text=%e4%b8%a4%e4%b8%aa%e6%b5%8f%e8%a7%88%e5%99%a8%e7%aa%97%e5%8f%a3%e9%97%b4%e9%80%9a%e4%bf%a1%e6%80%bb%e7%bb%93"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fzot2azlm08%2f&title=%e4%b8%a4%e4%b8%aa%e6%b5%8f%e8%a7%88%e5%99%a8%e7%aa%97%e5%8f%a3%e9%97%b4%e9%80%9a%e4%bf%a1%e6%80%bb%e7%bb%93"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fzot2azlm08%2f&is_video=false&description=%e4%b8%a4%e4%b8%aa%e6%b5%8f%e8%a7%88%e5%99%a8%e7%aa%97%e5%8f%a3%e9%97%b4%e9%80%9a%e4%bf%a1%e6%80%bb%e7%bb%93"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e4%b8%a4%e4%b8%aa%e6%b5%8f%e8%a7%88%e5%99%a8%e7%aa%97%e5%8f%a3%e9%97%b4%e9%80%9a%e4%bf%a1%e6%80%bb%e7%bb%93&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fzot2azlm08%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fzot2azlm08%2f&title=%e4%b8%a4%e4%b8%aa%e6%b5%8f%e8%a7%88%e5%99%a8%e7%aa%97%e5%8f%a3%e9%97%b4%e9%80%9a%e4%bf%a1%e6%80%bb%e7%bb%93"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fzot2azlm08%2f&title=%e4%b8%a4%e4%b8%aa%e6%b5%8f%e8%a7%88%e5%99%a8%e7%aa%97%e5%8f%a3%e9%97%b4%e9%80%9a%e4%bf%a1%e6%80%bb%e7%bb%93"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fzot2azlm08%2f&title=%e4%b8%a4%e4%b8%aa%e6%b5%8f%e8%a7%88%e5%99%a8%e7%aa%97%e5%8f%a3%e9%97%b4%e9%80%9a%e4%bf%a1%e6%80%bb%e7%bb%93"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fzot2azlm08%2f&title=%e4%b8%a4%e4%b8%aa%e6%b5%8f%e8%a7%88%e5%99%a8%e7%aa%97%e5%8f%a3%e9%97%b4%e9%80%9a%e4%bf%a1%e6%80%bb%e7%bb%93"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">两个浏览器窗口间通信总结</h1><div class="meta"><div class="postdate"><time datetime="2019-03-02" itemprop="datePublished">2019-03-02</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch1 id=\x22articleHeader0\x22\x3e两个浏览器窗口间通信总结\x3c\/h1\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e1、localStorage\x3c\/h2\x3e\n\x3cp\x3e\x3cstrong\x3e一个窗口更新localStorage，另一个窗口监听window对象的”storage”事件，来实现通信。\x3c\/strong\x3e\x3cbr\x3e\x3cstrong\x3e\x3cem\x3e注：两个页面要同源（URL的协议、域名和端口相同）\x3c\/em\x3e\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 本窗口的设值代码\nlocalStorage.setItem(\x27aaa\x27, (Math.random()*10).toString())\n\n\/\/ 其他窗口监听storage事件\nwindow.addEventListener(\x26quot;storage\x26quot;, function (e) {\n  console.log(e)\n  console.log(e.newValue)\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 本窗口的设值代码\x3c\/span\x3e\nlocalStorage.setItem(\x3cspan class=\x22hljs-string\x22\x3e\x27aaa\x27\x3c\/span\x3e, (\x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.random()*\x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e).toString())\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 其他窗口监听storage事件\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x22storage\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(e)\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(e.newValue)\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e2、WebSocket\x3c\/h2\x3e\n\x3cp\x3e\x3cstrong\x3e所有的WebSocket都监听同一个服务器地址，利用send发送消息，利用onmessage获取消息的变化，不仅能窗口，还能跨浏览器，兼容性最佳，只是需要消耗点服务器资源。\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var ws = new WebSocket(\x26quot;ws:\/\/localhost:3000\/\x26quot;)\nws.onopen = function (event) {\n  \/\/ 或者把此方法注册到其他事件中，即可与其他服务器通信\n  ws.send({now : Date.now()}); \/\/ 通过服务器中转消息\n};\nws.onmessage = function (event) {\n  \/\/ 消费消息\n  console.log(event.data);\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e ws = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e WebSocket(\x3cspan class=\x22hljs-string\x22\x3e\x22ws:\/\/localhost:3000\/\x22\x3c\/span\x3e)\nws.onopen = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eevent\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 或者把此方法注册到其他事件中，即可与其他服务器通信\x3c\/span\x3e\n  ws.send({\x3cspan class=\x22hljs-attr\x22\x3enow\x3c\/span\x3e : \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e.now()}); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 通过服务器中转消息\x3c\/span\x3e\n};\nws.onmessage = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eevent\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 消费消息\x3c\/span\x3e\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(event.data);\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e3、postMessage\x3c\/h2\x3e\n\x3cp\x3e\x3cstrong\x3e借助iframe 或 window.open\x3c\/strong\x3e\x3cbr\x3e\x3cstrong\x3e回顾一下API\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22otherWindow.postMessage(message, targetOrigin, [transfer]);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs css\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-selector-tag\x22\x3eotherWindow\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.postMessage\x3c\/span\x3e(\x3cspan class=\x22hljs-selector-tag\x22\x3emessage\x3c\/span\x3e, \x3cspan class=\x22hljs-selector-tag\x22\x3etargetOrigin\x3c\/span\x3e, \x3cspan class=\x22hljs-selector-attr\x22\x3e[transfer]\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cul\x3e\n\x3cli\x3eotherWindow\x3cbr\x3e其他窗口的一个引用，比如iframe的contentWindow属性、执行window.open返回的窗口对象、或者是命名过或数值索引的window.frames。\x3c\/li\x3e\n\x3cli\x3emessage\x3cbr\x3e将要发送到其他 window的数据。它将会被结构化克隆算法序列化。这意味着你可以不受什么限制的将数据对象安全的传送给目标窗口而无需自己序列化。\x3c\/li\x3e\n\x3cli\x3etargetOrigin\x3cbr\x3e通过窗口的origin属性来指定哪些窗口能接收到消息事件，其值可以是字符串\x22\x3cem\x3e\x22（表示无限制）或者一个URI。在发送消息的时候，如果目标窗口的协议、主机地址或端口这三者的任意一项不匹配targetOrigin提供的值，那么消息就不会被发送；只有三者完全匹配，消息才会被发送。这个机制用来控制消息可以发送到哪些窗口；例如，当用postMessage传送密码时，这个参数就显得尤为重要，必须保证它的值与这条包含密码的信息的预期接受者的origin属性完全一致，来防止密码被恶意的第三方截获。如果你明确的知道消息应该发送到哪个窗口，那么请始终提供一个有确切值的targetOrigin，而不是\x3c\/em\x3e。不提供确切的目标将导致数据泄露到任何对数据感兴趣的恶意站点。\x3c\/li\x3e\n\x3cli\x3etransfer 可选\x3cbr\x3e是一串和message 同时传递的 Transferable 对象. 这些对象的所有权将被转移给消息的接收方，而发送一方将不再保有所有权。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/*\n * A窗口的域名是\x3chttp:\/\/example.com:8080\x3e，以下是A窗口的script标签下的代码：\n *\/\n\nvar popup = window.open(...popup details...);\n\n\/\/ 如果弹出框没有被阻止且加载完成\n\n\/\/ 这行语句没有发送信息出去，即使假设当前页面没有改变location（因为targetOrigin设置不对）\npopup.postMessage(\x26quot;The user is \x27bob\x27 and the password is \x27secret\x27\x26quot;,\n                  \x26quot;https:\/\/secure.example.net\x26quot;);\n\n\/\/ 假设当前页面没有改变location，这条语句会成功添加message到发送队列中去（targetOrigin设置对了）\npopup.postMessage(\x26quot;hello there!\x26quot;, \x26quot;http:\/\/example.org\x26quot;);\n\nfunction receiveMessage(event)\n{\n  \/\/ 我们能相信信息的发送者吗?  (也许这个发送者和我们最初打开的不是同一个页面).\n  if (event.origin !== \x26quot;http:\/\/example.org\x26quot;)\n    return;\n\n  \/\/ event.source 是我们通过window.open打开的弹出页面 popup\n  \/\/ event.data 是 popup发送给当前页面的消息 \x26quot;hi there yourself!  the secret response is: rheeeeet!\x26quot;\n}\nwindow.addEventListener(\x26quot;message\x26quot;, receiveMessage, false);\n\n\n\/*\n * 弹出页 popup 域名是\x3chttp:\/\/example.org\x3e，以下是script标签中的代码:\n *\/\n\n\/\/当A页面postMessage被调用后，这个function被addEventListenner调用\nfunction receiveMessage(event)\n{\n  \/\/ 我们能信任信息来源吗？\n  if (event.origin !== \x26quot;http:\/\/example.com:8080\x26quot;)\n    return;\n\n  \/\/ event.source 就当前弹出页的来源页面\n  \/\/ event.data 是 \x26quot;hello there!\x26quot;\n\n  \/\/ 假设你已经验证了所受到信息的origin (任何时候你都应该这样做), 一个很方便的方式就是把enent.source\n  \/\/ 作为回信的对象，并且把event.origin作为targetOrigin\n  event.source.postMessage(\x26quot;hi there yourself!  the secret response \x26quot; \x2b\n                           \x26quot;is: rheeeeet!\x26quot;,\n                           event.origin);\n}\n\nwindow.addEventListener(\x26quot;message\x26quot;, receiveMessage, false);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/*\n * A窗口的域名是\x26lt;http:\/\/example.com:8080\x26gt;，以下是A窗口的script标签下的代码：\n *\/\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e popup = \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.open(...popup details...);\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果弹出框没有被阻止且加载完成\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这行语句没有发送信息出去，即使假设当前页面没有改变location（因为targetOrigin设置不对）\x3c\/span\x3e\npopup.postMessage(\x3cspan class=\x22hljs-string\x22\x3e\x22The user is \x27bob\x27 and the password is \x27secret\x27\x22\x3c\/span\x3e,\n                  \x3cspan class=\x22hljs-string\x22\x3e\x22https:\/\/secure.example.net\x22\x3c\/span\x3e);\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 假设当前页面没有改变location，这条语句会成功添加message到发送队列中去（targetOrigin设置对了）\x3c\/span\x3e\npopup.postMessage(\x3cspan class=\x22hljs-string\x22\x3e\x22hello there!\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/example.org\x22\x3c\/span\x3e);\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ereceiveMessage\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eevent\x3c\/span\x3e)\n\x3c\/span\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 我们能相信信息的发送者吗?  (也许这个发送者和我们最初打开的不是同一个页面).\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (event.origin !== \x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/example.org\x22\x3c\/span\x3e)\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ event.source 是我们通过window.open打开的弹出页面 popup\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ event.data 是 popup发送给当前页面的消息 \x22hi there yourself!  the secret response is: rheeeeet!\x22\x3c\/span\x3e\n}\n\x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x22message\x22\x3c\/span\x3e, receiveMessage, \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e);\n\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/*\n * 弹出页 popup 域名是\x26lt;http:\/\/example.org\x26gt;，以下是script标签中的代码:\n *\/\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/当A页面postMessage被调用后，这个function被addEventListenner调用\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ereceiveMessage\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eevent\x3c\/span\x3e)\n\x3c\/span\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 我们能信任信息来源吗？\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (event.origin !== \x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/example.com:8080\x22\x3c\/span\x3e)\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ event.source 就当前弹出页的来源页面\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ event.data 是 \x22hello there!\x22\x3c\/span\x3e\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 假设你已经验证了所受到信息的origin (任何时候你都应该这样做), 一个很方便的方式就是把enent.source\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 作为回信的对象，并且把event.origin作为targetOrigin\x3c\/span\x3e\n  event.source.postMessage(\x3cspan class=\x22hljs-string\x22\x3e\x22hi there yourself!  the secret response \x22\x3c\/span\x3e \x2b\n                           \x3cspan class=\x22hljs-string\x22\x3e\x22is: rheeeeet!\x22\x3c\/span\x3e,\n                           event.origin);\n}\n\n\x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x22message\x22\x3c\/span\x3e, receiveMessage, \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e4、cookie \x2b setInterval【差】\x3c\/h2\x3e\n\x3cp\x3e在页面A设置一个使用\x26nbsp;setInterval\x26nbsp;定时器不断刷新，检查\x26nbsp;Cookies\x26nbsp;的值是否发生变化，如果变化就进行刷新的操作。\x3c\/p\x3e\n\x3cp\x3e由于\x26nbsp;Cookies\x26nbsp;是在同域可读的，所以在页面 B 审核的时候改变\x26nbsp;Cookies\x26nbsp;的值，页面 A 自然是可以拿到的。\x3c\/p\x3e\n\x3cp\x3e这样做确实可以实现我想要的功能，但是这样的方法相当浪费资源。虽然在这个性能过盛的时代，浪费不浪费也感觉不出来，但是这种实现方案，确实不够优雅。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3e5、SharedWorker\x3c\/h2\x3e\n\x3cp\x3eHTML5 中的 Web Worker 可以分为两种不同线程类型，一个是专用线程 Dedicated Worker，一个是共享线程 Shared Worker。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3eDedicated Worker直接使用new Worker()即可创建，这种webworker是当前页面专有的。。\x3c\/li\x3e\n\x3cli\x3eSharedWorker可以被多个window、标签页、iframe共同使用，但必须保证这些标签页都是同源的(相同的协议，主机和端口号)\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3e6、直接引用\x3c\/h2\x3e\n\x3cp\x3e其实就是直接获取对方DOM，适用于两个页面在同一域；可以传递对象数据（对象数据使用 instanceof 做类型判断时有坑）；参考 window.open；\x3cbr\x3e例：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 父页面获取子iframe\ndocument.getElementById(\x27iframe的id\x27).contentWindow.document\n\n\/\/ 子iframe获取父页面\nwindow.parent.document\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stylus\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 父页面获取子iframe\x3c\/span\x3e\ndocument.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x27iframe的id\x27\x3c\/span\x3e)\x3cspan class=\x22hljs-selector-class\x22\x3e.contentWindow\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.document\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 子iframe获取父页面\x3c\/span\x3e\nwindow\x3cspan class=\x22hljs-selector-class\x22\x3e.parent\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.document\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader7\x22\x3e7、window.name\x3c\/h2\x3e\n\x3cp\x3e浏览器窗口有window.name属性。这个属性的最大特点是，无论是否同源，只要在同一个窗口里，前一个网页设置了这个属性，后一个网页可以读取它。\x3c\/p\x3e\n\x3cp\x3e父窗口先打开一个子窗口，载入一个不同源的网页，该网页将信息写入window.name属性。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22window.name = data;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs fortran\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3ewindow.\x3cspan class=\x22hljs-keyword\x22\x3ename\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3edata\x3c\/span\x3e;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e接着，子窗口跳回一个与主窗口同域的网址。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22window.location.href = \x27http:\/\/parent.url.com\/xxx.html\x27;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs coffeescript\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.location.href = \x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/parent.url.com\/xxx.html\x27\x3c\/span\x3e;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然后，主窗口就可以读取子窗口的window.name了。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var data = document.getElementById(\x27iframe的id\x27).contentWindow.name;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs dart\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e data = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x27iframe的id\x27\x3c\/span\x3e).contentWindow.name;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这种方法的优点是，window.name容量很大，可以放置非常长的字符串；缺点是必须监听子窗口window.name属性的变化，影响网页性能。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>两个浏览器窗口间通信总结</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000016927268">https://segmentfault.com/a/1190000016927268</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/zot2azlm08/" target="_blank">https://alili.tech/archive/zot2azlm08/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/a5ficy1jp7n/">2019年03月Github Javascript开源项目精选<aside class="dates">2019-03-08</aside></a></li><li><a href="/archive/304a32r2py8/">30分钟精通React今年最劲爆的新特性——React Hooks<aside class="dates">2019-03-02</aside></a></li><li><a href="/archive/sj4oqgzx0rk/">CSS6：flex布局<aside class="dates">2019-03-02</aside></a></li><li><a href="/archive/wedm7eypuhb/">ES6 系列之 Babel 将 Async 编译成了什么样子<aside class="dates">2019-03-02</aside></a></li><li><a href="/archive/cazifdrck0u/">ES6 系列之我们来聊聊 Async<aside class="dates">2019-03-02</aside></a></li><li><a href="/archive/0dlsi4qmvsvf/">Express的基本使用<aside class="dates">2019-03-02</aside></a></li><li><a href="/archive/183cav6qpdb/">JavaScript常用八种继承方案<aside class="dates">2019-03-02</aside></a></li><li><a href="/archive/5tpnsqmgslq/">React 手稿 - Component state<aside class="dates">2019-03-02</aside></a></li><li><a href="/archive/0h3zalrcolvo/">React.memo<aside class="dates">2019-03-02</aside></a></li><li><a href="/archive/3e7xkoz9of6/">WEB站点性能优化实践<aside class="dates">2019-03-02</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>