<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="手摸手教你使用WebSocket[其实WebSocket也不难]"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>手摸手教你使用WebSocket[其实WebSocket也不难] | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/dtm6hp4hfru/",
				"appid": "1613049289050283", 
				"title": "手摸手教你使用WebSocket[其实WebSocket也不难] | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-03-02T02:30:07"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/5c65kcw1r0u/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/txeirj6cw7/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fdtm6hp4hfru%2f&text=%e6%89%8b%e6%91%b8%e6%89%8b%e6%95%99%e4%bd%a0%e4%bd%bf%e7%94%a8WebSocket%5b%e5%85%b6%e5%ae%9eWebSocket%e4%b9%9f%e4%b8%8d%e9%9a%be%5d"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fdtm6hp4hfru%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fdtm6hp4hfru%2f&text=%e6%89%8b%e6%91%b8%e6%89%8b%e6%95%99%e4%bd%a0%e4%bd%bf%e7%94%a8WebSocket%5b%e5%85%b6%e5%ae%9eWebSocket%e4%b9%9f%e4%b8%8d%e9%9a%be%5d"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fdtm6hp4hfru%2f&title=%e6%89%8b%e6%91%b8%e6%89%8b%e6%95%99%e4%bd%a0%e4%bd%bf%e7%94%a8WebSocket%5b%e5%85%b6%e5%ae%9eWebSocket%e4%b9%9f%e4%b8%8d%e9%9a%be%5d"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fdtm6hp4hfru%2f&is_video=false&description=%e6%89%8b%e6%91%b8%e6%89%8b%e6%95%99%e4%bd%a0%e4%bd%bf%e7%94%a8WebSocket%5b%e5%85%b6%e5%ae%9eWebSocket%e4%b9%9f%e4%b8%8d%e9%9a%be%5d"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e6%89%8b%e6%91%b8%e6%89%8b%e6%95%99%e4%bd%a0%e4%bd%bf%e7%94%a8WebSocket%5b%e5%85%b6%e5%ae%9eWebSocket%e4%b9%9f%e4%b8%8d%e9%9a%be%5d&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fdtm6hp4hfru%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fdtm6hp4hfru%2f&title=%e6%89%8b%e6%91%b8%e6%89%8b%e6%95%99%e4%bd%a0%e4%bd%bf%e7%94%a8WebSocket%5b%e5%85%b6%e5%ae%9eWebSocket%e4%b9%9f%e4%b8%8d%e9%9a%be%5d"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fdtm6hp4hfru%2f&title=%e6%89%8b%e6%91%b8%e6%89%8b%e6%95%99%e4%bd%a0%e4%bd%bf%e7%94%a8WebSocket%5b%e5%85%b6%e5%ae%9eWebSocket%e4%b9%9f%e4%b8%8d%e9%9a%be%5d"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fdtm6hp4hfru%2f&title=%e6%89%8b%e6%91%b8%e6%89%8b%e6%95%99%e4%bd%a0%e4%bd%bf%e7%94%a8WebSocket%5b%e5%85%b6%e5%ae%9eWebSocket%e4%b9%9f%e4%b8%8d%e9%9a%be%5d"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fdtm6hp4hfru%2f&title=%e6%89%8b%e6%91%b8%e6%89%8b%e6%95%99%e4%bd%a0%e4%bd%bf%e7%94%a8WebSocket%5b%e5%85%b6%e5%ae%9eWebSocket%e4%b9%9f%e4%b8%8d%e9%9a%be%5d"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">手摸手教你使用WebSocket[其实WebSocket也不难]</h1><div class="meta"><div class="postdate"><time datetime="2019-03-02" itemprop="datePublished">2019-03-02</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000016797888?w=1152\x26amp;h=720\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000016797888?w=1152\x26amp;h=720\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e在本篇文章之前，\x3ccode\x3eWebSocket\x3c\/code\x3e很多人听说过，没见过，没用过，以为是个很高大上的技术，实际上这个技术并不神秘，可以说是个很容易就能掌握的技术，希望在看完本文之后，马上把文中的栗子拿出来自己试一试，实践出真知。\x3c\/p\x3e\n\x3cblockquote\x3e游泳、健身了解一下：\x3ca href=\x22http:\/\/obkoro1.com\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e博客\x3c\/a\x3e、\x3ca href=\x22http:\/\/obkoro1.com\/web_accumulate\/accumulate\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e前端积累文档\x3c\/a\x3e、\x3ca href=\x22https:\/\/user-gold-cdn.xitu.io\/2018\/5\/1\/1631b6f52f7e7015?w=344\x26amp;h=344\x26amp;f=jpeg\x26amp;s=8317\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e公众号\x3c\/a\x3e、\x3ca href=\x22https:\/\/github.com\/OBKoro1\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eGitHub\x3c\/a\x3e\n\x3c\/blockquote\x3e\n\x3ch3 id=\x22articleHeader0\x22\x3e\n\x3ccode\x3eWebSocket\x3c\/code\x3e解决了什么问题：\x3c\/h3\x3e\n\x3cp\x3e客户端(浏览器)和服务器端进行通信，只能由客户端发起\x3ccode\x3eajax\x3c\/code\x3e请求，才能进行通信，服务器端无法主动向客户端推送信息。\x3c\/p\x3e\n\x3cp\x3e当出现类似体育赛事、聊天室、实时位置之类的场景时，客户端要获取服务器端的变化，就只能通过轮询(定时请求)来了解服务器端有没有新的信息变化。\x3c\/p\x3e\n\x3cblockquote\x3e轮询效率低，非常浪费资源(需要不断发送请求，不停链接服务器)\x3c\/blockquote\x3e\n\x3cp\x3e\x3cstrong\x3eWebSocket的出现，让服务器端可以主动向客户端发送信息，使得浏览器具备了实时双向通信的能力,这就是\x3ccode\x3eWebSocket\x3c\/code\x3e解决的问题\x3c\/strong\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3e一个超简单的栗子：\x3c\/h3\x3e\n\x3cp\x3e\x3cstrong\x3e新建一个\x3ccode\x3ehtml\x3c\/code\x3e文件，将本栗子找个地方跑一下试试，即可轻松入门\x3ccode\x3eWebSocket\x3c\/code\x3e：\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function socketConnect(url) {\n    \/\/ 客户端与服务器进行连接\n    let ws = new WebSocket(url); \/\/ 返回`WebSocket`对象，赋值给变量ws\n    \/\/ 连接成功回调\n    ws.onopen = e =\x3e {\n        console.log(\x27连接成功\x27, e)\n        ws.send(\x27我发送消息给服务端\x27); \/\/ 客户端与服务器端通信\n    }\n    \/\/ 监听服务器端返回的信息\n    ws.onmessage = e =\x3e {\n        console.log(\x27服务器端返回：\x27, e.data)\n        \/\/ do something\n    }\n    return ws; \/\/ 返回websocket对象\n}\nlet wsValue = socketConnect(\x27ws:\/\/121.40.165.18:8800\x27); \/\/ websocket对象\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3esocketConnect\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eurl\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 客户端与服务器进行连接\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e ws = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e WebSocket(url); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 返回`WebSocket`对象，赋值给变量ws\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 连接成功回调\x3c\/span\x3e\n    ws.onopen = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27连接成功\x27\x3c\/span\x3e, e)\n        ws.send(\x3cspan class=\x22hljs-string\x22\x3e\x27我发送消息给服务端\x27\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 客户端与服务器端通信\x3c\/span\x3e\n    }\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 监听服务器端返回的信息\x3c\/span\x3e\n    ws.onmessage = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27服务器端返回：\x27\x3c\/span\x3e, e.data)\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ do something\x3c\/span\x3e\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e ws; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 返回websocket对象\x3c\/span\x3e\n}\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e wsValue = socketConnect(\x3cspan class=\x22hljs-string\x22\x3e\x27ws:\/\/121.40.165.18:8800\x27\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ websocket对象\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e上述栗子中\x3ccode\x3eWebSocket\x3c\/code\x3e的接口地址出自：\x3ca href=\x22http:\/\/www.blue-zero.com\/WebSocket\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eWebSocket 在线测试\x3c\/a\x3e，在开发的时候也可以用于测试后端给的地址是否可用。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3ewebSocket的class类：\x3c\/h3\x3e\n\x3cp\x3e当项目中很多地方使用WebSocket，把它封成一个class类，是更好的选择。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e下面的栗子，做了非常详细的注释，建个html文件也可直接使用\x3c\/strong\x3e，websocket的常用\x3ccode\x3eAPI\x3c\/code\x3e都放进去了。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e下方注释的代码，先不用管，涉及到心跳机制，用于保持WebSocket连接的\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22class WebSocketClass {\n    \/**\n     * @description: 初始化实例属性，保存参数\n     * @param {String} url ws的接口\n     * @param {Function} msgCallback 服务器信息的回调传数据给函数\n     * @param {String} name 可选值 用于区分ws，用于debugger\n     *\/\n    constructor(url, msgCallback, name = \x27default\x27) {\n        this.url = url;\n        this.msgCallback = msgCallback;\n        this.name = name;\n        this.ws = null;  \/\/ websocket对象\n        this.status = null; \/\/ websocket是否关闭\n    }\n    \/**\n     * @description: 初始化 连接websocket或重连webSocket时调用\n     * @param {*} 可选值 要传的数据\n     *\/\n    connect(data) {\n        \/\/ 新建 WebSocket 实例\n        this.ws = new WebSocket(this.url);\n        this.ws.onopen = e =\x3e {\n            \/\/ 连接ws成功回调\n            this.status = \x27open\x27;\n            console.log(`${this.name}连接成功`, e)\n            \/\/ this.heartCheck();\n            if (data !== undefined) {\n                \/\/ 有要传的数据,就发给后端\n                return this.ws.send(data);\n            }\n        }\n        \/\/ 监听服务器端返回的信息\n        this.ws.onmessage = e =\x3e {\n            \/\/ 把数据传给回调函数，并执行回调\n            \/\/ if (e.data === \x27pong\x27) {\n            \/\/     this.pingPong = \x27pong\x27; \/\/ 服务器端返回pong,修改pingPong的状态\n            \/\/ }\n            return this.msgCallback(e.data);\n        }\n        \/\/ ws关闭回调\n        this.ws.onclose = e =\x3e {\n            this.closeHandle(e); \/\/ 判断是否关闭\n        }\n        \/\/ ws出错回调\n        this.onerror = e =\x3e {\n            this.closeHandle(e); \/\/ 判断是否关闭\n        }\n    }\n    \/\/ heartCheck() {\n    \/\/     \/\/ 心跳机制的时间可以自己与后端约定\n    \/\/     this.pingPong = \x27ping\x27; \/\/ ws的心跳机制状态值\n    \/\/     this.pingInterval = setInterval(() =\x3e {\n    \/\/         if (this.ws.readyState === 1) {\n    \/\/             \/\/ 检查ws为链接状态 才可发送\n    \/\/             this.ws.send(\x27ping\x27); \/\/ 客户端发送ping\n    \/\/         }\n    \/\/     }, 10000)\n    \/\/     this.pongInterval = setInterval(() =\x3e {\n    \/\/         this.pingPong = false;\n    \/\/         if (this.pingPong === \x27ping\x27) {\n    \/\/             this.closeHandle(\x27pingPong没有改变为pong\x27); \/\/ 没有返回pong 重启webSocket\n    \/\/         }\n    \/\/         \/\/ 重置为ping 若下一次 ping 发送失败 或者pong返回失败(pingPong不会改成pong)，将重启\n    \/\/         console.log(\x27返回pong\x27)\n    \/\/         this.pingPong = \x27ping\x27\n    \/\/     }, 20000)\n    \/\/ }\n    \/\/ 发送信息给服务器\n    sendHandle(data) {\n        console.log(`${this.name}发送消息给服务器:`, data)\n        return this.ws.send(data);\n    }\n    closeHandle(e = \x27err\x27) {\n        \/\/ 因为webSocket并不稳定，规定只能手动关闭(调closeMyself方法)，否则就重连\n        if (this.status !== \x27close\x27) {\n            console.log(`${this.name}断开，重连websocket`, e)\n            \/\/ if (this.pingInterval !== undefined \x26amp;\x26amp; this.pongInterval !== undefined) {\n            \/\/     \/\/ 清除定时器\n            \/\/     clearInterval(this.pingInterval);\n            \/\/     clearInterval(this.pongInterval);\n            \/\/ }\n            this.connect(); \/\/ 重连\n        } else {\n            console.log(`${this.name}websocket手动关闭`)\n        }\n    }\n    \/\/ 手动关闭WebSocket\n    closeMyself() {\n        console.log(`关闭${this.name}`)\n        this.status = \x27close\x27;\n        return this.ws.close();\n    }\n}\nfunction someFn(data) {\n    console.log(\x27接收服务器消息的回调：\x27, data);\n}\n\/\/ const wsValue = new WebSocketClass(\x27ws:\/\/121.40.165.18:8800\x27, someFn, \x27wsName\x27); \/\/ 这个链接一天只能发送消息50次\nconst wsValue = new WebSocketClass(\x27wss:\/\/echo.websocket.org\x27, someFn, \x27wsName\x27); \/\/ 阮一峰老师教程链接\nwsValue.connect(\x27立即与服务器通信\x27); \/\/ 连接服务器\n\/\/ setTimeout(() =\x3e {\n\/\/     wsValue.sendHandle(\x27传消息给服务器\x27)\n\/\/ }, 1000);\n\/\/ setTimeout(() =\x3e {\n\/\/     wsValue.closeMyself(); \/\/ 关闭ws\n\/\/ }, 10000)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eWebSocketClass\x3c\/span\x3e \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/**\n     * @description: 初始化实例属性，保存参数\n     * @param {String} url ws的接口\n     * @param {Function} msgCallback 服务器信息的回调传数据给函数\n     * @param {String} name 可选值 用于区分ws，用于debugger\n     *\/\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3econstructor\x3c\/span\x3e(url, msgCallback, name = \x27default\x27) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.url = url;\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.msgCallback = msgCallback;\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.name = name;\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.ws = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ websocket对象\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.status = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ websocket是否关闭\x3c\/span\x3e\n    }\n    \x3cspan class=\x22hljs-comment\x22\x3e\/**\n     * @description: 初始化 连接websocket或重连webSocket时调用\n     * @param {*} 可选值 要传的数据\n     *\/\x3c\/span\x3e\n    connect(data) {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 新建 WebSocket 实例\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.ws = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e WebSocket(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.url);\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.ws.onopen = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 连接ws成功回调\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.status = \x3cspan class=\x22hljs-string\x22\x3e\x27open\x27\x3c\/span\x3e;\n            \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e`\x3cspan class=\x22hljs-subst\x22\x3e${\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.name}\x3c\/span\x3e连接成功`\x3c\/span\x3e, e)\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ this.heartCheck();\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (data !== \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e) {\n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 有要传的数据,就发给后端\x3c\/span\x3e\n                \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.ws.send(data);\n            }\n        }\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 监听服务器端返回的信息\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.ws.onmessage = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 把数据传给回调函数，并执行回调\x3c\/span\x3e\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ if (e.data === \x27pong\x27) {\x3c\/span\x3e\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/     this.pingPong = \x27pong\x27; \/\/ 服务器端返回pong,修改pingPong的状态\x3c\/span\x3e\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ }\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.msgCallback(e.data);\n        }\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ws关闭回调\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.ws.onclose = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n            \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.closeHandle(e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 判断是否关闭\x3c\/span\x3e\n        }\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ws出错回调\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.onerror = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n            \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.closeHandle(e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 判断是否关闭\x3c\/span\x3e\n        }\n    }\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ heartCheck() {\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/     \/\/ 心跳机制的时间可以自己与后端约定\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/     this.pingPong = \x27ping\x27; \/\/ ws的心跳机制状态值\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/     this.pingInterval = setInterval(() =\x26gt; {\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/         if (this.ws.readyState === 1) {\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/             \/\/ 检查ws为链接状态 才可发送\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/             this.ws.send(\x27ping\x27); \/\/ 客户端发送ping\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/         }\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/     }, 10000)\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/     this.pongInterval = setInterval(() =\x26gt; {\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/         this.pingPong = false;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/         if (this.pingPong === \x27ping\x27) {\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/             this.closeHandle(\x27pingPong没有改变为pong\x27); \/\/ 没有返回pong 重启webSocket\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/         }\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/         \/\/ 重置为ping 若下一次 ping 发送失败 或者pong返回失败(pingPong不会改成pong)，将重启\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/         console.log(\x27返回pong\x27)\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/         this.pingPong = \x27ping\x27\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/     }, 20000)\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ }\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 发送信息给服务器\x3c\/span\x3e\n    sendHandle(data) {\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e`\x3cspan class=\x22hljs-subst\x22\x3e${\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.name}\x3c\/span\x3e发送消息给服务器:`\x3c\/span\x3e, data)\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.ws.send(data);\n    }\n    closeHandle(e = \x3cspan class=\x22hljs-string\x22\x3e\x27err\x27\x3c\/span\x3e) {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 因为webSocket并不稳定，规定只能手动关闭(调closeMyself方法)，否则就重连\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.status !== \x3cspan class=\x22hljs-string\x22\x3e\x27close\x27\x3c\/span\x3e) {\n            \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e`\x3cspan class=\x22hljs-subst\x22\x3e${\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.name}\x3c\/span\x3e断开，重连websocket`\x3c\/span\x3e, e)\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ if (this.pingInterval !== undefined \x26amp;\x26amp; this.pongInterval !== undefined) {\x3c\/span\x3e\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/     \/\/ 清除定时器\x3c\/span\x3e\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/     clearInterval(this.pingInterval);\x3c\/span\x3e\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/     clearInterval(this.pongInterval);\x3c\/span\x3e\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ }\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.connect(); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 重连\x3c\/span\x3e\n        } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n            \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e`\x3cspan class=\x22hljs-subst\x22\x3e${\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.name}\x3c\/span\x3ewebsocket手动关闭`\x3c\/span\x3e)\n        }\n    }\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 手动关闭WebSocket\x3c\/span\x3e\n    closeMyself() {\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e`关闭\x3cspan class=\x22hljs-subst\x22\x3e${\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.name}\x3c\/span\x3e`\x3c\/span\x3e)\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.status = \x3cspan class=\x22hljs-string\x22\x3e\x27close\x27\x3c\/span\x3e;\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.ws.close();\n    }\n}\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3esomeFn\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27接收服务器消息的回调：\x27\x3c\/span\x3e, data);\n}\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ const wsValue = new WebSocketClass(\x27ws:\/\/121.40.165.18:8800\x27, someFn, \x27wsName\x27); \/\/ 这个链接一天只能发送消息50次\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e wsValue = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e WebSocketClass(\x3cspan class=\x22hljs-string\x22\x3e\x27wss:\/\/echo.websocket.org\x27\x3c\/span\x3e, someFn, \x3cspan class=\x22hljs-string\x22\x3e\x27wsName\x27\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 阮一峰老师教程链接\x3c\/span\x3e\nwsValue.connect(\x3cspan class=\x22hljs-string\x22\x3e\x27立即与服务器通信\x27\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 连接服务器\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ setTimeout(() =\x26gt; {\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/     wsValue.sendHandle(\x27传消息给服务器\x27)\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ }, 1000);\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ setTimeout(() =\x26gt; {\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/     wsValue.closeMyself(); \/\/ 关闭ws\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ }, 10000)\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e栗子里面我直接写在了一起，可以把\x3ccode\x3eclass\x3c\/code\x3e放在一个js文件里面,\x3ccode\x3eexport\x3c\/code\x3e出去，然后在需要用的地方再\x3ccode\x3eimport\x3c\/code\x3e进来，把参数传进去就可以用了。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3eWebSocket不稳定\x3c\/h2\x3e\n\x3cp\x3eWebSocket并不稳定，在使用一段时间后，可能会断开连接，貌似至今没有一个为何会断开连接的公论，所以我们需要让WebSocket保持连接状态，这里推荐两种方法。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3eWebSocket设置变量，判断是否手动关闭连接：\x3c\/h3\x3e\n\x3cp\x3e\x3cstrong\x3e\x3ccode\x3eclass\x3c\/code\x3e类中就是用的这种方式\x3c\/strong\x3e:设置一个变量，在webSocket关闭\/报错的回调中，判断是不是手动关闭的，如果不是的话，就重新连接，这样做的优缺点如下：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e优点：请求较少(相对于心跳连接)，易设置。\x3c\/li\x3e\n\x3cli\x3e缺点：可能会导致丢失数据,在断开重连的这段时间中，恰好双方正在通信。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3eWebSocket心跳机制：\x3c\/h3\x3e\n\x3cblockquote\x3e因为第一种方案的缺点，并且可能会有其他一些未知情况导致断开连接而没有触发Error或Close事件。这样就导致实际连接已经断开了，而客户端和服务端却不知道，还在傻傻的等着消息来。\x3c\/blockquote\x3e\n\x3cp\x3e然后聪明的程序猿们想出了一种叫做\x3cstrong\x3e心跳机制\x3c\/strong\x3e的解决方法：\x3c\/p\x3e\n\x3cp\x3e客户端就像心跳一样每隔固定的时间发送一次\x3ccode\x3eping\x3c\/code\x3e，来告诉服务器，我还活着，而服务器也会返回\x3ccode\x3epong\x3c\/code\x3e，来告诉客户端，服务器还活着。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e具体的实现方法，在上面\x3ccode\x3eclass\x3c\/code\x3e的注释中，将其打开，即可看到效果\x3c\/strong\x3e。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3e关于WebSocket\x3c\/h2\x3e\n\x3cp\x3e怕一开始就堆太多文字性的内容，把各位吓跑了，现在大家已经会用了，我们再回头来看看WebSocket的其他知识点。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3eWebSocket的当前状态:\x3ccode\x3eWebSocket.readyState\x3c\/code\x3e\n\x3c\/h3\x3e\n\x3cp\x3e下面是\x3ccode\x3eWebSocket.readyState\x3c\/code\x3e的四个值(四种状态)：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e0: 表示正在连接\x3c\/li\x3e\n\x3cli\x3e1: 表示连接成功，可以通信了\x3c\/li\x3e\n\x3cli\x3e2: 表示连接正在关闭\x3c\/li\x3e\n\x3cli\x3e3: 表示连接已经关闭，或者打开连接失败\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e我们可以利用当前状态来做一些事情，比如上面栗子中当WebSocket链接成功后，才允许客户端发送\x3ccode\x3eping\x3c\/code\x3e。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22if (this.ws.readyState === 1) {\n    \/\/ 检查ws为链接状态 才可发送\n    this.ws.send(\x27ping\x27); \/\/ 客户端发送ping\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.ws.readyState === \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 检查ws为链接状态 才可发送\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.ws.send(\x3cspan class=\x22hljs-string\x22\x3e\x27ping\x27\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 客户端发送ping\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader8\x22\x3e\n\x3ccode\x3eWebSocket\x3c\/code\x3e还可以发送\/接收 二进制数据\x3c\/h3\x3e\n\x3cp\x3e这里我也没有试过，我是看阮一峰老师的\x3ca href=\x22http:\/\/www.ruanyifeng.com\/blog\/2017\/05\/websocket.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eWebSocket教程\x3c\/a\x3e才知道有这么个东西，有兴趣的可以再去谷歌，大家知道一下就可以。\x3c\/p\x3e\n\x3cp\x3e二进制数据包括：\x3ccode\x3eblob\x3c\/code\x3e对象和\x3ccode\x3eArraybuffer\x3c\/code\x3e对象，所以我们需要分开来处理。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    \/\/ 接收数据\nws.onmessage = function(event){\n    if(event.data instanceof ArrayBuffer){\n        \/\/ 判断 ArrayBuffer 对象\n    }\n    \n    if(event.data instanceof Blob){\n        \/\/ 判断 Blob 对象\n    }\n}\n\n\/\/ 发送 Blob 对象的例子\nlet file = document.querySelector(\x27input[type=\x26quot;file\x26quot;]\x27).files[0];\nws.send(file);\n\n\/\/ 发送 ArrayBuffer 对象的例子\nvar img = canvas_context.getImageData(0, 0, 400, 320);\nvar binary = new Uint8Array(img.data.length);\nfor (var i = 0; i \x3c img.data.length; i\x2b\x2b) {\n    binary[i] = img.data[i];\n}\nws.send(binary.buffer);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 接收数据\x3c\/span\x3e\nws.onmessage = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eevent\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(event.data \x3cspan class=\x22hljs-keyword\x22\x3einstanceof\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eArrayBuffer\x3c\/span\x3e){\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 判断 ArrayBuffer 对象\x3c\/span\x3e\n    }\n    \n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(event.data \x3cspan class=\x22hljs-keyword\x22\x3einstanceof\x3c\/span\x3e Blob){\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 判断 Blob 对象\x3c\/span\x3e\n    }\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 发送 Blob 对象的例子\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e file = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.querySelector(\x3cspan class=\x22hljs-string\x22\x3e\x27input[type=\x22file\x22]\x27\x3c\/span\x3e).files[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e];\nws.send(file);\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 发送 ArrayBuffer 对象的例子\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e img = canvas_context.getImageData(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e400\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e320\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e binary = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eUint8Array\x3c\/span\x3e(img.data.length);\n\x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; img.data.length; i\x2b\x2b) {\n    binary[i] = img.data[i];\n}\nws.send(binary.buffer);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e如果你要发送的二进制数据很大的话，如何判断发送完毕：\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3ewebSocket.bufferedAmount\x3c\/code\x3e属性，表示还有多少字节的二进制数据没有发送出去：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var data = new ArrayBuffer(10000000);\nsocket.send(data);\nif (socket.bufferedAmount === 0) {\n    \/\/ 发送完毕\n} else {\n    \/\/ 发送还没结束\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e data = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eArrayBuffer\x3c\/span\x3e(\x3cspan class=\x22hljs-number\x22\x3e10000000\x3c\/span\x3e);\nsocket.send(data);\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (socket.bufferedAmount === \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 发送完毕\x3c\/span\x3e\n} \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 发送还没结束\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e上述栗子出自阮一峰老师的\x3ca href=\x22http:\/\/www.ruanyifeng.com\/blog\/2017\/05\/websocket.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eWebSocket教程\x3c\/a\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader9\x22\x3eWebSocket的优点：\x3c\/h3\x3e\n\x3cp\x3e最后再吹一波WebSocket：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e双向通信(一开始说的，也是最重要的一点)。\x3c\/li\x3e\n\x3cli\x3e数据格式比较轻量，性能开销小，通信高效\x3cp\x3e协议控制的数据包头部较小，而HTTP协议每次通信都需要携带完整的头部\x3c\/p\x3e\n\x3c\/li\x3e\n\x3cli\x3e更好的二进制支持\x3c\/li\x3e\n\x3cli\x3e没有同源限制，客户端可以与任意服务器通信\x3c\/li\x3e\n\x3cli\x3e与 HTTP 协议有着良好的兼容性。默认端口也是80和443，并且握手阶段采用 HTTP 协议，因此握手时不容易屏蔽，能通过各种 HTTP 代理服务器\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3chr\x3e\n\x3ch2 id=\x22articleHeader10\x22\x3e结语\x3c\/h2\x3e\n\x3cp\x3e看了本文之后，如果还是有点迷糊的话，一定要把文中的两个栗子，新建个html文件跑起来，自己鼓捣鼓捣一下。不然读多少博客\/教程都没有用，实践才出真知，切勿纸上谈兵。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader11\x22\x3e希望看完的朋友可以点个喜欢\/关注，您的支持是对我最大的鼓励。\x3c\/h3\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/obkoro1.com\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e博客\x3c\/a\x3e、\x3ca href=\x22http:\/\/obkoro1.com\/web_accumulate\/accumulate\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e前端积累文档\x3c\/a\x3e、\x3ca href=\x22https:\/\/user-gold-cdn.xitu.io\/2018\/5\/1\/1631b6f52f7e7015?w=344\x26amp;h=344\x26amp;f=jpeg\x26amp;s=8317\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e公众号\x3c\/a\x3e、\x3ca href=\x22https:\/\/github.com\/OBKoro1\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eGitHub\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e以上2018.10.22\x3c\/p\x3e\n\x3cp\x3e参考资料：\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/www.ruanyifeng.com\/blog\/2017\/05\/websocket.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eWebSocket 教程\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/www.cnblogs.com\/tugenhua0707\/p\/8648044.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e理解WebSocket心跳及重连机制\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/www.cnblogs.com\/chyingp\/p\/websocket-deep-in.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eWebSocket协议：5分钟从入门到精通\x3c\/a\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>手摸手教你使用WebSocket[其实WebSocket也不难]</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000016797885">https://segmentfault.com/a/1190000016797885</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/dtm6hp4hfru/" target="_blank">https://alili.tech/archive/dtm6hp4hfru/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/a5ficy1jp7n/">2019年03月Github Javascript开源项目精选<aside class="dates">2019-03-08</aside></a></li><li><a href="/archive/304a32r2py8/">30分钟精通React今年最劲爆的新特性——React Hooks<aside class="dates">2019-03-02</aside></a></li><li><a href="/archive/sj4oqgzx0rk/">CSS6：flex布局<aside class="dates">2019-03-02</aside></a></li><li><a href="/archive/wedm7eypuhb/">ES6 系列之 Babel 将 Async 编译成了什么样子<aside class="dates">2019-03-02</aside></a></li><li><a href="/archive/cazifdrck0u/">ES6 系列之我们来聊聊 Async<aside class="dates">2019-03-02</aside></a></li><li><a href="/archive/0dlsi4qmvsvf/">Express的基本使用<aside class="dates">2019-03-02</aside></a></li><li><a href="/archive/183cav6qpdb/">JavaScript常用八种继承方案<aside class="dates">2019-03-02</aside></a></li><li><a href="/archive/5tpnsqmgslq/">React 手稿 - Component state<aside class="dates">2019-03-02</aside></a></li><li><a href="/archive/0h3zalrcolvo/">React.memo<aside class="dates">2019-03-02</aside></a></li><li><a href="/archive/3e7xkoz9of6/">WEB站点性能优化实践<aside class="dates">2019-03-02</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>