---
title: '前端小项目之在线便利贴' 
date: 2018-12-31 2:30:30
hidden: true
slug: ne9dyo0r5gd
categories: [reprint]
---

{{< raw >}}

                    
<h2 id="articleHeader0">实现的效果如下：</h2>
<p><span class="img-wrap"><img data-src="/img/remote/1460000011155402" src="https://static.alili.tech/img/remote/1460000011155402" alt="" title="" style="cursor: pointer; display: inline;"></span></p>
<p>界面可能不是太好看?，考虑到容器的高度会被拉长，因此没有用图片做背景。</p>
<h2 id="articleHeader1">预览</h2>
<p><a href="http://note.shenzekun.cn" rel="nofollow noreferrer" target="_blank">便利贴</a></p>
<h2 id="articleHeader2">涉及的知识点</h2>
<ul>
<li>
<code>sass</code>(css 预编译器)</li>
<li>
<code>webpack</code>（自动化构建工具，实现LESS,CSS,JS编译和压缩代码）</li>
<li>
<code>express</code> (基于 Node.js 平台的 web 开发框架)</li>
<li><code>html+css</code></li>
<li>
<code>Node.js</code>(基于 Chrome V8 引擎的 JavaScript 运行环境)</li>
<li>
<code>jQuery</code>(一个快速、简洁的JavaScript框架)</li>
<li>
<code>sequelize</code>(Node的ORM框架Sequelize操作数据库)</li>
<li>
<code>passport</code>(实现第三方登录)</li>
</ul>
<h2 id="articleHeader3">实现功能</h2>
<ul>
<li>github第三方登录</li>
<li>添加笔记（登录成功后）</li>
<li>删除笔记</li>
<li>修改笔记</li>
<li>使用 markdown(类似 typroa)</li>
<li>笔记拖拽</li>
</ul>
<h2 id="articleHeader4">准备工作</h2>
<ul>
<li>
<strong>必要条件</strong>：已经安装好了node环境,还没安装的可以去<a href="http://nodejs.cn/download/" rel="nofollow noreferrer" target="_blank">node</a>中文官网下载</li>
<li>
<strong>小提示</strong>：如果用 npm 下载感觉慢的话，可以下载一个切换镜像源的工具<code>nrm</code>,在终端输入：</li>
</ul>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="npm i nrm -g" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs stylus"><code style="word-break: break-word; white-space: initial;">npm <span class="hljs-selector-tag">i</span> nrm -g</code></pre>
<p>然后如下操作：</p>
<p><span class="img-wrap"><img data-src="/img/remote/1460000011155403" src="https://static.alili.tech/img/remote/1460000011155403" alt="" title="" style="cursor: pointer;"></span></p>
<p><strong>开始！！</strong></p>
<p>1.<strong>新建一个文件夹，名字自己起，打开终端，切换到自己新建文件夹，如</strong>：</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="cd (文件夹名称)" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs bash"><code style="word-break: break-word; white-space: initial;"><span class="hljs-built_in">cd</span> (文件夹名称)</code></pre>
<p>2.<strong>生成 <code>package.json</code></strong></p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="npm init -y" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs coffeescript"><code style="word-break: break-word; white-space: initial;"><span class="hljs-built_in">npm</span> init -y</code></pre>
<p>3.<strong>安装 express</strong></p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="npm i express --save" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs maxima"><code style="word-break: break-word; white-space: initial;">npm i <span class="hljs-built_in">express</span> --<span class="hljs-built_in">save</span></code></pre>
<p>4.<strong>安装 <a href="http://www.expressjs.com.cn/starter/generator.html" rel="nofollow noreferrer" target="_blank">express生成器</a>:</strong></p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="npm install express-generator --save" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs maxima"><code style="word-break: break-word; white-space: initial;">npm install <span class="hljs-built_in">express</span>-generator --<span class="hljs-built_in">save</span></code></pre>
<p>5.<strong>生成 ejs 模板（类似 jsp 的写法）</strong></p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="express -f -e
npm i" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs bash"><code>express <span class="hljs-_">-f</span> <span class="hljs-_">-e</span>
npm i</code></pre>
<p><span class="img-wrap"><img data-src="/img/remote/1460000011155404" src="https://static.alili.tech/img/remote/1460000011155404" alt="" title="" style="cursor: pointer; display: inline;"></span></p>
<p>其中<code>public</code>用来存放编译后的js文件以及编译好的css文件等，<code>routes</code>用来存放处理 ajax 的请求文件，views就是存放视图文件<br>然后新建 database 和 src：</p>
<p><span class="img-wrap"><img data-src="/img/remote/1460000011155405" src="https://static.alili.tech/img/remote/1460000011155405" alt="" title="" style="cursor: pointer; display: inline;"></span></p>
<p>其中 src/js 里面 app 代表不同页面的入口文件，lib 就是一些常用的库，mod 就是你写的一些模块，database 用来存放数据库数据的</p>
<p>6.<strong>输入：</strong></p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="npm start" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs coffeescript"><code style="word-break: break-word; white-space: initial;"><span class="hljs-built_in">npm</span> start</code></pre>
<p>如果有出现下面的错误：</p>
<p><span class="img-wrap"><img data-src="/img/remote/1460000011155406" src="https://static.alili.tech/img/remote/1460000011155406" alt="" title="" style="cursor: pointer; display: inline;"></span></p>
<p>出现这个错误是因为你没有下载模块，只需在终端输入：</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="npm i (模块名) --save" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs stylus"><code style="word-break: break-word; white-space: initial;">npm <span class="hljs-selector-tag">i</span> (模块名) --save</code></pre>
<p>就可以了    </p>
<p>7.<strong>打开浏览器，输入<code>localhost:3000</code></strong><br>出现下面这样就说明成功了：</p>
<p><span class="img-wrap"><img data-src="/img/remote/1460000011155407" src="https://static.alili.tech/img/remote/1460000011155407" alt="" title="" style="cursor: pointer;"></span></p>
<p>8.<strong>接下来安装webpack和相关依赖</strong></p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="npm i webpack --save-dev
npm i --save css-loader style-loader express-session express-flash node-sass passport sass sass-loader sequelize sqlite3 extract-text-webpack-plugin onchange" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs maxima"><code>npm i webpack --<span class="hljs-built_in">save</span>-dev
npm i --<span class="hljs-built_in">save</span> css-loader <span class="hljs-built_in">style</span>-loader <span class="hljs-built_in">express</span>-session <span class="hljs-built_in">express</span>-flash node-sass passport sass sass-loader sequelize sqlite3 extract-text-webpack-plugin onchange</code></pre>
<p>9.<strong>在 src 里建一个 webpack.config.js，配置如下</strong>：</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="var webpack = require('webpack');
var path = require('path');
var ExtractTextPlugin = require('extract-text-webpack-plugin')
var autoprefixer = require('autoprefixer');
    
module.exports = {
    entry: path.join(__dirname, &quot;js/app/index&quot;),
    output: {
        path: path.join(__dirname, &quot;../public&quot;),
        filename: &quot;js/index.js&quot;
    },
    module: {
        rules: [{
            test: /(\.scss)$/,
            use: ExtractTextPlugin.extract({
                fallback: &quot;style-loader&quot;,
                use: [&quot;css-loader&quot;, &quot;sass-loader&quot;]
            }) //把 css 抽离出来生成一个文件
        }]
    },
    resolve: {
        alias: {
            jquery: path.join(__dirname, &quot;js/lib/jquery-2.0.3.min.js&quot;),
            mod: path.join(__dirname, &quot;js/mod&quot;),
            sass: path.join(__dirname, &quot;sass&quot;)
        }
    },
    plugins: [
        new webpack.ProvidePlugin({
            $: &quot;jquery&quot;
        }),
        new ExtractTextPlugin(&quot;css/index.css&quot;),
        new webpack.LoaderOptionsPlugin({
            options: {
                css: [
                    autoprefixer(),
                ]
            }
        }),
        new webpack.optimize.UglifyJsPlugin({
            compress: {
                warnings: false
            }
        })
    ]
}" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs typescript"><code><span class="hljs-keyword">var</span> webpack = <span class="hljs-built_in">require</span>(<span class="hljs-string">'webpack'</span>);
<span class="hljs-keyword">var</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
<span class="hljs-keyword">var</span> ExtractTextPlugin = <span class="hljs-built_in">require</span>(<span class="hljs-string">'extract-text-webpack-plugin'</span>)
<span class="hljs-keyword">var</span> autoprefixer = <span class="hljs-built_in">require</span>(<span class="hljs-string">'autoprefixer'</span>);
    
<span class="hljs-built_in">module</span>.exports = {
    entry: path.join(__dirname, <span class="hljs-string">"js/app/index"</span>),
    output: {
        path: path.join(__dirname, <span class="hljs-string">"../public"</span>),
        filename: <span class="hljs-string">"js/index.js"</span>
    },
    <span class="hljs-keyword">module</span>: {
        rules: [{
            test: <span class="hljs-regexp">/(\.scss)$/</span>,
            use: ExtractTextPlugin.extract({
                fallback: <span class="hljs-string">"style-loader"</span>,
                use: [<span class="hljs-string">"css-loader"</span>, <span class="hljs-string">"sass-loader"</span>]
            }) <span class="hljs-comment">//把 css 抽离出来生成一个文件</span>
        }]
    },
    resolve: {
        alias: {
            jquery: path.join(__dirname, <span class="hljs-string">"js/lib/jquery-2.0.3.min.js"</span>),
            mod: path.join(__dirname, <span class="hljs-string">"js/mod"</span>),
            sass: path.join(__dirname, <span class="hljs-string">"sass"</span>)
        }
    },
    plugins: [
        <span class="hljs-keyword">new</span> webpack.ProvidePlugin({
            $: <span class="hljs-string">"jquery"</span>
        }),
        <span class="hljs-keyword">new</span> ExtractTextPlugin(<span class="hljs-string">"css/index.css"</span>),
        <span class="hljs-keyword">new</span> webpack.LoaderOptionsPlugin({
            options: {
                css: [
                    autoprefixer(),
                ]
            }
        }),
        <span class="hljs-keyword">new</span> webpack.optimize.UglifyJsPlugin({
            compress: {
                warnings: <span class="hljs-literal">false</span>
            }
        })
    ]
}</code></pre>
<p>说明</p>
<ul>
<li>entry:入口文件，也就是 src/js/app里面的index.js,其中__dirname是获得当前文件所在目录的完整目录名</li>
<li>output:输出编译后的文件 index.js，输出到 public/js 里面</li>
<li>module：配置Loaders，通过使用不同的loader，webpack有能力调用外部的脚本或工具，实现对不同格式的文件的处理，比如说分析转换scss为css，或者把下一代的JS文件</li>
<li>resolve.alias：设置模块别名，便于我们更方便引用，比如说我在 js里面的文件需要 jquery，在里面的文件直接写 require("jquery") 就行了</li>
<li>如果所有文件都需要 jquery,那么直接在 plugins里面写成这样：</li>
</ul>
<p><span class="img-wrap"><img data-src="/img/remote/1460000011155408" src="https://static.alili.tech/img/remote/1460000011155408" alt="" title="" style="cursor: pointer; display: inline;"></span></p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="
就不需要 require 了
" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs armasm"><code>
就不需要 <span class="hljs-meta">require</span> 了
</code></pre>
<p><span class="img-wrap"><img data-src="/img/remote/1460000011155656" src="https://static.alili.tech/img/remote/1460000011155656" alt="" title="" style="cursor: pointer; display: inline;"></span><br>   这个是压缩文件的</p>
<p>10.<strong>在 package.json 中，增加如下两条：</strong></p>
<p><span class="img-wrap"><img data-src="/img/remote/1460000011155409" src="https://static.alili.tech/img/remote/1460000011155409" alt="" title="" style="cursor: pointer; display: inline;"></span></p>
<p>写成这样，你在终端就可以写成<code>npm run webpack</code> 来编译文件，<br><code>npm run watch</code>来监控 src 里面的 js 和 scss 的变化，只要一修改，进行编译，提高了效率</p>
<p>11.<strong>测试</strong></p>
<p>你可以试试在 js 里面的 index.js写点东西，然后 npm run webpack，如果终端显示是这样：</p>
<p><span class="img-wrap"><img data-src="/img/remote/1460000011155410" src="https://static.alili.tech/img/remote/1460000011155410" alt="" title="" style="cursor: pointer;"></span></p>
<p>就证明成功了</p>
<h2 id="articleHeader5">项目思路</h2>
<p>逻辑比较简单</p>
<ol>
<li>首先用户必须登录才能添加笔记，当用户失焦的时候，将数据插入数据库，并且重新布局（瀑布流）</li>
<li>用户不能更改其他用户的笔记，除了管理员?</li>
<li>用户更新笔记之后，数据库的数据重新更新，重新布局</li>
<li>用户可以删除笔记，数据从数据库中删除，重新布局</li>
<li>用户可以拖拽笔记，但不将位置存入数据库</li>
</ol>
<h2 id="articleHeader6">实现</h2>
<p>html,css就不讲了，可以看看我的<a href="https://github.com/shenzekun/sticky-note" rel="nofollow noreferrer" target="_blank">源码</a>,主要讲 js。</p>
<p>1.<strong>瀑布流的实现</strong></p>
<p>思路：（前提是必须绝对定位）</p>
<blockquote><ol>
<li>获取元素的宽度</li>
<li>通过窗口的宽度除以元素的宽度来获取列数</li>
<li>初始化一个数组来获取每列的高度，初始化每列的高度为0</li>
<li><p>遍历元素，获取最小的的列数的高度和索引，对当前元素进行定位，列数高度加等于当前元素的高度</p></li>
</ol></blockquote>
<p>知道思路后，代码很快就写出来了：</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="var WaterFall = (function () {
        var $ct, $items;
        function render($c) {
            $ct = $c;
            $items = $ct.children();
            var nodeWidth = $items.outerWidth(true),
                windowHeight = $(window).height(),
                colNum = parseInt($(window).width() / nodeWidth), //获取列数
                colSumHeight = []; //获取每列的高度
            //对每列的高度进行初始化
            for (var i = 0; i < colNum; i++) {
                colSumHeight[i] = 0;
            }
            $items.each(function () {
                var $current = $(this);
                var index = 0,
                    minSumHeight = colSumHeight[0];
                //获取最小的的列数的高度和索引
                for (var i = 0; i < colSumHeight.length; i++) {
                    if (minSumHeight > colSumHeight[i]) {
                        index = i;
                        minSumHeight = colSumHeight[i];
                    }
                }            
                //改变窗口高度
                if (windowHeight < minSumHeight) {
                    $(&quot;body&quot;).height(minSumHeight);
                } else {
                    $(&quot;body&quot;).height(windowHeight - 72);
                }
                //对当前元素进行定位
                $current.animate({
                    left: nodeWidth * index,
                    top: minSumHeight
                }, 5);
                colSumHeight[index] += $current.outerHeight(true);
    
            });
        }
        //当窗口发生变化时，重新渲染
        $(window).on('resize', function () {
            render($ct);
        });
        return {
            init: render
        }
    })();" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs php"><code><span class="hljs-keyword">var</span> WaterFall = (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> $ct, $items;
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">render</span><span class="hljs-params">($c)</span> </span>{
            $ct = $c;
            $items = $ct.children();
            <span class="hljs-keyword">var</span> nodeWidth = $items.outerWidth(<span class="hljs-keyword">true</span>),
                windowHeight = $(window).height(),
                colNum = parseInt($(window).width() / nodeWidth), <span class="hljs-comment">//获取列数</span>
                colSumHeight = []; <span class="hljs-comment">//获取每列的高度</span>
            <span class="hljs-comment">//对每列的高度进行初始化</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; colNum; i++) {
                colSumHeight[i] = <span class="hljs-number">0</span>;
            }
            $items.each(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                <span class="hljs-keyword">var</span> $current = $(this);
                <span class="hljs-keyword">var</span> index = <span class="hljs-number">0</span>,
                    minSumHeight = colSumHeight[<span class="hljs-number">0</span>];
                <span class="hljs-comment">//获取最小的的列数的高度和索引</span>
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; colSumHeight.length; i++) {
                    <span class="hljs-keyword">if</span> (minSumHeight &gt; colSumHeight[i]) {
                        index = i;
                        minSumHeight = colSumHeight[i];
                    }
                }            
                <span class="hljs-comment">//改变窗口高度</span>
                <span class="hljs-keyword">if</span> (windowHeight &lt; minSumHeight) {
                    $(<span class="hljs-string">"body"</span>).height(minSumHeight);
                } <span class="hljs-keyword">else</span> {
                    $(<span class="hljs-string">"body"</span>).height(windowHeight - <span class="hljs-number">72</span>);
                }
                <span class="hljs-comment">//对当前元素进行定位</span>
                $current.animate({
                    left: nodeWidth * index,
                    top: minSumHeight
                }, <span class="hljs-number">5</span>);
                colSumHeight[index] += $current.outerHeight(<span class="hljs-keyword">true</span>);
    
            });
        }
        <span class="hljs-comment">//当窗口发生变化时，重新渲染</span>
        $(window).on(<span class="hljs-string">'resize'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
            render($ct);
        });
        <span class="hljs-keyword">return</span> {
            init: render
        }
    })();</code></pre>
<p>2.<strong>笔记的拖拽</strong></p>
<p>我们先看个图</p>
<p><span class="img-wrap"><img data-src="/img/remote/1460000011155411" src="https://static.alili.tech/img/remote/1460000011155411" alt="" title="" style="cursor: pointer; display: inline;"></span></p>
<p>因此代码如下：</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="      //设置笔记的移动
            $noteHead.on('mousedown', function (e) {
                var evtX = e.pageX - $note.offset().left, //evtX 计算事件的触发点在 dialog内部到 dialog 的左边缘的距离
                    evtY = e.pageY - $note.offset().top;
                $note.addClass('draggable').data('evtPos', {
                    x: evtX,
                    y: evtY
                }); //把事件到 dialog 边缘的距离保存下来
            }).on('mouseup', function () {
                $note.removeClass('draggable').removeData('pos');
            });
    
            $('body').on('mousemove', function (e) {
                $('.draggable').length &amp;&amp; $('.draggable').offset({
                    top: e.pageY - $('.draggable').data('evtPos').y, // 当用户鼠标移动时，根据鼠标的位置和前面保存的距离，计算 dialog 的绝对位置
                    left: e.pageX - $('.draggable').data('evtPos').x
                });
            });
        }," title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs javascript"><code>      <span class="hljs-comment">//设置笔记的移动</span>
            $noteHead.on(<span class="hljs-string">'mousedown'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
                <span class="hljs-keyword">var</span> evtX = e.pageX - $note.offset().left, <span class="hljs-comment">//evtX 计算事件的触发点在 dialog内部到 dialog 的左边缘的距离</span>
                    evtY = e.pageY - $note.offset().top;
                $note.addClass(<span class="hljs-string">'draggable'</span>).data(<span class="hljs-string">'evtPos'</span>, {
                    <span class="hljs-attr">x</span>: evtX,
                    <span class="hljs-attr">y</span>: evtY
                }); <span class="hljs-comment">//把事件到 dialog 边缘的距离保存下来</span>
            }).on(<span class="hljs-string">'mouseup'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                $note.removeClass(<span class="hljs-string">'draggable'</span>).removeData(<span class="hljs-string">'pos'</span>);
            });
    
            $(<span class="hljs-string">'body'</span>).on(<span class="hljs-string">'mousemove'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
                $(<span class="hljs-string">'.draggable'</span>).length &amp;&amp; $(<span class="hljs-string">'.draggable'</span>).offset({
                    <span class="hljs-attr">top</span>: e.pageY - $(<span class="hljs-string">'.draggable'</span>).data(<span class="hljs-string">'evtPos'</span>).y, <span class="hljs-comment">// 当用户鼠标移动时，根据鼠标的位置和前面保存的距离，计算 dialog 的绝对位置</span>
                    left: e.pageX - $(<span class="hljs-string">'.draggable'</span>).data(<span class="hljs-string">'evtPos'</span>).x
                });
            });
        },</code></pre>
<p>3.<strong>提示模块</strong></p>
<p>这个比较容易：</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="    /* 
    提示模块
    参数：状态(1表示成功，0表示失败)，消息，出现时间(不写默认是1s)
     */
    function toast(status, msg, time) {
        this.status = status;
        this.msg = msg;
        this.time = time || 1000;
        this.createToast();
        this.showToast();
    }
    
    toast.prototype = {
        createToast: function () {
            if (this.status === 1) {
                var html = '<div class=&quot;toast&quot;>![](../../imgs/1.png)</img><span class=&quot;toast_word&quot;>' + this.msg + '</span></div>';
                this.$toast = $(html);
                $('body').append(this.$toast);
            } else {
                var html = '<div class=&quot;toast&quot;>![](../../imgs/0.png)</img><span class=&quot;toast_word&quot;>' + this.msg + '</span></div>';
                this.$toast = $(html);
                $('body').append(this.$toast);
            }
        },
        showToast: function () {
            var _this = this;
            this.$toast.fadeIn(300, function () {
                setTimeout(function () {
                    _this.$toast.fadeOut(300, function () {
                        _this.$toast.remove();
                    });
                }, _this.time);
            })
        }
    }
    
    function Toast(status, msg, time) {
        return new toast(status, msg, time);
    }" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs javascript"><code>    <span class="hljs-comment">/* 
    提示模块
    参数：状态(1表示成功，0表示失败)，消息，出现时间(不写默认是1s)
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">toast</span>(<span class="hljs-params">status, msg, time</span>) </span>{
        <span class="hljs-keyword">this</span>.status = status;
        <span class="hljs-keyword">this</span>.msg = msg;
        <span class="hljs-keyword">this</span>.time = time || <span class="hljs-number">1000</span>;
        <span class="hljs-keyword">this</span>.createToast();
        <span class="hljs-keyword">this</span>.showToast();
    }
    
    toast.prototype = {
        <span class="hljs-attr">createToast</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.status === <span class="hljs-number">1</span>) {
                <span class="hljs-keyword">var</span> html = <span class="hljs-string">'&lt;div class="toast"&gt;![](../../imgs/1.png)&lt;/img&gt;&lt;span class="toast_word"&gt;'</span> + <span class="hljs-keyword">this</span>.msg + <span class="hljs-string">'&lt;/span&gt;&lt;/div&gt;'</span>;
                <span class="hljs-keyword">this</span>.$toast = $(html);
                $(<span class="hljs-string">'body'</span>).append(<span class="hljs-keyword">this</span>.$toast);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">var</span> html = <span class="hljs-string">'&lt;div class="toast"&gt;![](../../imgs/0.png)&lt;/img&gt;&lt;span class="toast_word"&gt;'</span> + <span class="hljs-keyword">this</span>.msg + <span class="hljs-string">'&lt;/span&gt;&lt;/div&gt;'</span>;
                <span class="hljs-keyword">this</span>.$toast = $(html);
                $(<span class="hljs-string">'body'</span>).append(<span class="hljs-keyword">this</span>.$toast);
            }
        },
        <span class="hljs-attr">showToast</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">var</span> _this = <span class="hljs-keyword">this</span>;
            <span class="hljs-keyword">this</span>.$toast.fadeIn(<span class="hljs-number">300</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                    _this.$toast.fadeOut(<span class="hljs-number">300</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                        _this.$toast.remove();
                    });
                }, _this.time);
            })
        }
    }
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Toast</span>(<span class="hljs-params">status, msg, time</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> toast(status, msg, time);
    }</code></pre>
<p>4.<strong>笔记模块</strong></p>
<p>思路：</p>
<blockquote><ol>
<li>初始化（如 id，username 等等）</li>
<li>创建节点</li>
<li>设置颜色</li>
<li><p>绑定事件</p></li>
</ol></blockquote>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="function Note(opts) {
    this.initOpts(opts);
    this.createNode();
    this.setColor();
    this.bind();
}

Note.prototype = {
    colors: [
        ['#ea9b35', '#efb04e'], // headColor, containerColor
        ['#dd598b', '#e672a2'],
        ['#c24226', '#d15a39'],
        ['#c1c341', '#d0d25c'],
        ['#3f78c3', '#5591d2']
    ],
    defaultOpts: {
        id: '', //Note的 id
        $ct: $('#content').length > 0 ? $('#content') : $('body'), //默认存放 Note 的容器
        context: '请输入内容', //Note 的内容
        createTime: new Date().toLocaleDateString().replace(/\//g, '-').match(/^\d{4}-\d{1,2}-\d{1,2}/),
        username: 'admin'
    },
    initOpts: function (opts) {
        this.opts = $.extend({}, this.defaultOpts, opts || {});
        if (this.opts.id) {
            this.id = this.opts.id;
        }
        this.createTime = this.opts.createTime ? this.opts.createTime : new Date().toLocaleDateString().replace(/\//g, '-').match(/^\d{4}-\d{1,2}-\d{1,2}/);
        this.username = this.opts.username ? this.opts.username : 'admin'
    },
    createNode: function () {
        var tpl = '<div class=&quot;note&quot;>' +
            '<div class=&quot;note-head&quot;><span class=&quot;delete&quot;>×</span></div>' +
            '<div class=&quot;note-ct&quot; contenteditable=&quot;true&quot;></div>' +
            '<div class=&quot;note-info&quot;><div class=&quot;note-name&quot;>' + this.username + '</div><div class=&quot;note-time&quot;>' + this.createTime + '</div>' +
            '</div>';
        this.$note = $(tpl);
        this.$note.find('.note-ct').html(this.opts.context);
        this.opts.$ct.append(this.$note);
        //if (!this.id) this.$note.css('bottom', '10px'); //新增放到右边
        Event.fire('waterfall');
    },

    setColor: function () {
        var color = this.colors[Math.floor(Math.random() * 5)];
        this.$note.find(&quot;.note-head&quot;).css('background-color', color[0]);
        this.$note.find('.note-ct').css('background-color', color[1]);
        this.$note.find('.note-info').css('background-color', color[1]);
    },
    setLayout: function () {
        var self = this;
        if (self.clock) {
            clearTimeout(self.clock);
        }
        self.clock = setTimeout(function () {
            Event.fire('waterfall');
        }, 100);
    },
    bind: function () {
        var _this = this, //记录下坑，之前末尾是分号不是逗号后面都变成了全局变量结果造成了最后一个才能修改?
            $note = this.$note,
            $noteHead = $note.find('.note-head'),
            $noteCt = $note.find('.note-ct'),
            $close = $note.find('.delete');

        $close.on('click', function () {
            _this.delete();
        });

        $noteCt.on('focus', function () {
            if ($noteCt.html() === '请输入内容') $noteCt.html('');
            $noteCt.data('before', $noteCt.html());
        }).on('blur paste', function () {
            if ($noteCt.data('before') != $noteCt.html()) {
                $noteCt.data('before', $noteCt.html());
                _this.setLayout();
                if (_this.id) { //判断是否有这个id，如果有就更新，如果没有就添加
                    _this.edit($noteCt.html())
                } else {
                    _this.add($noteCt.html())
                }
            }
        });

        //设置笔记的移动
        $noteHead.on('mousedown', function (e) {
            var evtX = e.pageX - $note.offset().left, //evtX 计算事件的触发点在 dialog内部到 dialog 的左边缘的距离
                evtY = e.pageY - $note.offset().top;
            $note.addClass('draggable').data('evtPos', {
                x: evtX,
                y: evtY
            }); //把事件到 dialog 边缘的距离保存下来
        }).on('mouseup', function () {
            $note.removeClass('draggable').removeData('pos');
        });

        $('body').on('mousemove', function (e) {
            $('.draggable').length &amp;&amp; $('.draggable').offset({
                top: e.pageY - $('.draggable').data('evtPos').y, // 当用户鼠标移动时，根据鼠标的位置和前面保存的距离，计算 dialog 的绝对位置
                left: e.pageX - $('.draggable').data('evtPos').x
            });
        });
    },





    /* 添加笔记到数据库 */
    add: function (msg) {
        var _this = this;
        $.post('/api/notes/add', {
            note: msg
        }).done(function (res) {
            if (res.status === 1) {
                _this.id = res.id;
                Toast(1, '添加成功！');
            } else {
                _this.$note.remove();
                Event.fire('waterfall');
                Toast(0, res.errorMsg);
            }
        })
    },
    /* 编辑笔记数据库 */
    edit: function (msg) {
        var _this = this;
        $.post('/api/notes/edit', {
            id: this.id,
            note: msg
        }).done(function (res) {
            if (res.status === 1) {
                Toast(1, '更新成功！');
            } else {
                Toast(0, res.errorMsg);
            }
        });
    },
    /* 删除笔记 */
    delete: function () {
        var _this = this;
        if (confirm(&quot;确认要删除吗？&quot;)) {
            $.post('/api/notes/delete', {
                id: this.id
            }).done(function (res) {
                if (res.status === 1) {
                    Toast(1, '删除成功！');
                    _this.$note.remove();
                    Event.fire('waterfall')
                } else {
                    Toast(0, res.errorMsg);
                }
            });
        }
    }
}

" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs javascript"><code><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Note</span>(<span class="hljs-params">opts</span>) </span>{
    <span class="hljs-keyword">this</span>.initOpts(opts);
    <span class="hljs-keyword">this</span>.createNode();
    <span class="hljs-keyword">this</span>.setColor();
    <span class="hljs-keyword">this</span>.bind();
}

Note.prototype = {
    <span class="hljs-attr">colors</span>: [
        [<span class="hljs-string">'#ea9b35'</span>, <span class="hljs-string">'#efb04e'</span>], <span class="hljs-comment">// headColor, containerColor</span>
        [<span class="hljs-string">'#dd598b'</span>, <span class="hljs-string">'#e672a2'</span>],
        [<span class="hljs-string">'#c24226'</span>, <span class="hljs-string">'#d15a39'</span>],
        [<span class="hljs-string">'#c1c341'</span>, <span class="hljs-string">'#d0d25c'</span>],
        [<span class="hljs-string">'#3f78c3'</span>, <span class="hljs-string">'#5591d2'</span>]
    ],
    <span class="hljs-attr">defaultOpts</span>: {
        <span class="hljs-attr">id</span>: <span class="hljs-string">''</span>, <span class="hljs-comment">//Note的 id</span>
        $ct: $(<span class="hljs-string">'#content'</span>).length &gt; <span class="hljs-number">0</span> ? $(<span class="hljs-string">'#content'</span>) : $(<span class="hljs-string">'body'</span>), <span class="hljs-comment">//默认存放 Note 的容器</span>
        context: <span class="hljs-string">'请输入内容'</span>, <span class="hljs-comment">//Note 的内容</span>
        createTime: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().toLocaleDateString().replace(<span class="hljs-regexp">/\//g</span>, <span class="hljs-string">'-'</span>).match(<span class="hljs-regexp">/^\d{4}-\d{1,2}-\d{1,2}/</span>),
        <span class="hljs-attr">username</span>: <span class="hljs-string">'admin'</span>
    },
    <span class="hljs-attr">initOpts</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">opts</span>) </span>{
        <span class="hljs-keyword">this</span>.opts = $.extend({}, <span class="hljs-keyword">this</span>.defaultOpts, opts || {});
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.opts.id) {
            <span class="hljs-keyword">this</span>.id = <span class="hljs-keyword">this</span>.opts.id;
        }
        <span class="hljs-keyword">this</span>.createTime = <span class="hljs-keyword">this</span>.opts.createTime ? <span class="hljs-keyword">this</span>.opts.createTime : <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().toLocaleDateString().replace(<span class="hljs-regexp">/\//g</span>, <span class="hljs-string">'-'</span>).match(<span class="hljs-regexp">/^\d{4}-\d{1,2}-\d{1,2}/</span>);
        <span class="hljs-keyword">this</span>.username = <span class="hljs-keyword">this</span>.opts.username ? <span class="hljs-keyword">this</span>.opts.username : <span class="hljs-string">'admin'</span>
    },
    <span class="hljs-attr">createNode</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> tpl = <span class="hljs-string">'&lt;div class="note"&gt;'</span> +
            <span class="hljs-string">'&lt;div class="note-head"&gt;&lt;span class="delete"&gt;×&lt;/span&gt;&lt;/div&gt;'</span> +
            <span class="hljs-string">'&lt;div class="note-ct" contenteditable="true"&gt;&lt;/div&gt;'</span> +
            <span class="hljs-string">'&lt;div class="note-info"&gt;&lt;div class="note-name"&gt;'</span> + <span class="hljs-keyword">this</span>.username + <span class="hljs-string">'&lt;/div&gt;&lt;div class="note-time"&gt;'</span> + <span class="hljs-keyword">this</span>.createTime + <span class="hljs-string">'&lt;/div&gt;'</span> +
            <span class="hljs-string">'&lt;/div&gt;'</span>;
        <span class="hljs-keyword">this</span>.$note = $(tpl);
        <span class="hljs-keyword">this</span>.$note.find(<span class="hljs-string">'.note-ct'</span>).html(<span class="hljs-keyword">this</span>.opts.context);
        <span class="hljs-keyword">this</span>.opts.$ct.append(<span class="hljs-keyword">this</span>.$note);
        <span class="hljs-comment">//if (!this.id) this.$note.css('bottom', '10px'); //新增放到右边</span>
        Event.fire(<span class="hljs-string">'waterfall'</span>);
    },

    <span class="hljs-attr">setColor</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> color = <span class="hljs-keyword">this</span>.colors[<span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">5</span>)];
        <span class="hljs-keyword">this</span>.$note.find(<span class="hljs-string">".note-head"</span>).css(<span class="hljs-string">'background-color'</span>, color[<span class="hljs-number">0</span>]);
        <span class="hljs-keyword">this</span>.$note.find(<span class="hljs-string">'.note-ct'</span>).css(<span class="hljs-string">'background-color'</span>, color[<span class="hljs-number">1</span>]);
        <span class="hljs-keyword">this</span>.$note.find(<span class="hljs-string">'.note-info'</span>).css(<span class="hljs-string">'background-color'</span>, color[<span class="hljs-number">1</span>]);
    },
    <span class="hljs-attr">setLayout</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
        <span class="hljs-keyword">if</span> (self.clock) {
            clearTimeout(self.clock);
        }
        self.clock = setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            Event.fire(<span class="hljs-string">'waterfall'</span>);
        }, <span class="hljs-number">100</span>);
    },
    <span class="hljs-attr">bind</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> _this = <span class="hljs-keyword">this</span>, <span class="hljs-comment">//记录下坑，之前末尾是分号不是逗号后面都变成了全局变量结果造成了最后一个才能修改?</span>
            $note = <span class="hljs-keyword">this</span>.$note,
            $noteHead = $note.find(<span class="hljs-string">'.note-head'</span>),
            $noteCt = $note.find(<span class="hljs-string">'.note-ct'</span>),
            $close = $note.find(<span class="hljs-string">'.delete'</span>);

        $close.on(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            _this.delete();
        });

        $noteCt.on(<span class="hljs-string">'focus'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">if</span> ($noteCt.html() === <span class="hljs-string">'请输入内容'</span>) $noteCt.html(<span class="hljs-string">''</span>);
            $noteCt.data(<span class="hljs-string">'before'</span>, $noteCt.html());
        }).on(<span class="hljs-string">'blur paste'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">if</span> ($noteCt.data(<span class="hljs-string">'before'</span>) != $noteCt.html()) {
                $noteCt.data(<span class="hljs-string">'before'</span>, $noteCt.html());
                _this.setLayout();
                <span class="hljs-keyword">if</span> (_this.id) { <span class="hljs-comment">//判断是否有这个id，如果有就更新，如果没有就添加</span>
                    _this.edit($noteCt.html())
                } <span class="hljs-keyword">else</span> {
                    _this.add($noteCt.html())
                }
            }
        });

        <span class="hljs-comment">//设置笔记的移动</span>
        $noteHead.on(<span class="hljs-string">'mousedown'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
            <span class="hljs-keyword">var</span> evtX = e.pageX - $note.offset().left, <span class="hljs-comment">//evtX 计算事件的触发点在 dialog内部到 dialog 的左边缘的距离</span>
                evtY = e.pageY - $note.offset().top;
            $note.addClass(<span class="hljs-string">'draggable'</span>).data(<span class="hljs-string">'evtPos'</span>, {
                <span class="hljs-attr">x</span>: evtX,
                <span class="hljs-attr">y</span>: evtY
            }); <span class="hljs-comment">//把事件到 dialog 边缘的距离保存下来</span>
        }).on(<span class="hljs-string">'mouseup'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            $note.removeClass(<span class="hljs-string">'draggable'</span>).removeData(<span class="hljs-string">'pos'</span>);
        });

        $(<span class="hljs-string">'body'</span>).on(<span class="hljs-string">'mousemove'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
            $(<span class="hljs-string">'.draggable'</span>).length &amp;&amp; $(<span class="hljs-string">'.draggable'</span>).offset({
                <span class="hljs-attr">top</span>: e.pageY - $(<span class="hljs-string">'.draggable'</span>).data(<span class="hljs-string">'evtPos'</span>).y, <span class="hljs-comment">// 当用户鼠标移动时，根据鼠标的位置和前面保存的距离，计算 dialog 的绝对位置</span>
                left: e.pageX - $(<span class="hljs-string">'.draggable'</span>).data(<span class="hljs-string">'evtPos'</span>).x
            });
        });
    },





    <span class="hljs-comment">/* 添加笔记到数据库 */</span>
    add: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">msg</span>) </span>{
        <span class="hljs-keyword">var</span> _this = <span class="hljs-keyword">this</span>;
        $.post(<span class="hljs-string">'/api/notes/add'</span>, {
            <span class="hljs-attr">note</span>: msg
        }).done(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">res</span>) </span>{
            <span class="hljs-keyword">if</span> (res.status === <span class="hljs-number">1</span>) {
                _this.id = res.id;
                Toast(<span class="hljs-number">1</span>, <span class="hljs-string">'添加成功！'</span>);
            } <span class="hljs-keyword">else</span> {
                _this.$note.remove();
                Event.fire(<span class="hljs-string">'waterfall'</span>);
                Toast(<span class="hljs-number">0</span>, res.errorMsg);
            }
        })
    },
    <span class="hljs-comment">/* 编辑笔记数据库 */</span>
    edit: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">msg</span>) </span>{
        <span class="hljs-keyword">var</span> _this = <span class="hljs-keyword">this</span>;
        $.post(<span class="hljs-string">'/api/notes/edit'</span>, {
            <span class="hljs-attr">id</span>: <span class="hljs-keyword">this</span>.id,
            <span class="hljs-attr">note</span>: msg
        }).done(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">res</span>) </span>{
            <span class="hljs-keyword">if</span> (res.status === <span class="hljs-number">1</span>) {
                Toast(<span class="hljs-number">1</span>, <span class="hljs-string">'更新成功！'</span>);
            } <span class="hljs-keyword">else</span> {
                Toast(<span class="hljs-number">0</span>, res.errorMsg);
            }
        });
    },
    <span class="hljs-comment">/* 删除笔记 */</span>
    <span class="hljs-keyword">delete</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> _this = <span class="hljs-keyword">this</span>;
        <span class="hljs-keyword">if</span> (confirm(<span class="hljs-string">"确认要删除吗？"</span>)) {
            $.post(<span class="hljs-string">'/api/notes/delete'</span>, {
                <span class="hljs-attr">id</span>: <span class="hljs-keyword">this</span>.id
            }).done(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">res</span>) </span>{
                <span class="hljs-keyword">if</span> (res.status === <span class="hljs-number">1</span>) {
                    Toast(<span class="hljs-number">1</span>, <span class="hljs-string">'删除成功！'</span>);
                    _this.$note.remove();
                    Event.fire(<span class="hljs-string">'waterfall'</span>)
                } <span class="hljs-keyword">else</span> {
                    Toast(<span class="hljs-number">0</span>, res.errorMsg);
                }
            });
        }
    }
}

</code></pre>
<p>5.<strong>笔记管理模块</strong></p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="var NoteManager = (function () {
    //页面加载
    function load() {
        $.get('api/notes').done(function (res) {
            if (res.status === 1) {
                $.each(res.data, function (index, msg) {
                    new Note({
                        id: msg.id,
                        context: msg.text,
                        createTime: msg.createdAt.match(/^\d{4}-\d{1,2}-\d{1,2}/),
                        username: msg.username
                    });
                });

                Event.fire('waterfall');

            } else {
                Toast(0, res.errorMsg);
            }
        }).fail(function () {
            Toast(0, &quot;网络异常&quot;);
        });
    }

    /* 添加笔记 */
    function add() {
        $.get('/login').then(function (res) {//判断是否登录
            if (res.status === 1) {
                new Note({
                    username: res.username
                });
            } else {
                Toast(0, res.errorMsg);
            }
        });
    }
    return {
        load: load,
        add: add
    }
})();" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs javascript"><code><span class="hljs-keyword">var</span> NoteManager = (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-comment">//页面加载</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">load</span>(<span class="hljs-params"></span>) </span>{
        $.get(<span class="hljs-string">'api/notes'</span>).done(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">res</span>) </span>{
            <span class="hljs-keyword">if</span> (res.status === <span class="hljs-number">1</span>) {
                $.each(res.data, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">index, msg</span>) </span>{
                    <span class="hljs-keyword">new</span> Note({
                        <span class="hljs-attr">id</span>: msg.id,
                        <span class="hljs-attr">context</span>: msg.text,
                        <span class="hljs-attr">createTime</span>: msg.createdAt.match(<span class="hljs-regexp">/^\d{4}-\d{1,2}-\d{1,2}/</span>),
                        <span class="hljs-attr">username</span>: msg.username
                    });
                });

                Event.fire(<span class="hljs-string">'waterfall'</span>);

            } <span class="hljs-keyword">else</span> {
                Toast(<span class="hljs-number">0</span>, res.errorMsg);
            }
        }).fail(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            Toast(<span class="hljs-number">0</span>, <span class="hljs-string">"网络异常"</span>);
        });
    }

    <span class="hljs-comment">/* 添加笔记 */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add</span>(<span class="hljs-params"></span>) </span>{
        $.get(<span class="hljs-string">'/login'</span>).then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">res</span>) </span>{<span class="hljs-comment">//判断是否登录</span>
            <span class="hljs-keyword">if</span> (res.status === <span class="hljs-number">1</span>) {
                <span class="hljs-keyword">new</span> Note({
                    <span class="hljs-attr">username</span>: res.username
                });
            } <span class="hljs-keyword">else</span> {
                Toast(<span class="hljs-number">0</span>, res.errorMsg);
            }
        });
    }
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">load</span>: load,
        <span class="hljs-attr">add</span>: add
    }
})();</code></pre>
<p>6.<strong>发布订阅模式</strong></p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="/* 发布订阅模式 */
var Event = (function () {
    var events = {};

    function on(evt, handler) {
        events[evt] = events[evt] || [];
        events[evt].push({
            handler: handler
        });
    }

    function fire(evt, args) {
        if (!events[evt]) {
            return;
        }
        for (var i = 0; i < events[evt].length; i++) {
            events[evt][i].handler(args);
        }
    }

    function off(name) {
        delete events[name];
    }
    return {
        on: on,
        fire: fire,
        off: off
    }
})();" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs qml"><code><span class="hljs-comment">/* 发布订阅模式 */</span>
<span class="hljs-built_in">var</span> Event = (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-built_in">var</span> events = {};

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">on</span>(<span class="hljs-params">evt, handler</span>) </span>{
        events[evt] = events[evt] || [];
        events[evt].push({
            <span class="hljs-attribute">handler</span>: handler
        });
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fire</span>(<span class="hljs-params">evt, args</span>) </span>{
        <span class="hljs-keyword">if</span> (!events[evt]) {
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">var</span> i = <span class="hljs-number">0</span>; i &lt; events[evt].length; i++) {
            events[evt][i].handler(args);
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">off</span>(<span class="hljs-params">name</span>) </span>{
        <span class="hljs-keyword">delete</span> events[name];
    }
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attribute">on</span>: <span class="hljs-keyword">on</span>,
        <span class="hljs-attribute">fire</span>: fire,
        <span class="hljs-attribute">off</span>: off
    }
})();</code></pre>
<p>写完模块后，写入口文件index.js</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="require('sass/index.scss');
var Toast = require('mod/toast.js').Toast;
var WaterFall = require('mod/waterfall.js');
var NoteManager = require('mod/note-manager');
var Event = require('mod/event.js');


NoteManager.load();
$('.add-note').on('click', function () {
    NoteManager.add();
})

Event.on('waterfall', function () {
    WaterFall.init($(&quot;#content&quot;));
})" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs javascript"><code><span class="hljs-built_in">require</span>(<span class="hljs-string">'sass/index.scss'</span>);
<span class="hljs-keyword">var</span> Toast = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mod/toast.js'</span>).Toast;
<span class="hljs-keyword">var</span> WaterFall = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mod/waterfall.js'</span>);
<span class="hljs-keyword">var</span> NoteManager = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mod/note-manager'</span>);
<span class="hljs-keyword">var</span> Event = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mod/event.js'</span>);


NoteManager.load();
$(<span class="hljs-string">'.add-note'</span>).on(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    NoteManager.add();
})

Event.on(<span class="hljs-string">'waterfall'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    WaterFall.init($(<span class="hljs-string">"#content"</span>));
})</code></pre>
<p>到这就差不多完成了70%了，接下来就创建数据库，连接数据库了</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="/*创建数据库 运行 node note.js*/

var Sequelize = require('sequelize');
var path = require('path');

var sequelize = new Sequelize(undefined, undefined, undefined, {
    host: 'localhost',
    dialect: 'sqlite',
    // SQLite only
    storage: path.join(__dirname, '../database/database.sqlite')
});

/* 测试连接是否成功
node note.js

sequelize.authenticate()
    .then(() => {
        console.log('Connection has been established successfully.');
    })
    .catch(err => {
        console.error('Unable to connect to the database:', err);
    });

*/


var Note = sequelize.define('note', {
    text: {
        type: Sequelize.STRING
    },
    userid: {
        type: Sequelize.INTEGER
    },
    username: {
        type: Sequelize.STRING
    }
});

Note.sync();

/*
删除表
Note.drop();
*/


/*
//创建数据库

Note.sync().then(function(){
     Note.create({text:&quot;sdsdsdsd&quot;});
}).then(function(){
    //查询表
    Note.findAll({raw:true}).then(function(notes){
        console.log(notes);
    })
});
*/




module.exports = Note;" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs lua"><code>/*创建数据库 运行 node note.js*/

var Sequelize = <span class="hljs-built_in">require</span>(<span class="hljs-string">'sequelize'</span>);
var path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

var sequelize = new Sequelize(undefined, undefined, undefined, {
    host: <span class="hljs-string">'localhost'</span>,
    dialect: <span class="hljs-string">'sqlite'</span>,
    // SQLite only
    storage: path.join(__dirname, <span class="hljs-string">'../database/database.sqlite'</span>)
});

/* 测试连接是否成功
node note.js

sequelize.authenticate()
    .<span class="hljs-keyword">then</span>(() =&gt; {
        console.log(<span class="hljs-string">'Connection has been established successfully.'</span>);
    })
    .catch(err =&gt; {
        console.<span class="hljs-built_in">error</span>(<span class="hljs-string">'Unable to connect to the database:'</span>, err);
    });

*/


var Note = sequelize.define(<span class="hljs-string">'note'</span>, {
    text: {
        <span class="hljs-built_in">type</span>: Sequelize.STRING
    },
    userid: {
        <span class="hljs-built_in">type</span>: Sequelize.INTEGER
    },
    username: {
        <span class="hljs-built_in">type</span>: Sequelize.STRING
    }
});

Note.sync();

/*
删除表
Note.drop();
*/


/*
//创建数据库

Note.sync().<span class="hljs-keyword">then</span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
     Note.<span class="hljs-built_in">create</span>({text:<span class="hljs-string">"sdsdsdsd"</span>});
}).<span class="hljs-keyword">then</span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    //查询表
    Note.findAll({raw:<span class="hljs-literal">true</span>}).<span class="hljs-keyword">then</span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(notes)</span></span>{
        console.log(notes);
    })
});
*/




module.exports = Note;</code></pre>
<p>然后是在routes 里处理 ajax 请求，处理登录信息，获取 id，用户名等等，到这就基本完成了</p>
<h2 id="articleHeader7">总结</h2>
<p>经过一星期的开发，了解了前后端联调，模块化开发方式、webpack 及loader和插件的使用、npm 的使用，Express的使用、路由、中间件、sqlite3、nodejs，在开发过程中还是有遇到许多问题，例如在连续声明变量的时候，不小心把逗号写成了分号，其他变量就变成了全局变量，于是就出错了，查了好久?<br><span class="img-wrap"><img data-src="/img/remote/1460000011155412" src="https://static.alili.tech/img/remote/1460000011155412" alt="" title="" style="cursor: pointer;"></span><br>不过在这过程之中还是学到了许多，重要的是过程，继续往前端的路走下去?</p>

                
{{< /raw >}}

# 版权声明
本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，

本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。

原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！

## 原文标题
前端小项目之在线便利贴

## 原文链接
[https://segmentfault.com/a/1190000011154801](https://segmentfault.com/a/1190000011154801)

