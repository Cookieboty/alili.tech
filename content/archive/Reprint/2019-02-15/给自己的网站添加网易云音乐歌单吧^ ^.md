---
title: '给自己的网站添加网易云音乐歌单吧^ ^' 
date: 2019-02-15 2:30:44
hidden: true
slug: cscfibe3dof
categories: [reprint]
---

{{< raw >}}

                    
<p>最近应该发现，我的<a href="https://blog.codelabo.cn" rel="nofollow noreferrer" target="_blank">博客https://blog.codelabo.cn</a>左下角多了一个音乐播放器</p>
<p><span class="img-wrap"><img data-src="/img/remote/1460000016786096?w=1806&amp;h=952" src="https://static.alili.tech/img/remote/1460000016786096?w=1806&amp;h=952" alt="aplayer" title="aplayer" style="cursor: pointer; display: inline;"></span></p>
<p>这个是怎么实现的？一起来看看吧</p>
<h2 id="articleHeader0">APlayer</h2>
<p>首先我们需要一个音频播放器，这里我用到了<a href="http://aplayer.js.org" rel="nofollow noreferrer" target="_blank">APlayer</a>，这是由bilibili前端大神<a href="https://github.com/DIYgod" rel="nofollow noreferrer" target="_blank">DIYgod</a>开源的播放器，有兴趣的可以去<a href="https://diygod.me" rel="nofollow noreferrer" target="_blank">TA的主页</a>看看，非常惊艳，这里我就不多说了</p>
<p>我们看一下<code>APlayer</code>的官方文档，方法很简单</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="<link rel=&quot;stylesheet&quot; href=&quot;APlayer.min.css&quot;>
<div id=&quot;aplayer&quot;></div>
<script src=&quot;APlayer.min.js&quot;></script>" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="xml hljs"><code class="html"><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"APlayer.min.css"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"aplayer"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"APlayer.min.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="const ap = new APlayer({
    container: document.getElementById('aplayer'),
    audio: [{
        name: 'name',
        artist: 'artist',
        url: 'url.mp3',
        cover: 'cover.jpg'
    }]
});" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="javascript hljs"><code class="js"><span class="hljs-keyword">const</span> ap = <span class="hljs-keyword">new</span> APlayer({
    <span class="hljs-attr">container</span>: <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'aplayer'</span>),
    <span class="hljs-attr">audio</span>: [{
        <span class="hljs-attr">name</span>: <span class="hljs-string">'name'</span>,
        <span class="hljs-attr">artist</span>: <span class="hljs-string">'artist'</span>,
        <span class="hljs-attr">url</span>: <span class="hljs-string">'url.mp3'</span>,
        <span class="hljs-attr">cover</span>: <span class="hljs-string">'cover.jpg'</span>
    }]
});</code></pre>
<p>这里的<code>audio</code>是一个音频列表，可以是一个对象或对象数组</p>
<p>对象具体的参数如下</p>
<table>
<thead><tr>
<th>名称</th>
<th>描述</th>
</tr></thead>
<tbody>
<tr>
<td>name</td>
<td>音频名称</td>
</tr>
<tr>
<td>artist</td>
<td>音频艺术家</td>
</tr>
<tr>
<td>url</td>
<td>音频链接</td>
</tr>
<tr>
<td>cover</td>
<td>音频封面</td>
</tr>
<tr>
<td>lrc</td>
<td>音频歌词</td>
</tr>
</tbody>
</table>
<p>LRC一共有三种方式来给 <code>APlayer</code> 传递歌词，详情可参考<a href="https://aplayer.js.org/#/home?id=lrc" rel="nofollow noreferrer" target="_blank">https://aplayer.js.org/#/home?id=lrc</a>，</p>
<p>这里我们选择最方便的一种，直接给LRC链接</p>
<h2 id="articleHeader1">网易云音乐API</h2>
<p>这部分我找到了网上有人分享的API，这种官方不可能给公开API，所以还是要小心使用，说不定哪天就被修改了</p>
<p><a href="http://moonlib.com/606.html" rel="nofollow noreferrer" target="_blank">http://moonlib.com/606.html</a></p>
<p>我们现在其实想要两个，一个是歌单的列表，还有一个是歌词。</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="# 歌单

https://music.163.com/api/playlist/detail?id=37880978" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs awk"><code><span class="hljs-comment"># 歌单</span>

https:<span class="hljs-regexp">//mu</span>sic.<span class="hljs-number">163</span>.com<span class="hljs-regexp">/api/</span>playlist<span class="hljs-regexp">/detail?id=37880978</span></code></pre>
<blockquote>id为歌单ID</blockquote>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="# 歌词

https://music.163.com/api/song/lyric?os=pc&amp;id=93920&amp;lv=-1&amp;kv=-1&amp;tv=-1" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs vim"><code># 歌词

http<span class="hljs-variable">s:</span>//music.<span class="hljs-number">163</span>.<span class="hljs-keyword">com</span>/api/song/lyric?os=<span class="hljs-keyword">pc</span>&amp;id=<span class="hljs-number">93920</span>&amp;<span class="hljs-keyword">lv</span>=-<span class="hljs-number">1</span>&amp;kv=-<span class="hljs-number">1</span>&amp;tv=-<span class="hljs-number">1</span></code></pre>
<blockquote>id为歌曲ID<br>lv：值为-1，我猜测应该是判断是否搜索lyric格式<br>kv：值为-1，这个值貌似并不影响结果，意义不明<br>tv：值为-1，是否搜索tlyric格式</blockquote>
<h2 id="articleHeader2">接口实现</h2>
<p>虽然我们已经找到了网易云音乐API，但是返回的数据不是我们所需要的呀</p>
<p>比如这个歌单的接口</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="# Request

https://music.163.com/api/playlist/detail?id=2119983629

# Response

{
  &quot;result&quot;:{
      &quot;subscribers&quot;:[],
      &quot;subscribed&quot;: false,
      &quot;creator&quot;:{...},
      &quot;artists&quot;: null,
      &quot;tracks&quot;:[
        {
          album: {
              name: &quot;メトロノーム&quot;, 
              id: 36787278, type: &quot;专辑&quot;, 
              size: 12, picId:18419018788768520,
          }
          alias: [],
          artists: [{name: &quot;MACO&quot;, id: 901025, picId: 0, img1v1Id: 0, briefDesc: &quot;&quot;,…}],
          audition: null,
          bMusic: {...},
          commentThreadId: &quot;R_SO_4_515573221&quot;,
          copyFrom: &quot;&quot;,
          copyright: 1,
          copyrightId: 7003,
          crbt: null,
          ...
        }
      ]
  }
}" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs nimrod"><code><span class="hljs-comment"># Request</span>

https://music.<span class="hljs-number">163</span>.com/api/playlist/detail?id=<span class="hljs-number">2119983629</span>

<span class="hljs-comment"># Response</span>

{
  <span class="hljs-string">"result"</span>:{
      <span class="hljs-string">"subscribers"</span>:[],
      <span class="hljs-string">"subscribed"</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-string">"creator"</span>:<span class="hljs-meta">{...}</span>,
      <span class="hljs-string">"artists"</span>: null,
      <span class="hljs-string">"tracks"</span>:[
        {
          album: {
              name: <span class="hljs-string">"メトロノーム"</span>, 
              id: <span class="hljs-number">36787278</span>, <span class="hljs-keyword">type</span>: <span class="hljs-string">"专辑"</span>, 
              size: <span class="hljs-number">12</span>, picId:<span class="hljs-number">18419018788768520</span>,
          }
          alias: [],
          artists: [{name: <span class="hljs-string">"MACO"</span>, id: <span class="hljs-number">901025</span>, picId: <span class="hljs-number">0</span>, img1v1Id: <span class="hljs-number">0</span>, briefDesc: <span class="hljs-string">""</span>,…}],
          audition: null,
          bMusic: <span class="hljs-meta">{...}</span>,
          commentThreadId: <span class="hljs-string">"R_SO_4_515573221"</span>,
          copyFrom: <span class="hljs-string">""</span>,
          copyright: <span class="hljs-number">1</span>,
          copyrightId: <span class="hljs-number">7003</span>,
          crbt: null,
          ...
        }
      ]
  }
}</code></pre>
<p>里面字段很多，我上面只列举了一部分，<code>tracks</code>就是歌单列表，但是很显然，和我们需要的格式还差很多</p>
<p>那么怎么来转换一下，变成我们需要的数据格式呢?</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="[{
    name: 'name',
    artist: 'artist',
    url: 'url.mp3',
    cover: 'cover.jpg',
    lrc: 'a.lrc'
}]" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs scheme"><code>[{
    name: <span class="hljs-symbol">'name</span>',
    artist: <span class="hljs-symbol">'artist</span>',
    url: <span class="hljs-symbol">'url.mp3</span>',
    cover: <span class="hljs-symbol">'cover.jpg</span>',
    lrc: <span class="hljs-symbol">'a.lrc</span>'
}]</code></pre>
<p>这里我们就需要在服务端来完成了，思路很简单，在服务器上请求<code>https://music.163.com/api/playlist/detail?id=2119983629</code>这个接口，然后拿到结果后手动处理一下，最后再返给客户端，相当于做了一次中转</p>
<blockquote>我这里服务端是用<code>koa</code>实现的，其他框架应该差不多</blockquote>
<h3 id="articleHeader3">服务端发起请求</h3>
<p>在服务端发起请求也可以用我们熟悉的<code>fetch</code>，不过你需要先安装<a href="https://www.npmjs.com/package/node-fetch" rel="nofollow noreferrer" target="_blank"><code>node-fetch</code></a>这个库</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="yarn add node-fetch" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs crmsh"><code class="shell" style="word-break: break-word; white-space: initial;">yarn add <span class="hljs-keyword">node</span><span class="hljs-title">-fetch</span></code></pre>
<p>然后你就可以像前端一样发起请求了</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="const fetch = require('node-fetch');

//...

const getPlayList = (id) => {
    return fetch(`http://music.163.com/api/playlist/detail?id=${id}`)
    .then((response) => {
        if (response.ok) {
            return response.json();
        }
    })
    .catch((err) => {
        console.warn(err);
    })
}" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="javascript hljs"><code class="js"><span class="hljs-keyword">const</span> fetch = <span class="hljs-built_in">require</span>(<span class="hljs-string">'node-fetch'</span>);

<span class="hljs-comment">//...</span>

<span class="hljs-keyword">const</span> getPlayList = <span class="hljs-function">(<span class="hljs-params">id</span>) =&gt;</span> {
    <span class="hljs-keyword">return</span> fetch(<span class="hljs-string">`http://music.163.com/api/playlist/detail?id=<span class="hljs-subst">${id}</span>`</span>)
    .then(<span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (response.ok) {
            <span class="hljs-keyword">return</span> response.json();
        }
    })
    .catch(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
        <span class="hljs-built_in">console</span>.warn(err);
    })
}</code></pre>
<h3 id="articleHeader4">接口定义</h3>
<p>现在我们需要新增一个接口用来处理歌单，返回出我们需要的格式</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="//获取音乐列表
router.get('/playlist/:id', async (ctx, next) => {
    const responseData = {
        &quot;success&quot;: false,
        &quot;data&quot;:[],
        &quot;message&quot;: &quot;&quot;,
    }
    const { id } = ctx.params;
    try {
        const data = await getPlayList(id);
        if(data.code===200){
            const playList = data.result.tracks.map(item=>({
                id: item.id,
                name: item.name,
                artist: item.artists.map(el=>el.name).join(','),//由于歌手是一个数组，这里我们把它转换成字符串拼接
                url: `https://music.163.com/song/media/outer/url?id=${item.id}.mp3`,//歌曲地址
                cover: item.album.picUrl.replace(/http:/,'https:'),
                lrc:null
            }))
            responseData.success = true;
            responseData.message = '操作成功';
            responseData.data = playList;
            ctx.body = responseData;
        }
    } catch (error) {
        responseData.success = false;
        responseData.message = error.message;
        responseData.data = [];
        ctx.body = responseData;
    }
});" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="javascript hljs"><code class="js"><span class="hljs-comment">//获取音乐列表</span>
router.get(<span class="hljs-string">'/playlist/:id'</span>, <span class="hljs-keyword">async</span> (ctx, next) =&gt; {
    <span class="hljs-keyword">const</span> responseData = {
        <span class="hljs-string">"success"</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-string">"data"</span>:[],
        <span class="hljs-string">"message"</span>: <span class="hljs-string">""</span>,
    }
    <span class="hljs-keyword">const</span> { id } = ctx.params;
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> getPlayList(id);
        <span class="hljs-keyword">if</span>(data.code===<span class="hljs-number">200</span>){
            <span class="hljs-keyword">const</span> playList = data.result.tracks.map(<span class="hljs-function"><span class="hljs-params">item</span>=&gt;</span>({
                <span class="hljs-attr">id</span>: item.id,
                <span class="hljs-attr">name</span>: item.name,
                <span class="hljs-attr">artist</span>: item.artists.map(<span class="hljs-function"><span class="hljs-params">el</span>=&gt;</span>el.name).join(<span class="hljs-string">','</span>),<span class="hljs-comment">//由于歌手是一个数组，这里我们把它转换成字符串拼接</span>
                url: <span class="hljs-string">`https://music.163.com/song/media/outer/url?id=<span class="hljs-subst">${item.id}</span>.mp3`</span>,<span class="hljs-comment">//歌曲地址</span>
                cover: item.album.picUrl.replace(<span class="hljs-regexp">/http:/</span>,<span class="hljs-string">'https:'</span>),
                <span class="hljs-attr">lrc</span>:<span class="hljs-literal">null</span>
            }))
            responseData.success = <span class="hljs-literal">true</span>;
            responseData.message = <span class="hljs-string">'操作成功'</span>;
            responseData.data = playList;
            ctx.body = responseData;
        }
    } <span class="hljs-keyword">catch</span> (error) {
        responseData.success = <span class="hljs-literal">false</span>;
        responseData.message = error.message;
        responseData.data = [];
        ctx.body = responseData;
    }
});</code></pre>
<p>注意这里的歌曲链接<code>url</code>，本来返回信息里面是不包含的，只有歌曲<code>ID</code>，不过我们发现通过<code>https://music.163.com/song/media/outer/url?id=ID</code>可以直接在线播放指定ID的歌曲，所以我们这里直接写在返回结果上。</p>
<h3 id="articleHeader5">歌词处理</h3>
<p>还有一个问题就是歌词，上面的接口中，歌词返回结果也不是我们需要的格式</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="# Request

https://music.163.com/api/song/lyric?os=pc&amp;id=93920&amp;lv=-1&amp;kv=-1&amp;tv=-1

# Response

{
  &quot;sgc&quot;: true,
  &quot;sfy&quot;: false,
  &quot;qfy&quot;: false,
  &quot;lrc&quot;: {
    &quot;version&quot;: 7,
    &quot;lyric&quot;: &quot;[00:29.620]细雨带风湿透黄昏的街道\n[00:35.050]抹去雨水双眼无帮地仰望\n[00:40.240]望向孤单的晚灯是那伤感的记忆\n[00:48.630]再次泛起心里无数的思念\n[00:54.000]以往片刻欢笑仍挂在脸上\n[00:58.770]愿你此刻可会知是我衷心的说声\n[01:06.310]喜欢你\n[01:08.940]那双眼动人笑声更迷人\n[01:14.330]愿再可轻抚你那可爱面容\n[01:22.490]挽手说梦话象昨天你共我\n[01:42.970]满带理想的我曾经多冲动\n[01:48.340]埋怨与她相爱难有自由\n[01:53.040]愿你此刻可会知是我衷心的说声\n[02:00.420]喜欢你\n[02:03.230]那双眼动人笑声更迷人\n[02:08.540]愿再可轻抚你那可爱面容\n[02:16.750]挽手说梦话象昨天你共我\n[02:24.740]每晚夜里自我独行\n[02:27.670]随处荡 多冰冷\n[02:35.070]以往为了自我挣扎从不知她的痛苦\n[02:49.380]喜欢你\n[02:52.020]那双眼动人笑声更迷人\n[02:57.420]愿再可轻抚你那可爱面容\n[03:05.590]挽手说梦话象昨天你共我\n[03:13.870]挽手说梦话象昨天你共我\n&quot;
  },
  &quot;klyric&quot;: {...},
  &quot;code&quot;: 200
}
" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs tex"><code># Request

https://music.163.com/api/song/lyric?os=pc&amp;id=93920&amp;lv=-1&amp;kv=-1&amp;tv=-1

# Response

{
  "sgc": true,
  "sfy": false,
  "qfy": false,
  "lrc": {
    "version": 7,
    "lyric": "[00:29.620]细雨带风湿透黄昏的街道<span class="hljs-tag">\<span class="hljs-name">n</span><span class="hljs-string">[00:35.050]</span></span>抹去雨水双眼无帮地仰望<span class="hljs-tag">\<span class="hljs-name">n</span><span class="hljs-string">[00:40.240]</span></span>望向孤单的晚灯是那伤感的记忆<span class="hljs-tag">\<span class="hljs-name">n</span><span class="hljs-string">[00:48.630]</span></span>再次泛起心里无数的思念<span class="hljs-tag">\<span class="hljs-name">n</span><span class="hljs-string">[00:54.000]</span></span>以往片刻欢笑仍挂在脸上<span class="hljs-tag">\<span class="hljs-name">n</span><span class="hljs-string">[00:58.770]</span></span>愿你此刻可会知是我衷心的说声<span class="hljs-tag">\<span class="hljs-name">n</span><span class="hljs-string">[01:06.310]</span></span>喜欢你<span class="hljs-tag">\<span class="hljs-name">n</span><span class="hljs-string">[01:08.940]</span></span>那双眼动人笑声更迷人<span class="hljs-tag">\<span class="hljs-name">n</span><span class="hljs-string">[01:14.330]</span></span>愿再可轻抚你那可爱面容<span class="hljs-tag">\<span class="hljs-name">n</span><span class="hljs-string">[01:22.490]</span></span>挽手说梦话象昨天你共我<span class="hljs-tag">\<span class="hljs-name">n</span><span class="hljs-string">[01:42.970]</span></span>满带理想的我曾经多冲动<span class="hljs-tag">\<span class="hljs-name">n</span><span class="hljs-string">[01:48.340]</span></span>埋怨与她相爱难有自由<span class="hljs-tag">\<span class="hljs-name">n</span><span class="hljs-string">[01:53.040]</span></span>愿你此刻可会知是我衷心的说声<span class="hljs-tag">\<span class="hljs-name">n</span><span class="hljs-string">[02:00.420]</span></span>喜欢你<span class="hljs-tag">\<span class="hljs-name">n</span><span class="hljs-string">[02:03.230]</span></span>那双眼动人笑声更迷人<span class="hljs-tag">\<span class="hljs-name">n</span><span class="hljs-string">[02:08.540]</span></span>愿再可轻抚你那可爱面容<span class="hljs-tag">\<span class="hljs-name">n</span><span class="hljs-string">[02:16.750]</span></span>挽手说梦话象昨天你共我<span class="hljs-tag">\<span class="hljs-name">n</span><span class="hljs-string">[02:24.740]</span></span>每晚夜里自我独行<span class="hljs-tag">\<span class="hljs-name">n</span><span class="hljs-string">[02:27.670]</span></span>随处荡 多冰冷<span class="hljs-tag">\<span class="hljs-name">n</span><span class="hljs-string">[02:35.070]</span></span>以往为了自我挣扎从不知她的痛苦<span class="hljs-tag">\<span class="hljs-name">n</span><span class="hljs-string">[02:49.380]</span></span>喜欢你<span class="hljs-tag">\<span class="hljs-name">n</span><span class="hljs-string">[02:52.020]</span></span>那双眼动人笑声更迷人<span class="hljs-tag">\<span class="hljs-name">n</span><span class="hljs-string">[02:57.420]</span></span>愿再可轻抚你那可爱面容<span class="hljs-tag">\<span class="hljs-name">n</span><span class="hljs-string">[03:05.590]</span></span>挽手说梦话象昨天你共我<span class="hljs-tag">\<span class="hljs-name">n</span><span class="hljs-string">[03:13.870]</span></span>挽手说梦话象昨天你共我<span class="hljs-tag">\<span class="hljs-name">n</span></span>"
  },
  "klyric": {...},
  "code": 200
}
</code></pre>
<p>反正就是很全面，但是我们需要的仅仅是里面的内容部分，比如上面我就只需要这一段</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="[00:29.620]细雨带风湿透黄昏的街道
[00:35.050]抹去雨水双眼无帮地仰望
[00:40.240]望向孤单的晚灯是那伤感的记忆
[00:48.630]再次泛起心里无数的思念
[00:54.000]以往片刻欢笑仍挂在脸上
[00:58.770]愿你此刻可会知是我衷心的说声
..." title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs prolog"><code>[<span class="hljs-number">00</span>:<span class="hljs-number">29.620</span>]细雨带风湿透黄昏的街道
[<span class="hljs-number">00</span>:<span class="hljs-number">35.050</span>]抹去雨水双眼无帮地仰望
[<span class="hljs-number">00</span>:<span class="hljs-number">40.240</span>]望向孤单的晚灯是那伤感的记忆
[<span class="hljs-number">00</span>:<span class="hljs-number">48.630</span>]再次泛起心里无数的思念
[<span class="hljs-number">00</span>:<span class="hljs-number">54.000</span>]以往片刻欢笑仍挂在脸上
[<span class="hljs-number">00</span>:<span class="hljs-number">58.770</span>]愿你此刻可会知是我衷心的说声
...</code></pre>
<p>所以我们需要再次做一个中介处理</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="const getLyric = (id) => {
    return fetch(`http://music.163.com/api/song/lyric?os=pc&amp;id=${id}&amp;lv=-1&amp;kv=-1&amp;tv=-1`)
    .then((response) => {
        if (response.ok) {
            return response.json();
        }
    })
    .catch((err) => {
        console.warn(err);
    })
}

//获取音乐歌词
router.get('/lyric/:id', async (ctx, next) => {
    const { id } = ctx.params;
    try {
        const lyric = await getLyric(id);
        ctx.body = lyric.lrc.lyric;//返回指定部分
    } catch (error) {
        ctx.body = '';
    }
});

" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="javascript hljs"><code class="js"><span class="hljs-keyword">const</span> getLyric = <span class="hljs-function">(<span class="hljs-params">id</span>) =&gt;</span> {
    <span class="hljs-keyword">return</span> fetch(<span class="hljs-string">`http://music.163.com/api/song/lyric?os=pc&amp;id=<span class="hljs-subst">${id}</span>&amp;lv=-1&amp;kv=-1&amp;tv=-1`</span>)
    .then(<span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (response.ok) {
            <span class="hljs-keyword">return</span> response.json();
        }
    })
    .catch(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
        <span class="hljs-built_in">console</span>.warn(err);
    })
}

<span class="hljs-comment">//获取音乐歌词</span>
router.get(<span class="hljs-string">'/lyric/:id'</span>, <span class="hljs-keyword">async</span> (ctx, next) =&gt; {
    <span class="hljs-keyword">const</span> { id } = ctx.params;
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> lyric = <span class="hljs-keyword">await</span> getLyric(id);
        ctx.body = lyric.lrc.lyric;<span class="hljs-comment">//返回指定部分</span>
    } <span class="hljs-keyword">catch</span> (error) {
        ctx.body = <span class="hljs-string">''</span>;
    }
});

</code></pre>
<p>这样在上面歌词列表中就可以直接用<code>/api/lyric/:ID</code>来获取歌词了</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="//...
{
  id: item.id,
  name: item.name,
  artist: item.artists.map(el=>el.name).join(','),
  url: `https://music.163.com/song/media/outer/url?id=${item.id}.mp3`,
  cover: item.album.picUrl.replace(/http:/,'https:'),
  lrc:`/api/lyric/${item.id}`//这里歌词写上我们定义的接口地址
}
//..." title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="javascript hljs"><code class="js"><span class="hljs-comment">//...</span>
{
  <span class="hljs-attr">id</span>: item.id,
  <span class="hljs-attr">name</span>: item.name,
  <span class="hljs-attr">artist</span>: item.artists.map(<span class="hljs-function"><span class="hljs-params">el</span>=&gt;</span>el.name).join(<span class="hljs-string">','</span>),
  <span class="hljs-attr">url</span>: <span class="hljs-string">`https://music.163.com/song/media/outer/url?id=<span class="hljs-subst">${item.id}</span>.mp3`</span>,
  <span class="hljs-attr">cover</span>: item.album.picUrl.replace(<span class="hljs-regexp">/http:/</span>,<span class="hljs-string">'https:'</span>),
  <span class="hljs-attr">lrc</span>:<span class="hljs-string">`/api/lyric/<span class="hljs-subst">${item.id}</span>`</span><span class="hljs-comment">//这里歌词写上我们定义的接口地址</span>
}
<span class="hljs-comment">//...</span></code></pre>
<h3 id="articleHeader6">测试一下吧</h3>
<p>通过以上处理，我们接口就返回我们自定义的数据格式了</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="# Request

https://localhost:3000/api/playlist/2119983629

# Response

{
  &quot;success&quot;: true,
  &quot;data&quot;: [
     {
      &quot;id&quot;: 515573221,
      &quot;name&quot;: &quot;Sweet Memory&quot;,
      &quot;artist&quot;: &quot;MACO&quot;,
      &quot;url&quot;: &quot;https://music.163.com/song/media/outer/url?id=515573221.mp3&quot;,
      &quot;cover&quot;: &quot;https://p1.music.126.net/-U7mfaIjENUu8G_O0Dhv8g==/18419018788768520.jpg&quot;,
      &quot;lrc&quot;: &quot;/api/lyric/515573221&quot;
    },
    {
      &quot;id&quot;: 488388942,
      &quot;name&quot;: &quot;願い~あの頃のキミへ~&quot;,
      &quot;artist&quot;: &quot;當山みれい&quot;,
      &quot;url&quot;: &quot;https://music.163.com/song/media/outer/url?id=488388942.mp3&quot;,
      &quot;cover&quot;: &quot;https://p1.music.126.net/kbLlBkGfEcA3RJyC5JhkDA==/18346451021830743.jpg&quot;,
      &quot;lrc&quot;: &quot;/api/lyric/488388942&quot;
    },
    ...
  ],
  &quot;message&quot;: &quot;操作成功&quot;
}" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs vala"><code><span class="hljs-meta"># Request</span>

https:<span class="hljs-comment">//localhost:3000/api/playlist/2119983629</span>

<span class="hljs-meta"># Response</span>

{
  <span class="hljs-string">"success"</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-string">"data"</span>: [
     {
      <span class="hljs-string">"id"</span>: <span class="hljs-number">515573221</span>,
      <span class="hljs-string">"name"</span>: <span class="hljs-string">"Sweet Memory"</span>,
      <span class="hljs-string">"artist"</span>: <span class="hljs-string">"MACO"</span>,
      <span class="hljs-string">"url"</span>: <span class="hljs-string">"https://music.163.com/song/media/outer/url?id=515573221.mp3"</span>,
      <span class="hljs-string">"cover"</span>: <span class="hljs-string">"https://p1.music.126.net/-U7mfaIjENUu8G_O0Dhv8g==/18419018788768520.jpg"</span>,
      <span class="hljs-string">"lrc"</span>: <span class="hljs-string">"/api/lyric/515573221"</span>
    },
    {
      <span class="hljs-string">"id"</span>: <span class="hljs-number">488388942</span>,
      <span class="hljs-string">"name"</span>: <span class="hljs-string">"願い~あの頃のキミへ~"</span>,
      <span class="hljs-string">"artist"</span>: <span class="hljs-string">"當山みれい"</span>,
      <span class="hljs-string">"url"</span>: <span class="hljs-string">"https://music.163.com/song/media/outer/url?id=488388942.mp3"</span>,
      <span class="hljs-string">"cover"</span>: <span class="hljs-string">"https://p1.music.126.net/kbLlBkGfEcA3RJyC5JhkDA==/18346451021830743.jpg"</span>,
      <span class="hljs-string">"lrc"</span>: <span class="hljs-string">"/api/lyric/488388942"</span>
    },
    ...
  ],
  <span class="hljs-string">"message"</span>: <span class="hljs-string">"操作成功"</span>
}</code></pre>
<h2 id="articleHeader7">添加到博客</h2>
<p>其实上面对接口的数据改造才是关键，下面添加到自己的页面就很简单了。</p>
<p>如果你是传统HTML页面，可以直接文章开头的方式引用</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="<link rel=&quot;stylesheet&quot; href=&quot;APlayer.min.css&quot;>
<div id=&quot;aplayer&quot;></div>
<script src=&quot;APlayer.min.js&quot;></script>" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="xml hljs"><code class="html"><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"APlayer.min.css"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"aplayer"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"APlayer.min.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="const ap = new APlayer({
    container: document.getElementById('aplayer'),
    audio: [{
        name: 'name',
        artist: 'artist',
        url: 'url.mp3',
        cover: 'cover.jpg'
    }]
});" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs dart"><code><span class="hljs-keyword">const</span> ap = <span class="hljs-keyword">new</span> APlayer({
    container: <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'aplayer'</span>),
    audio: [{
        name: <span class="hljs-string">'name'</span>,
        artist: <span class="hljs-string">'artist'</span>,
        url: <span class="hljs-string">'url.mp3'</span>,
        cover: <span class="hljs-string">'cover.jpg'</span>
    }]
});</code></pre>
<p>如果使用了使用模块管理器:</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="import 'APlayer/dist/APlayer.min.css';
import APlayer from 'APlayer';

const ap = new APlayer(options);" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="javascript hljs"><code class="js"><span class="hljs-keyword">import</span> <span class="hljs-string">'APlayer/dist/APlayer.min.css'</span>;
<span class="hljs-keyword">import</span> APlayer <span class="hljs-keyword">from</span> <span class="hljs-string">'APlayer'</span>;

<span class="hljs-keyword">const</span> ap = <span class="hljs-keyword">new</span> APlayer(options);</code></pre>
<p>如果是<code>react</code>项目，那么可以用封装好的<a href="https://github.com/sabrinaluo/react-aplayer" rel="nofollow noreferrer" target="_blank"><code>react-aplayer</code></a></p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="import React from 'react';
import ReactAplayer from 'react-aplayer';

export default class App extends React.Component {
  // event binding example
  onPlay = () => {
    console.log('on play');
  };

  onPause = () => {
    console.log('on pause');
  };

  // example of access aplayer instance
  onInit = ap => {
    this.ap = ap;
  };

  render() {
    const props = {
      theme: '#F57F17',
      lrcType: 3,
      audio: [
        {
          name: '光るなら',
          artist: 'Goose house',
          url: 'https://moeplayer.b0.upaiyun.com/aplayer/hikarunara.mp3',
          cover: 'https://moeplayer.b0.upaiyun.com/aplayer/hikarunara.jpg',
          lrc: 'https://moeplayer.b0.upaiyun.com/aplayer/hikarunara.lrc',
          theme: '#ebd0c2'
        }
      ]
    };

    return (
      <div>
        <ReactAplayer
          {...props}
          onInit={this.onInit}
          onPlay={this.onPlay}
          onPause={this.onPause}
        />
        {/* example of access aplayer instance API */}
        <button onClick={() => this.ap.toggle()}>toggle</button>
      <div>
    );
  }
}" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="javascript hljs"><code class="js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> ReactAplayer <span class="hljs-keyword">from</span> <span class="hljs-string">'react-aplayer'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">App</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
  <span class="hljs-comment">// event binding example</span>
  onPlay = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'on play'</span>);
  };

  onPause = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'on pause'</span>);
  };

  <span class="hljs-comment">// example of access aplayer instance</span>
  onInit = <span class="hljs-function"><span class="hljs-params">ap</span> =&gt;</span> {
    <span class="hljs-keyword">this</span>.ap = ap;
  };

  render() {
    <span class="hljs-keyword">const</span> props = {
      <span class="hljs-attr">theme</span>: <span class="hljs-string">'#F57F17'</span>,
      <span class="hljs-attr">lrcType</span>: <span class="hljs-number">3</span>,
      <span class="hljs-attr">audio</span>: [
        {
          <span class="hljs-attr">name</span>: <span class="hljs-string">'光るなら'</span>,
          <span class="hljs-attr">artist</span>: <span class="hljs-string">'Goose house'</span>,
          <span class="hljs-attr">url</span>: <span class="hljs-string">'https://moeplayer.b0.upaiyun.com/aplayer/hikarunara.mp3'</span>,
          <span class="hljs-attr">cover</span>: <span class="hljs-string">'https://moeplayer.b0.upaiyun.com/aplayer/hikarunara.jpg'</span>,
          <span class="hljs-attr">lrc</span>: <span class="hljs-string">'https://moeplayer.b0.upaiyun.com/aplayer/hikarunara.lrc'</span>,
          <span class="hljs-attr">theme</span>: <span class="hljs-string">'#ebd0c2'</span>
        }
      ]
    };

    <span class="hljs-keyword">return</span> (
      &lt;div&gt;
        &lt;ReactAplayer
          {...props}
          onInit={this.onInit}
          onPlay={this.onPlay}
          onPause={this.onPause}
        /&gt;
        {/* example of access aplayer instance API */}
        &lt;button onClick={() =&gt; this.ap.toggle()}&gt;toggle&lt;/button&gt;
      &lt;div&gt;
    );
  }
}</code></pre>
<p>如果是<code>vue</code>项目，可以使用<a href="https://github.com/SevenOutman/vue-aplayer" rel="nofollow noreferrer" target="_blank"><code>vue-aplayer</code></a></p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="<aplayer autoplay
  :music=&quot;{
    title: 'secret base~君がくれたもの~',
    artist: 'Silent Siren',
    src: 'https://moeplayer.b0.upaiyun.com/aplayer/secretbase.mp3',
    pic: 'https://moeplayer.b0.upaiyun.com/aplayer/secretbase.jpg'
  }&quot;
/>" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs vim"><code>&lt;aplayer autoplay
  :music=<span class="hljs-comment">"{</span>
    title: <span class="hljs-string">'secret base~君がくれたもの~'</span>,
    artis<span class="hljs-variable">t:</span> <span class="hljs-string">'Silent Siren'</span>,
    src: <span class="hljs-string">'https://moeplayer.b0.upaiyun.com/aplayer/secretbase.mp3'</span>,
    pic: <span class="hljs-string">'https://moeplayer.b0.upaiyun.com/aplayer/secretbase.jpg'</span>
  }<span class="hljs-comment">"</span>
/&gt;</code></pre>
<p>其他更多可以参考<a href="https://aplayer.js.org/#/zh-Hans/ecosystem" rel="nofollow noreferrer" target="_blank">Aplayer生态</a></p>
<h2 id="articleHeader8">小节</h2>
<p>这里的歌单，我选择了自己收藏的歌曲。每次用网易云音乐客户端播放听歌的时候，收藏的歌曲，在我的博客上也可以同步进行更新。</p>
<p>差不多就这些了，可能对于专业后端开发来说，这些完全就是小学生操作，但是对于一个前端来说，做这些事就感觉闯入了一片新天地，还是有很多感悟的。很多以前前端做不了的事，现在<code>nodeJS</code>也能帮我们解决，进一步打通了前后端的天然屏障，离全栈也越来越近了 ^ ^</p>
<p>大家如果喜欢<a href="https://blog.codelabo.cn" rel="nofollow noreferrer" target="_blank">我的博客</a>，可以多多关注一下</p>

                
{{< /raw >}}

# 版权声明
本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，

本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。

原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！

## 原文标题
给自己的网站添加网易云音乐歌单吧^ ^

## 原文链接
[https://segmentfault.com/a/1190000016786093](https://segmentfault.com/a/1190000016786093)

