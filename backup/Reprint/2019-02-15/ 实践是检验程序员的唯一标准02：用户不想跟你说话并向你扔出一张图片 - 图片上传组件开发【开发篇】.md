---
title: ' 实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】' 
date: 2019-02-15 2:30:44
hidden: true
slug: gij1sdp355j
categories: [reprint]
---

{{< raw >}}

                    
<p>温馨提示：这里除了一些幼稚的小组件啥也没有</p>
<h1 id="articleHeader0">写在前面</h1>
<p>距离写完上一篇<a href="https://segmentfault.com/a/1190000013038300?_ea=4373226">实践是检验程序员的唯一标准01：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【思路篇】</a>过去了大半年，才开始写开发篇真的是令人悲哀，不过有句话说的好，开始做一件事最好的时间是大半年前，其次是现在<br>上一篇偏设计和尝试技术能否实现，这一篇会在工程层面实现，并且保证他能被（轻易）引用！<br>上一篇文章的评论里好多同学（差不多3个人）希望我传到git上。好吧，本文最终的劳动成果会放上去的，不过那是下一篇文章干的事了，不过这里我已经把全部源码贴上来了- -</p>
<h1 id="articleHeader1">功能完善</h1>
<p>在之前那篇文章中，又习惯性的做了很多无用的设计，你就是一个上传图片的组件，低调点谢谢，所以最终我搞成了这样子</p>
<p>state-1:初始状态<br><span class="img-wrap"><img data-src="/img/bVbip19?w=684&amp;h=678" src="https://static.alili.tech/img/bVbip19?w=684&amp;h=678" alt="图片描述" title="图片描述" style="cursor: pointer; display: inline;"></span></p>
<p>state-2:完成载入状态<br><span class="img-wrap"><img data-src="/img/bVbip2i?w=700&amp;h=668" src="https://static.alili.tech/img/bVbip2i?w=700&amp;h=668" alt="图片描述" title="图片描述" style="cursor: pointer;"></span></p>
<p>state-3:图片截取<br><span class="img-wrap"><img data-src="/img/bVbip2p?w=1166&amp;h=688" src="https://static.alili.tech/img/bVbip2p?w=1166&amp;h=688" alt="图片描述" title="图片描述" style="cursor: pointer; display: inline;"></span></p>
<p>总体来说，把能剩的按钮都省了，本体就是个框，适合放在任何地方，此外为了防止破坏页面的整体性，组件不再自带截图预览功能，而是通过事件的方式将所截取的图像的DataURL实时穿给父组件，方便父组件自由使用（图中的展示区就是在父组件中写的）</p>
<h1 id="articleHeader2">组件设计</h1>
<p>在一开始设计组件的时候简直就是父母给孩子报课外班的心情，希望能尽可能的满足各种需求，但转头想想先把最基本的功能（做个好人）做好别的都是可以慢慢加上的（懒）</p>
<p>要保证基本功能能（好）用，大概以下这几点：<br>1.要让其大小可控，方便应用于不同场景，所以组件的宽高有必要成为参数<br>2.对于被裁出的部分，在原图中看和拎出来单独看视觉上差别还挺大的，所以一个可以实时单独展现所截取内容的功能就挺重要的<br>3.在大多数情况下，裁剪区域的选定可能是有固定比例的，所以要将是否限制比例以及按照什么比例作为参数，根据适用场景决定</p>
<p>所以组件的参数和事件大概也就这么几个了</p>
<p><strong>参数名：inputWidth</strong><br>说明：组件宽度<br>类型：Number<br>默认值：200px</p>
<p><strong>参数名：inputHeight</strong><br>说明：组件高度<br>类型：Number<br>默认值：200px</p>
<p><strong>参数名：cuttingRatio</strong><br>说明：裁剪比例，限定比例为宽/高，为空时没有比例限制<br>类型：Number<br>默认值：0</p>
<p><strong>事件名：getImageData</strong><br>说明：框选完成后鼠标抬起时触发，返回选定区域的图像数据<br>参数：blobData<br>参数格式：Blob对象</p>
<p><strong>事件名：getImageDataURL</strong><br>说明：鼠标拖动的每一帧触发，返回选定区域的图像数据，可用于预览区域展示<br>参数：dataURL<br>参数格式：dataURL</p>
<h1 id="articleHeader3">代码实现</h1>
<h2 id="articleHeader4">HTML框架搭建</h2>
<p>由于功能很单一，HTML的布局也就很简单<br>大概结构如下</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="<根标签>
    <提示信息 />//绝对定位，位于组件下方，初始状态不可见，载入图片后出现
    <重新选择按钮 />//绝对定位，位于组件右上角，初始状态不可见，载入图片后出现
    <初始及载入层 />//绝对定位，位于画布上方，大小与画布完全相同
    <画布 />//canvas
    <隐藏的input标签 />//不可见
</根标签>
" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs dts"><code><span class="hljs-params">&lt;根标签&gt;</span>
    <span class="hljs-params">&lt;提示信息 /&gt;</span><span class="hljs-comment">//绝对定位，位于组件下方，初始状态不可见，载入图片后出现</span>
    <span class="hljs-params">&lt;重新选择按钮 /&gt;</span><span class="hljs-comment">//绝对定位，位于组件右上角，初始状态不可见，载入图片后出现</span>
    <span class="hljs-params">&lt;初始及载入层 /&gt;</span><span class="hljs-comment">//绝对定位，位于画布上方，大小与画布完全相同</span>
    <span class="hljs-params">&lt;画布 /&gt;</span><span class="hljs-comment">//canvas</span>
    <span class="hljs-params">&lt;隐藏的input标签 /&gt;</span><span class="hljs-comment">//不可见</span>
<span class="hljs-params">&lt;/根标签&gt;</span>
</code></pre>
<p>HTML代码如下</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="<template>
    <div class=&quot;inputArea&quot; :style=&quot;{height:inputHeight+'px',width:inputWidth+'px'}&quot;>
        <!--提示区域-->
        <div class=&quot;notice&quot; :class=&quot;{showNotice:noticeFlag}&quot;>
            "{{"notice"}}"
            <div class=&quot;close-notice&quot; @click=&quot;closeNotice&quot;>X</div>
        </div>
        <!--重新选择按钮-->
        <div class=&quot;reloadBtn&quot; @click=&quot;openWindow&quot;>
            重新选择
        </div>
        <!--初始及载入层-->
        <div class=&quot;blankMask&quot; @click=&quot;openWindow&quot; v-if=&quot;loadFlag!=2&quot;>
            <img v-if=&quot;loadFlag==0&quot; src=&quot;../assets/img.png&quot; />
            <img v-if=&quot;loadFlag==1&quot; src=&quot;../assets/loading.png&quot; />
            <div class=&quot;text&quot;>"{{"loadFlag == 0?'点击浏览图片':'加载中'"}}"</div>
        </div>
        <!--画布-->
        <div class=&quot;canvasArea&quot;>
            <canvas id=&quot;inputAreaCanvas&quot; @mousedown=&quot;setStartPoint&quot; @mousemove=&quot;drawArea&quot; @mouseup=&quot;reset&quot;>    
            </canvas>
        </div>
        <!--隐藏的input标签-->
        <input id=&quot;input&quot; type=&quot;file&quot; @change=&quot;loadImg&quot; />
    </div>
</template>" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs dust"><code><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"inputArea"</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">"</span></span></span><span class="hljs-template-variable">{height:inputHeight+'px',width:inputWidth+'px'}</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span>&gt;</span>
        <span class="hljs-comment">&lt;!--提示区域--&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"notice"</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">"</span></span></span><span class="hljs-template-variable">{showNotice:noticeFlag}</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span>&gt;</span>
            </span><span class="hljs-template-variable">"{{"notice}</span><span class="xml">}
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"close-notice"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"closeNotice"</span>&gt;</span>X<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-comment">&lt;!--重新选择按钮--&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"reloadBtn"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"openWindow"</span>&gt;</span>
            重新选择
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-comment">&lt;!--初始及载入层--&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"blankMask"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"openWindow"</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"loadFlag!=2"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"loadFlag==0"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"../assets/img.png"</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"loadFlag==1"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"../assets/loading.png"</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text"</span>&gt;</span></span><span class="hljs-template-variable">"{{"loadFlag == 0?'点击浏览图片':'加载中'}</span><span class="xml">}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-comment">&lt;!--画布--&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"canvasArea"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"inputAreaCanvas"</span> @<span class="hljs-attr">mousedown</span>=<span class="hljs-string">"setStartPoint"</span> @<span class="hljs-attr">mousemove</span>=<span class="hljs-string">"drawArea"</span> @<span class="hljs-attr">mouseup</span>=<span class="hljs-string">"reset"</span>&gt;</span>    
            <span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-comment">&lt;!--隐藏的input标签--&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"input"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"file"</span> @<span class="hljs-attr">change</span>=<span class="hljs-string">"loadImg"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span></code></pre>
<p>对应的css如下</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="<style>    
    .inputArea {
        position: relative;
        background: #000;
    }

    .inputArea .notice {
        height: 30px;
        line-height: 30px;
        text-align: center;
        background: #FFF;
        color: #2C3E50;
        font-size: 12px;
        text-align: center;
        position: absolute;
        width: 90%;
        margin-left: 5%;
        left: 0px;
        transition: all .5s;
        bottom: -30px;
        opacity: 0;
        box-shadow: 0px 0px 5px rgba(0,0,0,0.3);
        border-radius: 2px;
        -moz-user-select: none;
        -ms-user-select: none;
        -webkit-user-select: none;
    }

    .inputArea .notice.showNotice {
        bottom: 0px;
        opacity: 1;
    }
    
    .inputArea .notice .close-notice {
        position: absolute;
        right: 10px;
        top: 0px;
        height: 30px;
        line-height: 30px;
        cursor: pointer;
    }
    
    .inputArea .reloadBtn {
        height: 20px;
        padding: 2px 5px 2px 5px;
        text-align: center;
        line-height: 20px;
        font-size: 12px;
        background: #FFFFFF;
        box-shadow: 0px 0px 5px rgba(0,0,0,0.3);
        color: #2C3E50;
        position: absolute;
        top: 5px;
        right: 5px;
        cursor: pointer;
        transition: all 0.5s;
    }
    
    .inputArea .reloadBtn:hover {
        box-shadow: 0px 0px 8px rgba(0,0,0,0.5);
    }

    .inputArea .blankMask {
        position: absolute;
        top: 0px;
        left: 0px;
        width: 100%;
        height: 100%;
        display: flex;
        color: gainsboro;
        border-radius: 2px;
        background: #FFF;
        cursor: pointer;
        flex-direction: column;
        -ms-flex-direction: column;
        justify-content: center;
        -webkit-justify-content: center;
        align-items: center;
        -webkit-align-items: center;
        transition: all 0.5s;
        z-index: 2;
    }
    
    .inputArea .blankMask:hover {
        background: #F6F6F6;
    }
    
    .inputArea .blankMask .text {
        margin-top: 10px;
        font-size: 16px;
        font-weight: bold;
    }
    
    .inputArea .blankMask img {
        height: 40px;
        width: 40px;
    }

    .inputArea .canvasArea {
        display: flex;
        align-items: center;
        -webkit-align-items: center;
        justify-content: center;
        -webkit-justify-content: center;
        height: 100%;
        width: 100%;
    }
    
    #input {
        display: none;
    }
</style>" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs xml"><code><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">    
    <span class="hljs-selector-class">.inputArea</span> {
        <span class="hljs-attribute">position</span>: relative;
        <span class="hljs-attribute">background</span>: <span class="hljs-number">#000</span>;
    }

    <span class="hljs-selector-class">.inputArea</span> <span class="hljs-selector-class">.notice</span> {
        <span class="hljs-attribute">height</span>: <span class="hljs-number">30px</span>;
        <span class="hljs-attribute">line-height</span>: <span class="hljs-number">30px</span>;
        <span class="hljs-attribute">text-align</span>: center;
        <span class="hljs-attribute">background</span>: <span class="hljs-number">#FFF</span>;
        <span class="hljs-attribute">color</span>: <span class="hljs-number">#2C3E50</span>;
        <span class="hljs-attribute">font-size</span>: <span class="hljs-number">12px</span>;
        <span class="hljs-attribute">text-align</span>: center;
        <span class="hljs-attribute">position</span>: absolute;
        <span class="hljs-attribute">width</span>: <span class="hljs-number">90%</span>;
        <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">5%</span>;
        <span class="hljs-attribute">left</span>: <span class="hljs-number">0px</span>;
        <span class="hljs-attribute">transition</span>: all .<span class="hljs-number">5s</span>;
        <span class="hljs-attribute">bottom</span>: -<span class="hljs-number">30px</span>;
        <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;
        <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0px</span> <span class="hljs-number">0px</span> <span class="hljs-number">5px</span> <span class="hljs-built_in">rgba</span>(0,0,0,0.3);
        <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">2px</span>;
        <span class="hljs-attribute">-moz-user-select</span>: none;
        <span class="hljs-attribute">-ms-user-select</span>: none;
        <span class="hljs-attribute">-webkit-user-select</span>: none;
    }

    <span class="hljs-selector-class">.inputArea</span> <span class="hljs-selector-class">.notice</span><span class="hljs-selector-class">.showNotice</span> {
        <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0px</span>;
        <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;
    }
    
    <span class="hljs-selector-class">.inputArea</span> <span class="hljs-selector-class">.notice</span> <span class="hljs-selector-class">.close-notice</span> {
        <span class="hljs-attribute">position</span>: absolute;
        <span class="hljs-attribute">right</span>: <span class="hljs-number">10px</span>;
        <span class="hljs-attribute">top</span>: <span class="hljs-number">0px</span>;
        <span class="hljs-attribute">height</span>: <span class="hljs-number">30px</span>;
        <span class="hljs-attribute">line-height</span>: <span class="hljs-number">30px</span>;
        <span class="hljs-attribute">cursor</span>: pointer;
    }
    
    <span class="hljs-selector-class">.inputArea</span> <span class="hljs-selector-class">.reloadBtn</span> {
        <span class="hljs-attribute">height</span>: <span class="hljs-number">20px</span>;
        <span class="hljs-attribute">padding</span>: <span class="hljs-number">2px</span> <span class="hljs-number">5px</span> <span class="hljs-number">2px</span> <span class="hljs-number">5px</span>;
        <span class="hljs-attribute">text-align</span>: center;
        <span class="hljs-attribute">line-height</span>: <span class="hljs-number">20px</span>;
        <span class="hljs-attribute">font-size</span>: <span class="hljs-number">12px</span>;
        <span class="hljs-attribute">background</span>: <span class="hljs-number">#FFFFFF</span>;
        <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0px</span> <span class="hljs-number">0px</span> <span class="hljs-number">5px</span> <span class="hljs-built_in">rgba</span>(0,0,0,0.3);
        <span class="hljs-attribute">color</span>: <span class="hljs-number">#2C3E50</span>;
        <span class="hljs-attribute">position</span>: absolute;
        <span class="hljs-attribute">top</span>: <span class="hljs-number">5px</span>;
        <span class="hljs-attribute">right</span>: <span class="hljs-number">5px</span>;
        <span class="hljs-attribute">cursor</span>: pointer;
        <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.5s</span>;
    }
    
    <span class="hljs-selector-class">.inputArea</span> <span class="hljs-selector-class">.reloadBtn</span><span class="hljs-selector-pseudo">:hover</span> {
        <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0px</span> <span class="hljs-number">0px</span> <span class="hljs-number">8px</span> <span class="hljs-built_in">rgba</span>(0,0,0,0.5);
    }

    <span class="hljs-selector-class">.inputArea</span> <span class="hljs-selector-class">.blankMask</span> {
        <span class="hljs-attribute">position</span>: absolute;
        <span class="hljs-attribute">top</span>: <span class="hljs-number">0px</span>;
        <span class="hljs-attribute">left</span>: <span class="hljs-number">0px</span>;
        <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
        <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
        <span class="hljs-attribute">display</span>: flex;
        <span class="hljs-attribute">color</span>: gainsboro;
        <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">2px</span>;
        <span class="hljs-attribute">background</span>: <span class="hljs-number">#FFF</span>;
        <span class="hljs-attribute">cursor</span>: pointer;
        <span class="hljs-attribute">flex-direction</span>: column;
        <span class="hljs-attribute">-ms-flex-direction</span>: column;
        <span class="hljs-attribute">justify-content</span>: center;
        <span class="hljs-attribute">-webkit-justify-content</span>: center;
        <span class="hljs-attribute">align-items</span>: center;
        <span class="hljs-attribute">-webkit-align-items</span>: center;
        <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.5s</span>;
        <span class="hljs-attribute">z-index</span>: <span class="hljs-number">2</span>;
    }
    
    <span class="hljs-selector-class">.inputArea</span> <span class="hljs-selector-class">.blankMask</span><span class="hljs-selector-pseudo">:hover</span> {
        <span class="hljs-attribute">background</span>: <span class="hljs-number">#F6F6F6</span>;
    }
    
    <span class="hljs-selector-class">.inputArea</span> <span class="hljs-selector-class">.blankMask</span> <span class="hljs-selector-class">.text</span> {
        <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">10px</span>;
        <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>;
        <span class="hljs-attribute">font-weight</span>: bold;
    }
    
    <span class="hljs-selector-class">.inputArea</span> <span class="hljs-selector-class">.blankMask</span> <span class="hljs-selector-tag">img</span> {
        <span class="hljs-attribute">height</span>: <span class="hljs-number">40px</span>;
        <span class="hljs-attribute">width</span>: <span class="hljs-number">40px</span>;
    }

    <span class="hljs-selector-class">.inputArea</span> <span class="hljs-selector-class">.canvasArea</span> {
        <span class="hljs-attribute">display</span>: flex;
        <span class="hljs-attribute">align-items</span>: center;
        <span class="hljs-attribute">-webkit-align-items</span>: center;
        <span class="hljs-attribute">justify-content</span>: center;
        <span class="hljs-attribute">-webkit-justify-content</span>: center;
        <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
        <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
    }
    
    <span class="hljs-selector-id">#input</span> {
        <span class="hljs-attribute">display</span>: none;
    }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></code></pre>
<h2 id="articleHeader5">参数及变量定义以及对象初始化</h2>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="props:{
    inputWidth:{
        type:Number,
        default:200
    },
    inputHeight:{
        type:Number,
        default:200
    },
    cuttingRatio:{
        type:Number,
        default:0
    }
},
data() {
    return {
        mouseDownFlag: false,//记录鼠标点击状态用标记
        loadFlag: 0,//记录图像家在状态用标记
        resultImgData: {},//被截取数据
        input: {},//输入框对象
        imgObj: new Image(),//图片对象
        inputAreaCanvas: {},//主体canvas对象
        inputArea2D: {},//主体CanvasRenderingContext2D对象
        notice: &quot;拖拽鼠标框选所需要的区域&quot;,//提示区域文本
        noticeFlag: false,//提示区域展示状态标记
        dataURL:&quot;&quot;,//被截取dataURL
        tempCanvas:{},//存放截取结果用canvas对象
        tempCanvas2D:{},//存放截取结果用CanvasRenderingContext2D对象
        resetX:0,//组件起点横坐标
        resetY:0,//组件起点纵坐标
        /*
        181031改：其实并不用这两个变量
        startX:0,//截取开始点横坐标
        startY:0,//截取开始点纵坐标
        */
        resultX:0,//截取结束点横坐标
        resultY:0,//截取结束点纵坐标
    }
},
mounted: function() {
    //对象初始化
    this.input = document.getElementById('input')
    this.inputAreaCanvas = document.getElementById(&quot;inputAreaCanvas&quot;);
    this.inputArea2D = this.inputAreaCanvas.getContext(&quot;2d&quot;);
    this.tempCanvas = document.createElement('canvas');
    this.tempCanvas2D = this.tempCanvas.getContext('2d');
}," title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs typescript"><code>props:{
    inputWidth:{
        <span class="hljs-keyword">type</span>:<span class="hljs-built_in">Number</span>,
        <span class="hljs-keyword">default</span>:<span class="hljs-number">200</span>
    },
    inputHeight:{
        <span class="hljs-keyword">type</span>:<span class="hljs-built_in">Number</span>,
        <span class="hljs-keyword">default</span>:<span class="hljs-number">200</span>
    },
    cuttingRatio:{
        <span class="hljs-keyword">type</span>:<span class="hljs-built_in">Number</span>,
        <span class="hljs-keyword">default</span>:<span class="hljs-number">0</span>
    }
},
data() {
    <span class="hljs-keyword">return</span> {
        mouseDownFlag: <span class="hljs-literal">false</span>,<span class="hljs-comment">//记录鼠标点击状态用标记</span>
        loadFlag: <span class="hljs-number">0</span>,<span class="hljs-comment">//记录图像家在状态用标记</span>
        resultImgData: {},<span class="hljs-comment">//被截取数据</span>
        input: {},<span class="hljs-comment">//输入框对象</span>
        imgObj: <span class="hljs-keyword">new</span> Image(),<span class="hljs-comment">//图片对象</span>
        inputAreaCanvas: {},<span class="hljs-comment">//主体canvas对象</span>
        inputArea2D: {},<span class="hljs-comment">//主体CanvasRenderingContext2D对象</span>
        notice: <span class="hljs-string">"拖拽鼠标框选所需要的区域"</span>,<span class="hljs-comment">//提示区域文本</span>
        noticeFlag: <span class="hljs-literal">false</span>,<span class="hljs-comment">//提示区域展示状态标记</span>
        dataURL:<span class="hljs-string">""</span>,<span class="hljs-comment">//被截取dataURL</span>
        tempCanvas:{},<span class="hljs-comment">//存放截取结果用canvas对象</span>
        tempCanvas2D:{},<span class="hljs-comment">//存放截取结果用CanvasRenderingContext2D对象</span>
        resetX:<span class="hljs-number">0</span>,<span class="hljs-comment">//组件起点横坐标</span>
        resetY:<span class="hljs-number">0</span>,<span class="hljs-comment">//组件起点纵坐标</span>
        <span class="hljs-comment">/*
        181031改：其实并不用这两个变量
        startX:0,//截取开始点横坐标
        startY:0,//截取开始点纵坐标
        */</span>
        resultX:<span class="hljs-number">0</span>,<span class="hljs-comment">//截取结束点横坐标</span>
        resultY:<span class="hljs-number">0</span>,<span class="hljs-comment">//截取结束点纵坐标</span>
    }
},
mounted: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-comment">//对象初始化</span>
    <span class="hljs-keyword">this</span>.input = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'input'</span>)
    <span class="hljs-keyword">this</span>.inputAreaCanvas = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"inputAreaCanvas"</span>);
    <span class="hljs-keyword">this</span>.inputArea2D = <span class="hljs-keyword">this</span>.inputAreaCanvas.getContext(<span class="hljs-string">"2d"</span>);
    <span class="hljs-keyword">this</span>.tempCanvas = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'canvas'</span>);
    <span class="hljs-keyword">this</span>.tempCanvas2D = <span class="hljs-keyword">this</span>.tempCanvas.getContext(<span class="hljs-string">'2d'</span>);
},</code></pre>
<h2 id="articleHeader6">图片的读取</h2>
<p><em>此部分开始放在methods对象下</em></p>
<p>图片读取的功能主要设计两个方法：</p>
<p><code>openWindow</code>方法主要用于触发隐藏的<code>&lt;input&gt;</code>标签的文件读取功能</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="//打开文件选择窗口
openWindow() {
    this.input.click();
}," title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs arduino"><code><span class="hljs-comment">//打开文件选择窗口</span>
openWindow() {
    <span class="hljs-keyword">this</span>.input.<span class="hljs-built_in">click</span>();
},</code></pre>
<p><code>loadImg</code>方法完成了以下几个步骤</p>
<ol>
<li>新建一个FileReader对象用来读取选中的图片文件</li>
<li>将原有的被选中的dataURL变量清空</li>
<li>将读取的图片文件转为dataURL格式</li>
<li>将dataURL赋给一个创建的image对象</li>
<li>计算image对象的长宽比决定图片渲染方式</li>
<li>获取canvas起点坐标</li>
<li>将image对象中的图像数据赋给canvas</li>
</ol>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="//载入图片方法，当图片被选中后，input的value发生改变时触发
loadImg() {
    let vm = this;
    let reader = new FileReader();
    //每次载入后传给父组件的dataURL清空
    this.dataURL = '';
    //文件为空时返回
    if(this.input.files[0] == null) {
        return
    }
    //开始载入图片，并将数据通过dataURL的方式读取，展现载入层信息
    this.loadFlag = 1;
    reader.readAsDataURL(this.input.files[0]);
    //读取完成后将图像的dataURL数据赋给image对象的src的属性，使其加载图像
    reader.onload = function(e) {
        vm.imgObj.src = e.target.result;
    }
    //图像加载完成，利用drawImage将image对象渲染至canvas
    this.imgObj.onload = function() {
        vm.loadFlag = 2;
        vm.noticeFlag = true;
         //计算载入图像的长宽比，决定图片显示方式
        let ratioHW = (vm.imgObj.height/vm.imgObj.width)
        //每张图片根据比例不同，总有一个方向占满显示区域
        if(ratioHW > 1) {
            vm.inputAreaCanvas.height = vm.inputHeight;
            vm.inputAreaCanvas.width = vm.inputHeight / ratioHW;
        } else {
            vm.inputAreaCanvas.width = vm.inputWidth;
            vm.inputAreaCanvas.height = vm.inputWidth * ratioHW;
        }

        /*
        181031改：其实并不用这两个变量，直接用offset属性即可
        //获取组件起点坐标
        vm.resetX = vm.inputAreaCanvas.getBoundingClientRect().left;
        vm.resetY = vm.inputAreaCanvas.getBoundingClientRect().top;
        */
        
        //将获取的图像数据选在至canvas
        vm.inputArea2D.clearRect(0, 0, vm.inputAreaCanvas.width, vm.inputAreaCanvas.height);
        vm.inputArea2D.drawImage(vm.imgObj, 0, 0, vm.inputAreaCanvas.width, vm.inputAreaCanvas.height);
        vm.inputArea2D.fillStyle = 'rgba(0,0,0,0.5)'; //设定为半透明的黑色
        vm.inputArea2D.fillRect(0, 0, vm.inputWidth, vm.inputHeight); //矩形A
    }
}," title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs processing"><code><span class="hljs-comment">//载入图片方法，当图片被选中后，input的value发生改变时触发</span>
loadImg() {
    let vm = <span class="hljs-keyword">this</span>;
    let reader = <span class="hljs-keyword">new</span> FileReader();
    <span class="hljs-comment">//每次载入后传给父组件的dataURL清空</span>
    <span class="hljs-keyword">this</span>.dataURL = <span class="hljs-string">''</span>;
    <span class="hljs-comment">//文件为空时返回</span>
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.input.files[<span class="hljs-number">0</span>] == <span class="hljs-keyword">null</span>) {
        <span class="hljs-keyword">return</span>
    }
    <span class="hljs-comment">//开始载入图片，并将数据通过dataURL的方式读取，展现载入层信息</span>
    <span class="hljs-keyword">this</span>.loadFlag = <span class="hljs-number">1</span>;
    reader.readAsDataURL(<span class="hljs-keyword">this</span>.input.files[<span class="hljs-number">0</span>]);
    <span class="hljs-comment">//读取完成后将图像的dataURL数据赋给image对象的src的属性，使其加载图像</span>
    reader.onload = function(e) {
        vm.imgObj.src = e.target.result;
    }
    <span class="hljs-comment">//图像加载完成，利用drawImage将image对象渲染至canvas</span>
    <span class="hljs-keyword">this</span>.imgObj.onload = function() {
        vm.loadFlag = <span class="hljs-number">2</span>;
        vm.noticeFlag = <span class="hljs-keyword">true</span>;
         <span class="hljs-comment">//计算载入图像的长宽比，决定图片显示方式</span>
        let ratioHW = (vm.imgObj.<span class="hljs-built_in">height</span>/vm.imgObj.<span class="hljs-built_in">width</span>)
        <span class="hljs-comment">//每张图片根据比例不同，总有一个方向占满显示区域</span>
        <span class="hljs-keyword">if</span>(ratioHW &gt; <span class="hljs-number">1</span>) {
            vm.inputAreaCanvas.<span class="hljs-built_in">height</span> = vm.inputHeight;
            vm.inputAreaCanvas.<span class="hljs-built_in">width</span> = vm.inputHeight / ratioHW;
        } <span class="hljs-keyword">else</span> {
            vm.inputAreaCanvas.<span class="hljs-built_in">width</span> = vm.inputWidth;
            vm.inputAreaCanvas.<span class="hljs-built_in">height</span> = vm.inputWidth * ratioHW;
        }

        <span class="hljs-comment">/*
        181031改：其实并不用这两个变量，直接用offset属性即可
        //获取组件起点坐标
        vm.resetX = vm.inputAreaCanvas.getBoundingClientRect().left;
        vm.resetY = vm.inputAreaCanvas.getBoundingClientRect().top;
        */</span>
        
        <span class="hljs-comment">//将获取的图像数据选在至canvas</span>
        vm.inputArea2D.clearRect(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, vm.inputAreaCanvas.<span class="hljs-built_in">width</span>, vm.inputAreaCanvas.<span class="hljs-built_in">height</span>);
        vm.inputArea2D.drawImage(vm.imgObj, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, vm.inputAreaCanvas.<span class="hljs-built_in">width</span>, vm.inputAreaCanvas.<span class="hljs-built_in">height</span>);
        vm.inputArea2D.fillStyle = <span class="hljs-string">'rgba(0,0,0,0.5)'</span>; <span class="hljs-comment">//设定为半透明的黑色</span>
        vm.inputArea2D.fillRect(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, vm.inputWidth, vm.inputHeight); <span class="hljs-comment">//矩形A</span>
    }
},</code></pre>
<h2 id="articleHeader7">图像的截取</h2>
<p>图像截取功能包含四个方法：</p>
<p><code>setStartPoint</code>方法用于获取截取范围的起点以及更改点击状态</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="//获取截取范围起始坐标，当鼠标在canvas标签上点击时触发
setStartPoint(e) {
    this.mouseDownFlag = true; //改变标记状态，置为点击状态
    this.startX = e.offsetX //获得起始点横坐标
    this.startY = e.offsetY //获得起始点纵坐标
}," title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs kotlin"><code><span class="hljs-comment">//获取截取范围起始坐标，当鼠标在canvas标签上点击时触发</span>
setStartPoint(e) {
    <span class="hljs-keyword">this</span>.mouseDownFlag = <span class="hljs-literal">true</span>; <span class="hljs-comment">//改变标记状态，置为点击状态</span>
    <span class="hljs-keyword">this</span>.startX = e.offsetX <span class="hljs-comment">//获得起始点横坐标</span>
    <span class="hljs-keyword">this</span>.startY = e.offsetY <span class="hljs-comment">//获得起始点纵坐标</span>
},</code></pre>
<p><code>drawArea</code>方法通过以下步骤实现了选定区域的展现和截取功能：</p>
<ol>
<li>取得实时鼠标坐标作为截取区域的终点</li>
<li>在被选择区域外绘制半透明蒙版</li>
<li>获取将所选区域图像对应imageData数据</li>
<li>利用新建的canvas对象将imageData转为dataURL</li>
</ol>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="//选择截取范围，当鼠标被拖动时触发
drawArea(e) {
     //当鼠标被拖动时触发（处于按下状态且移动）
    if(this.mouseDownFlag) {

        /*181031改：结束坐标的获取方式进行了优化，请忽略此处
        //在canvas标签上范围的终点横坐标
        this.resultX = parseInt(e.clientX - this.resetX);
        //在canvas标签上范围的终点纵坐标，根据比例参数决定
        if(this.cuttingRatio != 0) {
            //根据一定比例截取
            this.resultY = this.startY + parseInt((1 / this.cuttingRatio) * (this.resultX - this.startX))
        } else {
            //自由截取
            this.resultY = parseInt(e.clientY - this.resetY);
        }
        */
        
        //在canvas标签上范围的终点横坐标
        this.resultX = e.offsetX;
        //在canvas标签上范围的终点纵坐标，根据比例参数决定
        if(this.cuttingRatio != 0) {
            //根据一定比例截取
            this.resultY = this.startY + parseInt((1 / this.cuttingRatio) * (this.resultX - this.startX))
        } else {
            //自由截取
            this.resultY = e.offsetX;
        }
        //所选区域外阴影部分
        this.inputArea2D.clearRect(0, 0, this.inputWidth, this.inputHeight); //清空整个画面
        this.inputArea2D.drawImage(this.imgObj, 0, 0, this.inputAreaCanvas.width, this.inputAreaCanvas.height); //重新绘制图片
        this.inputArea2D.fillStyle = 'rgba(0,0,0,0.5)'; //设定为半透明的白色
        this.inputArea2D.fillRect(0, 0, this.resultX, this.startY); //矩形A
        this.inputArea2D.fillRect(this.resultX, 0, this.inputWidth, this.resultY); //矩形B
        this.inputArea2D.fillRect(this.startX, this.resultY, this.inputWidth - this.startX, this.inputHeight - this.resultY); //矩形C
        this.inputArea2D.fillRect(0, this.startY, this.startX, this.inputHeight - this.startY); //矩形D
        //当选择区域大于0时，将所选范围内的图像数据实时返回
        if(this.resultX - this.startX > 0 &amp;&amp; this.resultY - this.startY > 0) {
            this.resultImgData = this.inputArea2D.getImageData(this.startX, this.startY, this.resultX - this.startX, this.resultY - this.startY);
            //canvas to DataURL
            this.tempCanvas.width = this.resultImgData.width;
            this.tempCanvas.height = this.resultImgData.height;
            this.tempCanvas2D.putImageData(this.resultImgData, 0, 0)
            this.dataURL = this.tempCanvas.toDataURL('image/jpeg', 1.0);
        }
    }
}," title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs kotlin"><code><span class="hljs-comment">//选择截取范围，当鼠标被拖动时触发</span>
drawArea(e) {
     <span class="hljs-comment">//当鼠标被拖动时触发（处于按下状态且移动）</span>
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.mouseDownFlag) {

        <span class="hljs-comment">/*181031改：结束坐标的获取方式进行了优化，请忽略此处
        //在canvas标签上范围的终点横坐标
        this.resultX = parseInt(e.clientX - this.resetX);
        //在canvas标签上范围的终点纵坐标，根据比例参数决定
        if(this.cuttingRatio != 0) {
            //根据一定比例截取
            this.resultY = this.startY + parseInt((1 / this.cuttingRatio) * (this.resultX - this.startX))
        } else {
            //自由截取
            this.resultY = parseInt(e.clientY - this.resetY);
        }
        */</span>
        
        <span class="hljs-comment">//在canvas标签上范围的终点横坐标</span>
        <span class="hljs-keyword">this</span>.resultX = e.offsetX;
        <span class="hljs-comment">//在canvas标签上范围的终点纵坐标，根据比例参数决定</span>
        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.cuttingRatio != <span class="hljs-number">0</span>) {
            <span class="hljs-comment">//根据一定比例截取</span>
            <span class="hljs-keyword">this</span>.resultY = <span class="hljs-keyword">this</span>.startY + parseInt((<span class="hljs-number">1</span> / <span class="hljs-keyword">this</span>.cuttingRatio) * (<span class="hljs-keyword">this</span>.resultX - <span class="hljs-keyword">this</span>.startX))
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">//自由截取</span>
            <span class="hljs-keyword">this</span>.resultY = e.offsetX;
        }
        <span class="hljs-comment">//所选区域外阴影部分</span>
        <span class="hljs-keyword">this</span>.inputArea2D.clearRect(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-keyword">this</span>.inputWidth, <span class="hljs-keyword">this</span>.inputHeight); <span class="hljs-comment">//清空整个画面</span>
        <span class="hljs-keyword">this</span>.inputArea2D.drawImage(<span class="hljs-keyword">this</span>.imgObj, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-keyword">this</span>.inputAreaCanvas.width, <span class="hljs-keyword">this</span>.inputAreaCanvas.height); <span class="hljs-comment">//重新绘制图片</span>
        <span class="hljs-keyword">this</span>.inputArea2D.fillStyle = <span class="hljs-string">'rgba(0,0,0,0.5)'</span>; <span class="hljs-comment">//设定为半透明的白色</span>
        <span class="hljs-keyword">this</span>.inputArea2D.fillRect(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-keyword">this</span>.resultX, <span class="hljs-keyword">this</span>.startY); <span class="hljs-comment">//矩形A</span>
        <span class="hljs-keyword">this</span>.inputArea2D.fillRect(<span class="hljs-keyword">this</span>.resultX, <span class="hljs-number">0</span>, <span class="hljs-keyword">this</span>.inputWidth, <span class="hljs-keyword">this</span>.resultY); <span class="hljs-comment">//矩形B</span>
        <span class="hljs-keyword">this</span>.inputArea2D.fillRect(<span class="hljs-keyword">this</span>.startX, <span class="hljs-keyword">this</span>.resultY, <span class="hljs-keyword">this</span>.inputWidth - <span class="hljs-keyword">this</span>.startX, <span class="hljs-keyword">this</span>.inputHeight - <span class="hljs-keyword">this</span>.resultY); <span class="hljs-comment">//矩形C</span>
        <span class="hljs-keyword">this</span>.inputArea2D.fillRect(<span class="hljs-number">0</span>, <span class="hljs-keyword">this</span>.startY, <span class="hljs-keyword">this</span>.startX, <span class="hljs-keyword">this</span>.inputHeight - <span class="hljs-keyword">this</span>.startY); <span class="hljs-comment">//矩形D</span>
        <span class="hljs-comment">//当选择区域大于0时，将所选范围内的图像数据实时返回</span>
        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.resultX - <span class="hljs-keyword">this</span>.startX &gt; <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-keyword">this</span>.resultY - <span class="hljs-keyword">this</span>.startY &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">this</span>.resultImgData = <span class="hljs-keyword">this</span>.inputArea2D.getImageData(<span class="hljs-keyword">this</span>.startX, <span class="hljs-keyword">this</span>.startY, <span class="hljs-keyword">this</span>.resultX - <span class="hljs-keyword">this</span>.startX, <span class="hljs-keyword">this</span>.resultY - <span class="hljs-keyword">this</span>.startY);
            <span class="hljs-comment">//canvas to DataURL</span>
            <span class="hljs-keyword">this</span>.tempCanvas.width = <span class="hljs-keyword">this</span>.resultImgData.width;
            <span class="hljs-keyword">this</span>.tempCanvas.height = <span class="hljs-keyword">this</span>.resultImgData.height;
            <span class="hljs-keyword">this</span>.tempCanvas2D.putImageData(<span class="hljs-keyword">this</span>.resultImgData, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
            <span class="hljs-keyword">this</span>.dataURL = <span class="hljs-keyword">this</span>.tempCanvas.toDataURL(<span class="hljs-string">'image/jpeg'</span>, <span class="hljs-number">1.0</span>);
        }
    }
},</code></pre>
<p><code>reset</code>方法用于重制鼠标点击状态，并获取blob格式的所截图像数据，触发<code>getImageData</code>事件将数据专递给父组件</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="//结束选择截取范围，返回所选范围的数据，重制鼠标状态，当鼠标点击结束时触发
reset() {
    this.mouseDownFlag = false; //将标志置为已抬起状态
    let blob = this.dataURLtoBlob(this.dataURL)
    this.$emit('getImageData', blob);
}," title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs kotlin"><code><span class="hljs-comment">//结束选择截取范围，返回所选范围的数据，重制鼠标状态，当鼠标点击结束时触发</span>
reset() {
    <span class="hljs-keyword">this</span>.mouseDownFlag = <span class="hljs-literal">false</span>; <span class="hljs-comment">//将标志置为已抬起状态</span>
    let blob = <span class="hljs-keyword">this</span>.dataURLtoBlob(<span class="hljs-keyword">this</span>.dataURL)
    <span class="hljs-keyword">this</span>.$emit(<span class="hljs-string">'getImageData'</span>, blob);
},</code></pre>
<p>dataURLtoBlob方法的作用是将dataURL对象转化为Blob对象，来自<a href="https://www.cnblogs.com/jyuf/p/7251591.html" rel="nofollow noreferrer" target="_blank">Blob/DataURL/canvas/image的相互转换-Lorem</a><br>由于在IE中并不支持Canvas.toBlob，所以需要这里走个弯路，自己写一下这个方法</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="//DataURL to Blob，兼容IE
dataURLtoBlob(dataurl) {
    let arr = dataurl.split(',')
    let mime = arr[0].match(/:(.*?);/)[1]
    let bstr = atob(arr[1])
    let n = bstr.length
    let u8arr = new Uint8Array(n)
    while(n--) {
        u8arr[n] = bstr.charCodeAt(n)
    }
    return new Blob([u8arr], {
        type: mime
    });
}" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs typescript"><code><span class="hljs-comment">//DataURL to Blob，兼容IE</span>
dataURLtoBlob(dataurl) {
    <span class="hljs-keyword">let</span> arr = dataurl.split(<span class="hljs-string">','</span>)
    <span class="hljs-keyword">let</span> mime = arr[<span class="hljs-number">0</span>].match(<span class="hljs-regexp">/:(.*?);/</span>)[<span class="hljs-number">1</span>]
    <span class="hljs-keyword">let</span> bstr = atob(arr[<span class="hljs-number">1</span>])
    <span class="hljs-keyword">let</span> n = bstr.length
    <span class="hljs-keyword">let</span> u8arr = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(n)
    <span class="hljs-keyword">while</span>(n--) {
        u8arr[n] = bstr.charCodeAt(n)
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Blob([u8arr], {
        <span class="hljs-keyword">type</span>: mime
    });
}</code></pre>
<h2 id="articleHeader8">其他方法</h2>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="//关闭提示信息
closeNotice() {
    this.noticeFlag = false
}," title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs stylus"><code><span class="hljs-comment">//关闭提示信息</span>
<span class="hljs-function"><span class="hljs-title">closeNotice</span><span class="hljs-params">()</span></span> {
    this<span class="hljs-selector-class">.noticeFlag</span> = false
},</code></pre>
<p>通过监听<code>dataURL</code>的变化，将结果实时返回给父组件以达到预览的目的</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="watch:{
    dataURL:function(newVal,oldVal){
        this.$emit('getImageDataUrl', this.dataURL)//将所截图的dataURL返回给父组件，共预览使用
    }
}," title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs css"><code><span class="hljs-selector-tag">watch</span>:{
    <span class="hljs-attribute">dataURL</span>:<span class="hljs-built_in">function</span>(newVal,oldVal){
        this.$<span class="hljs-built_in">emit</span>(<span class="hljs-string">'getImageDataUrl'</span>, this.dataURL)//将所截图的dataURL返回给父组件，共预览使用
    }
},</code></pre>
<h1 id="articleHeader9">应用方式</h1>
<p>用起来嘛，就很简单了</p>
<h2 id="articleHeader10">html</h2>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="<template>
    <div id=&quot;app&quot;>      
        <MainBlock 
        @getImageData=&quot;getImageData&quot;
        @getImageDataUrl=&quot;getImageDataUrl&quot;
        :inputHeight='300' 
        :inputWidth='300' 
        ></MainBlock>     
        <img :src=&quot;src&quot;/>
    </div>
</template>" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs xml"><code><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span>      
        <span class="hljs-tag">&lt;<span class="hljs-name">MainBlock</span> 
        @<span class="hljs-attr">getImageData</span>=<span class="hljs-string">"getImageData"</span>
        @<span class="hljs-attr">getImageDataUrl</span>=<span class="hljs-string">"getImageDataUrl"</span>
        <span class="hljs-attr">:inputHeight</span>=<span class="hljs-string">'300'</span> 
        <span class="hljs-attr">:inputWidth</span>=<span class="hljs-string">'300'</span> 
        &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">MainBlock</span>&gt;</span>     
        <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">:src</span>=<span class="hljs-string">"src"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></code></pre>
<h2 id="articleHeader11">javascript</h2>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="<script>
    import MainBlock from './components/mainBlock'
    export default {
        name: 'App',
        components: {
            MainBlock,
        },
        data() {
            return {
                imageData: '',
                src: &quot;&quot;
            }
        },
        methods: {
            getImageData(imageData) {
                this.imageData = imageData
                console.log(this.imageData)
            },
            getImageDataUrl(dataUrl) {
                this.src = dataUrl
            }
        },
    }
</script>" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs xml"><code><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
    <span class="hljs-keyword">import</span> MainBlock <span class="hljs-keyword">from</span> <span class="hljs-string">'./components/mainBlock'</span>
    <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
        <span class="hljs-attr">name</span>: <span class="hljs-string">'App'</span>,
        <span class="hljs-attr">components</span>: {
            MainBlock,
        },
        data() {
            <span class="hljs-keyword">return</span> {
                <span class="hljs-attr">imageData</span>: <span class="hljs-string">''</span>,
                <span class="hljs-attr">src</span>: <span class="hljs-string">""</span>
            }
        },
        <span class="hljs-attr">methods</span>: {
            getImageData(imageData) {
                <span class="hljs-keyword">this</span>.imageData = imageData
                <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span>.imageData)
            },
            getImageDataUrl(dataUrl) {
                <span class="hljs-keyword">this</span>.src = dataUrl
            }
        },
    }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre>
<h1 id="articleHeader12">写在后面</h1>
<p>第一次写相对独立的组件<br>从有想法到完全实现成一个能用的组件，中间还是有很多路的，而且功能还简单的令人发质，怎么说呢感觉自己可以进步的空间还很大啊<br>不过令人欣慰的是这个组件已经用在单位的一个项目中了，可喜可贺<br>虽然拖了很久，不过还是有成就感的，希望能继续下去，谁知道能走到哪呢</p>
<p>欢迎大家挑错提意见，虽然不情愿，但是接受</p>
<p>能看到这的，功能应该都实现了把？！</p>
<h1 id="articleHeader13">181031修改</h1>
<p>之前应该是脑子抽了，其实在<code>drawArea</code>方法中，<code>e.offsetX和e.offsetY</code>就是</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="parseInt(e.clientX - this.resetX)
parseInt(e.clientY - this.resetY)" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs stylus"><code><span class="hljs-function"><span class="hljs-title">parseInt</span><span class="hljs-params">(e.clientX - this.resetX)</span></span>
<span class="hljs-function"><span class="hljs-title">parseInt</span><span class="hljs-params">(e.clientY - this.resetY)</span></span></code></pre>

                
{{< /raw >}}

# 版权声明
本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，

本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。

原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！

## 原文标题
 实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】

## 原文链接
[https://segmentfault.com/a/1190000016743925](https://segmentfault.com/a/1190000016743925)

