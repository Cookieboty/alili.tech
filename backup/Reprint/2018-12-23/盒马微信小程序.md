---
title: '盒马微信小程序' 
date: 2018-12-23 2:30:07
hidden: true
slug: ieb727ehnvj
categories: [reprint]
---

{{< raw >}}

                    
<p>盒马app刚出现，就吸足了眼球。最近看了看盒马界面，很Q，就想着仿照app写个小程序。</p>
<h2 id="articleHeader0">功能介绍</h2>
<p>好奇微信小程序是如何制作的，也对盒马app感兴趣，就尝试写了这个盒马小程序。实现了app的部分功能，还有部分功能未实现，和大家一起学习?<br>文章末有GitHub源项目代码地址</p>
<h3 id="articleHeader1">已实现的功能</h3>
<ul>
<li>购物车的操作。添加商品、删除商品</li>
<li>新增收货地址</li>
<li>点击二维码图片能扫一扫</li>
<li>图片轮播效果</li>
<li>滚动视图展示商品详情</li>
</ul>
<h2 id="articleHeader2">项目效果图</h2>
<h3 id="articleHeader3">页面简介</h3>
<p><span class="img-wrap"><img data-src="/img/remote/1460000012259914" src="https://static.alili.tech/img/remote/1460000012259914" alt="Alt text" title="Alt text" style="cursor: pointer;"></span></p>
<h3 id="articleHeader4">购物车的操作</h3>
<p><span class="img-wrap"><img data-src="/img/remote/1460000012259915" src="https://static.alili.tech/img/remote/1460000012259915" alt="Alt text" title="Alt text" style="cursor: pointer;"></span></p>
<h3 id="articleHeader5">添加收货地址</h3>
<p><span class="img-wrap"><img data-src="/img/remote/1460000012259916" src="https://static.alili.tech/img/remote/1460000012259916" alt="Alt text" title="Alt text" style="cursor: pointer;"></span></p>
<h2 id="articleHeader6">部分功能点实现介绍</h2>
<h3 id="articleHeader7">将商品加入购物车</h3>
<p>我使用easymock构建了一些数据，用于商品在列表展示。<br>这是wxml，用于商品的展示。</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="<scroll-view scroll-y>
    <block wx:for=&quot;"{{"goods"}}"&quot; wx:key=&quot;index&quot; wx:for-index=&quot;index&quot;>
        <view class=&quot;weui-cells&quot;>
            <view class=&quot;weui-cell&quot;>
                <view class=&quot;weui-cell__hd&quot;>
                    <image src=&quot;"{{"item.image"}}"&quot; />
                </view>
                <view class=&quot;weui-cell__bd&quot;>
                    <view class=&quot;goodsList__bd__intro&quot;>"{{"item.name"}}"</view>
                    <view class=&quot;view__bd__price&quot;>
                        <text class=&quot;price left&quot;>￥"{{"item.price"}}"/"{{"item.unit"}}"</text>
                        <text class=&quot;add right&quot; bindtap=&quot;addInCart&quot; id=&quot;"{{"index"}}"&quot;>+</text>
                    </view>
                </view>
            </view>
        </view>
    </block>
</scroll-view>" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs django"><code><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">scroll-view</span> <span class="hljs-attr">scroll-y</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">block</span> <span class="hljs-attr">wx:for</span>=<span class="hljs-string">"</span></span></span><span class="hljs-template-variable">"{{"goods"}}"</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span> <span class="hljs-attr">wx:key</span>=<span class="hljs-string">"index"</span> <span class="hljs-attr">wx:for-index</span>=<span class="hljs-string">"index"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"weui-cells"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"weui-cell"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"weui-cell__hd"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">image</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"</span></span></span><span class="hljs-template-variable">"{{"item.image"}}"</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span> /&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"weui-cell__bd"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"goodsList__bd__intro"</span>&gt;</span></span><span class="hljs-template-variable">"{{"item.name"}}"</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"view__bd__price"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"price left"</span>&gt;</span>￥</span><span class="hljs-template-variable">"{{"item.price"}}"</span><span class="xml">/</span><span class="hljs-template-variable">"{{"item.unit"}}"</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"add right"</span> <span class="hljs-attr">bindtap</span>=<span class="hljs-string">"addInCart"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"</span></span></span><span class="hljs-template-variable">"{{"index"}}"</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span>&gt;</span>+<span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">block</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">scroll-view</span>&gt;</span></span></code></pre>
<p>在执行for循环遍历数据内容的时候，为每一个商品添加了index，用于确定用户将哪一件商品加入了购物车。给加号添加了一个绑定事件，用户点击加号，能将该商品放入购物车列表。<br>js部分代码：<br>这里最重要的是在app.js中添加了一个全局变量cardList，用于存储用户加入购物车的商品。这样，就能实现多个页面都能对购物车列表的数据进行操作了。</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="globalData: {
  cardList: []
}" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs css"><code><span class="hljs-selector-tag">globalData</span>: {
  <span class="hljs-attribute">cardList</span>: []
}</code></pre>
<p>商品展示界面：页面开始加载的时候，就请求数据，用于商品列表的显示。</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="wx.request({
  url: &quot;https://www.easy-mock.com/mock/5a223b51707056548f086d8b/hema/getGoods&quot;,
  success: (res) => {
    console.log(res.data.data.goods);
    this.setData({
      goods: res.data.data.goods
    })
  }
})" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs roboconf"><code>wx.request({
  <span class="hljs-attribute">url</span>: "https://www<span class="hljs-variable">.easy-mock</span><span class="hljs-variable">.com</span>/mock/5a223b51707056548f086d8b/hema/getGoods",
  success: (res) =&gt; {
    console<span class="hljs-variable">.log</span>(res<span class="hljs-variable">.data</span><span class="hljs-variable">.data</span><span class="hljs-variable">.goods</span>);
    <span class="hljs-attribute">this.setData({
      goods</span>: res<span class="hljs-variable">.data</span><span class="hljs-variable">.data</span><span class="hljs-variable">.goods</span>
    })
  }
})</code></pre>
<p>用户将商品加入购物车执行的操作</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="addInCart: function(e) {
  const good = this.data.goods[e.currentTarget.id]; // 根据index，判断用户点击了哪个商品加入购物车
  const cart = app.globalData.cardList; // 获取购物车列表
  cart.push(good); // 用户选择商品加入购物车后，将该商品加入购物车列表
}," title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs actionscript"><code>addInCart: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
  <span class="hljs-keyword">const</span> good = <span class="hljs-keyword">this</span>.data.goods[e.currentTarget.id]; <span class="hljs-comment">// 根据index，判断用户点击了哪个商品加入购物车</span>
  <span class="hljs-keyword">const</span> cart = app.globalData.cardList; <span class="hljs-comment">// 获取购物车列表</span>
  cart.push(good); <span class="hljs-comment">// 用户选择商品加入购物车后，将该商品加入购物车列表</span>
},</code></pre>
<h3 id="articleHeader8">调整商品的购买数量</h3>
<p>将商品加入购物车后，还有可能对添加的商品进行加减，调整购买数量。<br>购物车wxml界面：</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="<block wx:for=&quot;"{{"goodsList"}}"&quot; wx:key=&quot;index&quot; data-index=&quot;index&quot;>
    <view class=&quot;weui-cell&quot;>
        <view class=&quot;weui-cell__hd&quot;>
            <icon type=&quot;success&quot; color=&quot;#23a3ff&quot;></icon>
        </view>
        <view class=&quot;weui-cell__bd&quot;>
            <image src=&quot;"{{"item.image"}}"&quot; />
        </view>
        <view class=&quot;weui-cell__ft right&quot;>
            <text class=&quot;proIntr left&quot;>"{{"item.name"}}"</text>
            <text class=&quot;price left&quot;>￥"{{"item.price"}}"/"{{"item.unit"}}"</text>
            <view class=&quot;count&quot;>
                <text class=&quot;reduce left&quot; bindtap=&quot;reduceCount&quot; id=&quot;"{{"index"}}"&quot;>-</text>
                <text class=&quot;number left&quot;>"{{"item.count"}}"</text>
                <text class=&quot;add left&quot; bindtap=&quot;addCount&quot; id=&quot;"{{"index"}}"&quot;>+</text>
            </view>
        </view>
    </view>
</block>" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs django"><code><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">block</span> <span class="hljs-attr">wx:for</span>=<span class="hljs-string">"</span></span></span><span class="hljs-template-variable">"{{"goodsList"}}"</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span> <span class="hljs-attr">wx:key</span>=<span class="hljs-string">"index"</span> <span class="hljs-attr">data-index</span>=<span class="hljs-string">"index"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"weui-cell"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"weui-cell__hd"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">icon</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"success"</span> <span class="hljs-attr">color</span>=<span class="hljs-string">"#23a3ff"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">icon</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"weui-cell__bd"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">image</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"</span></span></span><span class="hljs-template-variable">"{{"item.image"}}"</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"weui-cell__ft right"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"proIntr left"</span>&gt;</span></span><span class="hljs-template-variable">"{{"item.name"}}"</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"price left"</span>&gt;</span>￥</span><span class="hljs-template-variable">"{{"item.price"}}"</span><span class="xml">/</span><span class="hljs-template-variable">"{{"item.unit"}}"</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"count"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"reduce left"</span> <span class="hljs-attr">bindtap</span>=<span class="hljs-string">"reduceCount"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"</span></span></span><span class="hljs-template-variable">"{{"index"}}"</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span>&gt;</span>-<span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"number left"</span>&gt;</span></span><span class="hljs-template-variable">"{{"item.count"}}"</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"add left"</span> <span class="hljs-attr">bindtap</span>=<span class="hljs-string">"addCount"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"</span></span></span><span class="hljs-template-variable">"{{"index"}}"</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span>&gt;</span>+<span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">block</span>&gt;</span></span></code></pre>
<p>给加号减号分别添加了点击事件，循环时还要用index标出用户对购物车的哪一件商品进行了加减操作。<br>js部分：</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="onLoad: function (options) {
  this.setData({
    // 页面加载时就给购物车显示商品数量
    goodsList: app.globalData.cardList
  });
  this.sumMoney();
},
// 增加商品数量
addCount:function (e) {
  var that = this;
  console.log(e);
  const goodId = e.currentTarget.id;
  console.log(that.data.goodsList[goodId]);
  that.data.goodsList[goodId].count++;
  console.log(that.data.goodsList[goodId]);
  this.setData({
    goodsList: that.data.goodsList
  })
  this.sumMoney();
},
// 减少商品数量
reduceCount: function(e) {
  var that = this;
  const goodId = e.currentTarget.id;
  // console.log(that.data.goodsList[goodId]);
  if(that.data.goodsList[goodId].count <= 1) {
    that.data.goodsList[goodId].count = 1;
    wx.showModal({
      title: '数量小于1',
      content: '不允许操作',
      duration: 2000
    })
  } else {
    that.data.goodsList[goodId].count--;
  }
  // console.log(that.data.goodsList[goodId]);
  this.setData({
    goodsList: that.data.goodsList
  })
  this.sumMoney();
},
// 计算所有商品的钱数
sumMoney: function() {
  var count = 0;
  const goods = this.data.goodsList;
  console.log(goods);
  for(let i = 0; i < goods.length; i++) {
    // console.log(goods[i].count);
    // console.log(goods[i].price);
    count += goods[i].count*goods[i].price;
  }
  // console.log(count);
  this.setData({
    sum: count
  })
}," title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs javascript"><code>onLoad: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">options</span>) </span>{
  <span class="hljs-keyword">this</span>.setData({
    <span class="hljs-comment">// 页面加载时就给购物车显示商品数量</span>
    goodsList: app.globalData.cardList
  });
  <span class="hljs-keyword">this</span>.sumMoney();
},
<span class="hljs-comment">// 增加商品数量</span>
addCount:<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
  <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;
  <span class="hljs-built_in">console</span>.log(e);
  <span class="hljs-keyword">const</span> goodId = e.currentTarget.id;
  <span class="hljs-built_in">console</span>.log(that.data.goodsList[goodId]);
  that.data.goodsList[goodId].count++;
  <span class="hljs-built_in">console</span>.log(that.data.goodsList[goodId]);
  <span class="hljs-keyword">this</span>.setData({
    <span class="hljs-attr">goodsList</span>: that.data.goodsList
  })
  <span class="hljs-keyword">this</span>.sumMoney();
},
<span class="hljs-comment">// 减少商品数量</span>
reduceCount: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
  <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;
  <span class="hljs-keyword">const</span> goodId = e.currentTarget.id;
  <span class="hljs-comment">// console.log(that.data.goodsList[goodId]);</span>
  <span class="hljs-keyword">if</span>(that.data.goodsList[goodId].count &lt;= <span class="hljs-number">1</span>) {
    that.data.goodsList[goodId].count = <span class="hljs-number">1</span>;
    wx.showModal({
      <span class="hljs-attr">title</span>: <span class="hljs-string">'数量小于1'</span>,
      <span class="hljs-attr">content</span>: <span class="hljs-string">'不允许操作'</span>,
      <span class="hljs-attr">duration</span>: <span class="hljs-number">2000</span>
    })
  } <span class="hljs-keyword">else</span> {
    that.data.goodsList[goodId].count--;
  }
  <span class="hljs-comment">// console.log(that.data.goodsList[goodId]);</span>
  <span class="hljs-keyword">this</span>.setData({
    <span class="hljs-attr">goodsList</span>: that.data.goodsList
  })
  <span class="hljs-keyword">this</span>.sumMoney();
},
<span class="hljs-comment">// 计算所有商品的钱数</span>
sumMoney: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> count = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">const</span> goods = <span class="hljs-keyword">this</span>.data.goodsList;
  <span class="hljs-built_in">console</span>.log(goods);
  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; goods.length; i++) {
    <span class="hljs-comment">// console.log(goods[i].count);</span>
    <span class="hljs-comment">// console.log(goods[i].price);</span>
    count += goods[i].count*goods[i].price;
  }
  <span class="hljs-comment">// console.log(count);</span>
  <span class="hljs-keyword">this</span>.setData({
    <span class="hljs-attr">sum</span>: count
  })
},</code></pre>
<p>这个界面，我不确定获得的数据是什么，就反复测试了多次。</p>
<h3 id="articleHeader9">新增默认收货地址</h3>
<p>在输入地址的界面，为每一个输入框都添加了监听输入的事件，用于监听用户输入的内容。<br>例如：</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="<view class=&quot;weui-cell&quot;>
    <view class=&quot;weui-cell__hd&quot;>
        <text class=&quot;weui-label mr60&quot;>收货地址</text>
    </view>
    <view class=&quot;weui-cell__bd&quot;>
        // 绑定的监听输入框事件 bindinput=&quot;getAddress&quot;
        <input bindinput=&quot;getAddress&quot; class=&quot;weui-input&quot; placeholder=&quot;请输入收货地址&quot; />
    </view>
</view>" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs javascript"><code>&lt;view <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">"weui-cell"</span>&gt;
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"weui-cell__hd"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"weui-label mr60"</span>&gt;</span>收货地址<span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span></span>
    &lt;view <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">"weui-cell__bd"</span>&gt;
        <span class="hljs-comment">// 绑定的监听输入框事件 bindinput="getAddress"</span>
        &lt;input bindinput=<span class="hljs-string">"getAddress"</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">"weui-input"</span> placeholder=<span class="hljs-string">"请输入收货地址"</span> /&gt;
    <span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span></span>
&lt;<span class="hljs-regexp">/view&gt;</span></code></pre>
<p>我将获得的用户输入的默认地址存储到了storage中。<br>【划重点：微信小程序的storage存储大小是由限制的，不能将大量数据放在storage中】<br>js部分：</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="// 页面的初始数据，用户输入的收货地址、门牌号、姓名、联系电话
data: {
address: '',
num: '',
name: '',
phone: ''
},
backToChooseAddr: function() {
wx.navigateTo({
  url: &quot;../chooseAddress/chooseAddress&quot;
});
},
getAddress: function(e) {
this.setData({
  address: e.detail.value
})
},
getNum: function(e) {
this.setData({
  num: e.detail.value
})
},
getName: function(e) {
this.setData({
  name: e.detail.value
})
},
getPhone: function(e) {
this.setData({
  phone: e.detail.value
})
},
// 用户点击保存后，对输入的数据进行存储，并反馈存储状态
saveInfo: function() {
wx.setStorage({
  key: &quot;name&quot;,
  data: [{address:this.data.address}, {num: this.data.num}, {name: this.data.name}, {phone: this.data.phone}],
  success: function() {
    wx.showToast({
      title: &quot;地址保存成功&quot;,
      icon: 'success',
      duration: 2000
    })
    setTimeout(function(){
      wx.navigateTo({
        url: &quot;../chooseAddress/chooseAddress&quot;
      })
    },1000);
    
  }
})" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs actionscript"><code><span class="hljs-comment">// 页面的初始数据，用户输入的收货地址、门牌号、姓名、联系电话</span>
data: {
address: <span class="hljs-string">''</span>,
num: <span class="hljs-string">''</span>,
name: <span class="hljs-string">''</span>,
phone: <span class="hljs-string">''</span>
},
backToChooseAddr: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
wx.navigateTo({
  url: <span class="hljs-string">"../chooseAddress/chooseAddress"</span>
});
},
getAddress: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
<span class="hljs-keyword">this</span>.setData({
  address: e.detail.value
})
},
getNum: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
<span class="hljs-keyword">this</span>.setData({
  num: e.detail.value
})
},
getName: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
<span class="hljs-keyword">this</span>.setData({
  name: e.detail.value
})
},
getPhone: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
<span class="hljs-keyword">this</span>.setData({
  phone: e.detail.value
})
},
<span class="hljs-comment">// 用户点击保存后，对输入的数据进行存储，并反馈存储状态</span>
saveInfo: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
wx.setStorage({
  key: <span class="hljs-string">"name"</span>,
  data: [{address:<span class="hljs-keyword">this</span>.data.address}, {num: <span class="hljs-keyword">this</span>.data.num}, {name: <span class="hljs-keyword">this</span>.data.name}, {phone: <span class="hljs-keyword">this</span>.data.phone}],
  success: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    wx.showToast({
      title: <span class="hljs-string">"地址保存成功"</span>,
      icon: <span class="hljs-string">'success'</span>,
      duration: <span class="hljs-number">2000</span>
    })
    setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
      wx.navigateTo({
        url: <span class="hljs-string">"../chooseAddress/chooseAddress"</span>
      })
    },<span class="hljs-number">1000</span>);
    
  }
})</code></pre>
<p>用户默认收货地址的显示，就从storage中按照key-value的方式取出用户存在storage中的地址信息。<br>js部分：</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="onShow: function () {
  var that = this;
  wx.getStorage({
    key: &quot;name&quot;,
    success: function(res) {
      console.log(res);
      if(res.data.length > 0) {
        that.setData({
          address: res.data[0].address,
          num: res.data[1].num,
          name: res.data[2].name,
          phone: res.data[3].phone
        })
      }
    }
  })" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs fortran"><code>onShow: <span class="hljs-function"><span class="hljs-keyword">function</span></span> () {
  var that = this;
  wx.getStorage({
    key: <span class="hljs-string">"name"</span>,
    success: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span></span> {
      console.<span class="hljs-built_in">log</span>(res);
      <span class="hljs-keyword">if</span>(res.<span class="hljs-keyword">data</span>.length &gt; <span class="hljs-number">0</span>) {
        that.setData({
          address: res.<span class="hljs-keyword">data</span>[<span class="hljs-number">0</span>].address,
          num: res.<span class="hljs-keyword">data</span>[<span class="hljs-number">1</span>].num,
          <span class="hljs-keyword">name</span>: res.<span class="hljs-keyword">data</span>[<span class="hljs-number">2</span>].<span class="hljs-keyword">name</span>,
          phone: res.<span class="hljs-keyword">data</span>[<span class="hljs-number">3</span>].phone
        })
      }
    }
  })</code></pre>
<h3 id="articleHeader10">图片轮播和滚动视图部分</h3>
<p>图片轮播<br>给swiper组件添加current='"{{"activeIndex"}}"'就能判断当前展示图片的下标，再根据下标该表小圆点的展示状态（给相应的小圆点一个active类，有不同的样式）。小圆点也绑定了点击事件，能根据用户点击不同的小圆点，动态改变图片的展示状态。</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="<swiper class=&quot;page__bd__scroll&quot; current='"{{"activeIndex"}}"' bindchange='swiperTab'>
  <swiper-item>
    <image class=&quot;page__scroll__item&quot; src=&quot;&quot;/>
  </swiper-item>
  <swiper-item>
    <image class=&quot;page__scroll__item&quot; src=&quot;&quot;/>
  </swiper-item>
  <swiper-item>
    <image class=&quot;page__scroll__item&quot; src=&quot;&quot;/>
  </swiper-item>
  <swiper-item>
    <image class=&quot;page__scroll__item&quot; src=&quot;&quot;/>
  </swiper-item>
  <swiper-item>
    <image class=&quot;page__scroll__item&quot; src=&quot;&quot;/>
  </swiper-item>
</swiper>

<ul class=&quot;page__scroll__btns&quot;>
  <li class=&quot;page__scroll__btn "{{"activeIndex==0?'active':''"}}"&quot; bindtap=&quot;changeTag&quot; data-index=&quot;0&quot;></li>
  <li class=&quot;page__scroll__btn "{{"activeIndex==1?'active':''"}}"&quot; bindtap=&quot;changeTag&quot; data-index=&quot;1&quot;></li>
  <li class=&quot;page__scroll__btn "{{"activeIndex==2?'active':''"}}"&quot; bindtap=&quot;changeTag&quot; data-index=&quot;2&quot;></li>
  <li class=&quot;page__scroll__btn "{{"activeIndex==3?'active':''"}}"&quot; bindtap=&quot;changeTag&quot; data-index=&quot;3&quot;></li>
  <li class=&quot;page__scroll__btn "{{"activeIndex==4?'active':''"}}"&quot; bindtap=&quot;changeTag&quot; data-index=&quot;4&quot;></li>
</ul>" title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs django"><code><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">swiper</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page__bd__scroll"</span> <span class="hljs-attr">current</span>=<span class="hljs-string">'</span></span></span><span class="hljs-template-variable">"{{"activeIndex"}}"</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">'</span> <span class="hljs-attr">bindchange</span>=<span class="hljs-string">'swiperTab'</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">swiper-item</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">image</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page__scroll__item"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">""</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">swiper-item</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">swiper-item</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">image</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page__scroll__item"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">""</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">swiper-item</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">swiper-item</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">image</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page__scroll__item"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">""</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">swiper-item</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">swiper-item</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">image</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page__scroll__item"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">""</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">swiper-item</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">swiper-item</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">image</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page__scroll__item"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">""</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">swiper-item</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">swiper</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page__scroll__btns"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page__scroll__btn </span></span></span><span class="hljs-template-variable">"{{"activeIndex==0?'active':''"}}"</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span> <span class="hljs-attr">bindtap</span>=<span class="hljs-string">"changeTag"</span> <span class="hljs-attr">data-index</span>=<span class="hljs-string">"0"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page__scroll__btn </span></span></span><span class="hljs-template-variable">"{{"activeIndex==1?'active':''"}}"</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span> <span class="hljs-attr">bindtap</span>=<span class="hljs-string">"changeTag"</span> <span class="hljs-attr">data-index</span>=<span class="hljs-string">"1"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page__scroll__btn </span></span></span><span class="hljs-template-variable">"{{"activeIndex==2?'active':''"}}"</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span> <span class="hljs-attr">bindtap</span>=<span class="hljs-string">"changeTag"</span> <span class="hljs-attr">data-index</span>=<span class="hljs-string">"2"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page__scroll__btn </span></span></span><span class="hljs-template-variable">"{{"activeIndex==3?'active':''"}}"</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span> <span class="hljs-attr">bindtap</span>=<span class="hljs-string">"changeTag"</span> <span class="hljs-attr">data-index</span>=<span class="hljs-string">"3"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page__scroll__btn </span></span></span><span class="hljs-template-variable">"{{"activeIndex==4?'active':''"}}"</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span> <span class="hljs-attr">bindtap</span>=<span class="hljs-string">"changeTag"</span> <span class="hljs-attr">data-index</span>=<span class="hljs-string">"4"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span></code></pre>
<p>js部分：</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="全选"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="// activeIndex 是当前播放图片的下标
data: {
  activeIndex: 0
},
// 点击不同的小圆点切换不同的图片
changeTag:  function(e){
  var type = e.target.dataset.index;
  this.setData({
    activeIndex: type
  });
},
// 滑动切换图片，获取点击的下标，改变相应小圆点的状态
swiperTab: function(e){
  var type = e.detail.current;
  this.setData({
    activeIndex: type
  });
}," title="" data-original-title="复制"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="放进笔记"></span>
      </div>
      </div><pre class="hljs scala"><code><span class="hljs-comment">// activeIndex 是当前播放图片的下标</span>
data: {
  activeIndex: <span class="hljs-number">0</span>
},
<span class="hljs-comment">// 点击不同的小圆点切换不同的图片</span>
changeTag:  function(e){
  <span class="hljs-keyword">var</span> <span class="hljs-class"><span class="hljs-keyword">type</span> </span>= e.target.dataset.index;
  <span class="hljs-keyword">this</span>.setData({
    activeIndex: <span class="hljs-class"><span class="hljs-keyword">type</span></span>
  });
},
<span class="hljs-comment">// 滑动切换图片，获取点击的下标，改变相应小圆点的状态</span>
swiperTab: function(e){
  <span class="hljs-keyword">var</span> <span class="hljs-class"><span class="hljs-keyword">type</span> </span>= e.detail.current;
  <span class="hljs-keyword">this</span>.setData({
    activeIndex: <span class="hljs-class"><span class="hljs-keyword">type</span></span>
  });
},</code></pre>
<h2 id="articleHeader11">遇到的问题</h2>
<p>1、在写静态界面的时候，给子元素一个margin值，一直会影响父元素的margin值，纠结了好久才知道这个问题可以用bfc的知识解决。给父元素添加一个overflow: hidden，通过这种方法创建一个bfc，就能避免子元素的margin样式影响到父元素。<br>2、从后台或者从其他地方获取数据时，很难一眼看出来传值的内容是什么，我就把数据输出到控制台，一点点判断。<br>3、异步问题。js是异步执行的。比如执行到取数据的时候，程序不会等着取到数据再执行下一步，而是立即执行下一步。这点在输出数据和设置数据时要尤为注意。</p>
<h2 id="articleHeader12">收获</h2>
<p>写完这些还是收获满满的。<br>感触最大的就是要善于查文档。微信的weui提供了很多样式，只要引入样式库，照着使用文档写，能少很多事。还有就是微信小程序的api，里面有很多微信小程序自带的api，很方便。<br>面对bug心理承受也更大了。学会了一些调试技巧。使用easymock构建模拟数据。<br>对底层的盒子模型、异步等东西有了更深一层的理解。<br>项目地址：<br><a href="https://github.com/TeanLee/hema" rel="nofollow noreferrer" target="_blank">https://github.com/TeanLee/hema</a><br><strong><em>如果觉得还不错的话，给个小星星start鼓励一下哦</em></strong><br><strong><em>比心</em></strong></p>
<h3 id="articleHeader13">联系方式：</h3>
<p>如果有建议，欢迎联系我，一起学习。<br>wechat: ltt598625763<br>email: 598625763@qq.com</p>

                
{{< /raw >}}

# 版权声明
本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，

本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。

原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！

## 原文标题
盒马微信小程序

## 原文链接
[https://segmentfault.com/a/1190000012259909](https://segmentfault.com/a/1190000012259909)

